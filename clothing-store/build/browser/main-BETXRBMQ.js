import{a as Ty,b as Cy,c as $l,d as Ay,e as Cs,f as Bl,g as Va,h as Sy,i as by,j as ql,k as fe,l as hr,m as Bt,n as ka,o as As,p as zl,q as Ry,r as Na,s as Oa,t as ut,u as st,v as Gl}from"./chunk-RJ4VODRH.js";import{$ as An,$a as Ye,A as cn,Aa as ei,Ab as jl,B as Hr,Ba as Km,Bb as uy,C as Rl,Ca as ys,Cb as ly,D as Qr,Da as F,Db as cr,E as Om,Ea as L,Eb as hy,F as Fm,Fa as Ca,Fb as ur,G as wa,Ga as Hm,Gb as dy,H as Ut,Ha as Aa,Hb as fy,I as Dl,Ia as vs,Ib as ct,J as Lm,Ja as _s,Jb as py,K as Ea,Ka as re,Kb as Is,L as Yr,La as Qm,Lb as gy,M as Pl,Ma as Ym,Mb as my,N as Xr,Na as Dn,Nb as Ts,O as Ne,Oa as Xm,Ob as yy,P as xl,Pa as Jm,Pb as Ma,Q as Um,Qa as Nl,Qb as $t,R as Ve,Ra as Zm,Rb as vy,S as oe,Sa as Qe,Sb as _y,T as jt,Ta as Sa,Tb as wy,U as Ml,Ua as le,Ub as lr,V as fs,Va as Ol,Vb as Ey,W as Cn,Wa as A,Wb as Iy,X as un,Xa as P,Y as me,Ya as it,Z as Se,Za as Pn,_ as nt,_a as Ee,a as Rm,aa as Sn,ab as ti,b as Dm,ba as ps,bb as O,c as In,ca as jm,cb as gt,d as Cl,da as H,db as mt,e as Al,ea as be,eb as ey,f as Lt,fa as $m,fb as St,g as He,ga as z,gb as bt,h as va,ha as Ia,hb as Rt,i as Pm,ia as Bm,ib as ws,j as or,ja as At,jb as ty,k as Tn,ka as qm,kb as ny,l as ar,la as Vl,lb as ry,m as de,ma as gs,mb as iy,n as k,na as b,nb as Es,o as ds,oa as N,ob as sy,p as xm,pa as rt,pb as ba,q as Mm,qa as zm,qb as oy,r as j,ra as Ta,rb as Ra,s as _a,sa as Gm,sb as Da,t as at,ta as ms,tb as Fl,u as Sl,ua as bn,ub as Pa,v as Vm,va as Jr,vb as Ll,w as bl,wa as Zr,wb as ay,x as km,xa as Wm,xb as Ul,y as Nm,ya as Rn,yb as xa,z as pt,za as kl,zb as cy}from"./chunk-ZIZZOTQQ.js";import{a as R,b as ue,e as Tl,f as m}from"./chunk-CQCHLVVT.js";var Hl=class extends fy{constructor(){super(...arguments),this.supportsDOMEvents=!0}},Ql=class n extends Hl{static makeCurrent(){dy(new n)}onAndCancel(e,t,r){return e.addEventListener(t,r),()=>{e.removeEventListener(t,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=ZI();return t==null?null:eT(t)}resetBaseElement(){Ss=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return yy(document.cookie,e)}},Ss=null;function ZI(){return Ss=Ss||document.querySelector("base"),Ss?Ss.getAttribute("href"):null}function eT(n){return new URL(n,document.baseURI).pathname}var Yl=class{addToWindow(e){Cn.getAngularTestability=(r,i=!0)=>{let s=e.findTestabilityInTree(r,i);if(s==null)throw new oe(5103,!1);return s},Cn.getAllAngularTestabilities=()=>e.getAllTestabilities(),Cn.getAllAngularRootElements=()=>e.getAllRootElements();let t=r=>{let i=Cn.getAllAngularTestabilities(),s=i.length,o=function(){s--,s==0&&r()};i.forEach(a=>{a.whenStable(o)})};Cn.frameworkStabilizers||(Cn.frameworkStabilizers=[]),Cn.frameworkStabilizers.push(t)}findTestabilityInTree(e,t,r){if(t==null)return null;let i=e.getTestability(t);return i??(r?ur().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},tT=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=H({token:e,factory:e.\u0275fac});let n=e;return n})(),Xl=new z(""),xy=(()=>{let e=class e{constructor(r,i){this._zone=i,this._eventNameToPlugin=new Map,r.forEach(s=>{s.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,i,s){return this._findPluginFor(i).addEventListener(r,i,s)}getZone(){return this._zone}_findPluginFor(r){let i=this._eventNameToPlugin.get(r);if(i)return i;if(i=this._plugins.find(o=>o.supports(r)),!i)throw new oe(5101,!1);return this._eventNameToPlugin.set(r,i),i}};e.\u0275fac=function(i){return new(i||e)(b(Xl),b(re))},e.\u0275prov=H({token:e,factory:e.\u0275fac});let n=e;return n})(),Fa=class{constructor(e){this._doc=e}},Wl="ng-app-id",My=(()=>{let e=class e{constructor(r,i,s,o={}){this.doc=r,this.appId=i,this.nonce=s,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=lr(o),this.resetHostNodes()}addStyles(r){for(let i of r)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(r){for(let i of r)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let r=this.styleNodesInDOM;r&&(r.forEach(i=>i.remove()),r.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(let i of this.getAllStyles())this.addStyleToHost(r,i)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(let i of this.hostNodes)this.addStyleToHost(i,r)}onStyleRemoved(r){let i=this.styleRef;i.get(r)?.elements?.forEach(s=>s.remove()),i.delete(r)}collectServerRenderedStyles(){let r=this.doc.head?.querySelectorAll(`style[${Wl}="${this.appId}"]`);if(r?.length){let i=new Map;return r.forEach(s=>{s.textContent!=null&&i.set(s.textContent,s)}),i}return null}changeUsageCount(r,i){let s=this.styleRef;if(s.has(r)){let o=s.get(r);return o.usage+=i,o.usage}return s.set(r,{usage:i,elements:[]}),i}getStyleElement(r,i){let s=this.styleNodesInDOM,o=s?.get(i);if(o?.parentNode===r)return s.delete(i),o.removeAttribute(Wl),o;{let a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=i,this.platformIsServer&&a.setAttribute(Wl,this.appId),r.appendChild(a),a}}addStyleToHost(r,i){let s=this.getStyleElement(r,i),o=this.styleRef,a=o.get(i)?.elements;a?a.push(s):o.set(i,{elements:[s],usage:1})}resetHostNodes(){let r=this.hostNodes;r.clear(),r.add(this.doc.head)}};e.\u0275fac=function(i){return new(i||e)(b(ct),b(Ia),b(Vl,8),b(At))},e.\u0275prov=H({token:e,factory:e.\u0275fac});let n=e;return n})(),Kl={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Zl=/%COMP%/g,Vy="%COMP%",nT=`_nghost-${Vy}`,rT=`_ngcontent-${Vy}`,iT=!0,sT=new z("",{providedIn:"root",factory:()=>iT});function oT(n){return rT.replace(Zl,n)}function aT(n){return nT.replace(Zl,n)}function ky(n,e){return e.map(t=>t.replace(Zl,n))}var La=(()=>{let e=class e{constructor(r,i,s,o,a,c,u,l=null){this.eventManager=r,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=o,this.doc=a,this.platformId=c,this.ngZone=u,this.nonce=l,this.rendererByCompId=new Map,this.platformIsServer=lr(c),this.defaultRenderer=new bs(r,a,u,this.platformIsServer)}createRenderer(r,i){if(!r||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===fs.ShadowDom&&(i=ue(R({},i),{encapsulation:fs.Emulated}));let s=this.getOrCreateRenderer(r,i);return s instanceof Ua?s.applyToHost(r):s instanceof Rs&&s.applyStyles(),s}getOrCreateRenderer(r,i){let s=this.rendererByCompId,o=s.get(i.id);if(!o){let a=this.doc,c=this.ngZone,u=this.eventManager,l=this.sharedStylesHost,h=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(i.encapsulation){case fs.Emulated:o=new Ua(u,l,i,this.appId,h,a,c,d);break;case fs.ShadowDom:return new Jl(u,l,r,i,a,c,this.nonce,d);default:o=new Rs(u,l,i,h,a,c,d);break}s.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(i){return new(i||e)(b(xy),b(My),b(Ia),b(sT),b(ct),b(At),b(re),b(Vl))},e.\u0275prov=H({token:e,factory:e.\u0275fac});let n=e;return n})(),bs=class{constructor(e,t,r,i){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(Kl[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(Dy(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(Dy(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new oe(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;let s=Kl[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){let i=Kl[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(ys.DashCase|ys.Important)?e.style.setProperty(t,r,i&ys.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&ys.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e!=null&&(e[t]=r)}setValue(e,t){e.nodeValue=t}listen(e,t,r){if(typeof e=="string"&&(e=ur().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(r))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function Dy(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var Jl=class extends bs{constructor(e,t,r,i,s,o,a,c){super(e,s,o,c),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=ky(i.id,i.styles);for(let l of u){let h=document.createElement("style");a&&h.setAttribute("nonce",a),h.textContent=l,this.shadowRoot.appendChild(h)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Rs=class extends bs{constructor(e,t,r,i,s,o,a,c){super(e,s,o,a),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=c?ky(c,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Ua=class extends Rs{constructor(e,t,r,i,s,o,a,c){let u=i+"-"+r.id;super(e,t,r,s,o,a,c,u),this.contentAttr=oT(u),this.hostAttr=aT(u)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}},cT=(()=>{let e=class e extends Fa{constructor(r){super(r)}supports(r){return!0}addEventListener(r,i,s){return r.addEventListener(i,s,!1),()=>this.removeEventListener(r,i,s)}removeEventListener(r,i,s){return r.removeEventListener(i,s)}};e.\u0275fac=function(i){return new(i||e)(b(ct))},e.\u0275prov=H({token:e,factory:e.\u0275fac});let n=e;return n})(),Py=["alt","control","meta","shift"],uT={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},lT={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},hT=(()=>{let e=class e extends Fa{constructor(r){super(r)}supports(r){return e.parseEventName(r)!=null}addEventListener(r,i,s){let o=e.parseEventName(i),a=e.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ur().onAndCancel(r,o.domEventName,a))}static parseEventName(r){let i=r.toLowerCase().split("."),s=i.shift();if(i.length===0||!(s==="keydown"||s==="keyup"))return null;let o=e._normalizeKey(i.pop()),a="",c=i.indexOf("code");if(c>-1&&(i.splice(c,1),a="code."),Py.forEach(l=>{let h=i.indexOf(l);h>-1&&(i.splice(h,1),a+=l+".")}),a+=o,i.length!=0||o.length===0)return null;let u={};return u.domEventName=s,u.fullKey=a,u}static matchEventFullKeyCode(r,i){let s=uT[r.key]||r.key,o="";return i.indexOf("code.")>-1&&(s=r.code,o="code."),s==null||!s?!1:(s=s.toLowerCase(),s===" "?s="space":s==="."&&(s="dot"),Py.forEach(a=>{if(a!==s){let c=lT[a];c(r)&&(o+=a+".")}}),o+=s,o===i)}static eventCallback(r,i,s){return o=>{e.matchEventFullKeyCode(o,r)&&s.runGuarded(()=>i(o))}}static _normalizeKey(r){return r==="esc"?"escape":r}};e.\u0275fac=function(i){return new(i||e)(b(ct))},e.\u0275prov=H({token:e,factory:e.\u0275fac});let n=e;return n})();function dT(){Ql.makeCurrent()}function fT(){return new kl}function pT(){return jm(document),document}var gT=[{provide:At,useValue:wy},{provide:Bm,useValue:dT,multi:!0},{provide:ct,useFactory:pT,deps:[]}],Ny=cy(uy,"browser",gT),mT=new z(""),yT=[{provide:Ra,useClass:Yl,deps:[]},{provide:oy,useClass:Da,deps:[re,Fl,Ra]},{provide:Da,useClass:Da,deps:[re,Fl,Ra]}],vT=[{provide:Gm,useValue:"root"},{provide:kl,useFactory:fT,deps:[]},{provide:Xl,useClass:cT,multi:!0,deps:[ct,re,At]},{provide:Xl,useClass:hT,multi:!0,deps:[ct]},La,My,xy,{provide:Aa,useExisting:La},{provide:Iy,useClass:tT,deps:[]},[]],Oy=(()=>{let e=class e{constructor(r){}static withServerTransition(r){return{ngModule:e,providers:[{provide:Ia,useValue:r.appId}]}}};e.\u0275fac=function(i){return new(i||e)(b(mT,12))},e.\u0275mod=Se({type:e}),e.\u0275inj=be({providers:[...vT,...yT],imports:[_y,ly]});let n=e;return n})();var Fy=(()=>{let e=class e{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}};e.\u0275fac=function(i){return new(i||e)(b(ct))},e.\u0275prov=H({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var G="primary",qs=Symbol("RouteTitle"),ih=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function oi(n){return new ih(n)}function _T(n,e,t){let r=t.path.split("/");if(r.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||r.length<n.length))return null;let i={};for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(o.startsWith(":"))i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function wT(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!qt(n[t],e[t]))return!1;return!0}function qt(n,e){let t=n?sh(n):void 0,r=e?sh(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!Ky(n[i],e[i]))return!1;return!0}function sh(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function Ky(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}else return n===e}function Hy(n){return n.length>0?n[n.length-1]:null}function kn(n){return xm(n)?n:Pa(n)?de(Promise.resolve(n)):k(n)}var ET={exact:Yy,subset:Xy},Qy={exact:IT,subset:TT,ignored:()=>!0};function Uy(n,e,t){return ET[t.paths](n.root,e.root,t.matrixParams)&&Qy[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function IT(n,e){return qt(n,e)}function Yy(n,e,t){if(!fr(n.segments,e.segments)||!Ba(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!n.children[r]||!Yy(n.children[r],e.children[r],t))return!1;return!0}function TT(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>Ky(n[t],e[t]))}function Xy(n,e,t){return Jy(n,e,e.segments,t)}function Jy(n,e,t,r){if(n.segments.length>t.length){let i=n.segments.slice(0,t.length);return!(!fr(i,t)||e.hasChildren()||!Ba(i,t,r))}else if(n.segments.length===t.length){if(!fr(n.segments,t)||!Ba(n.segments,t,r))return!1;for(let i in e.children)if(!n.children[i]||!Xy(n.children[i],e.children[i],r))return!1;return!0}else{let i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!fr(n.segments,i)||!Ba(n.segments,i,r)||!n.children[G]?!1:Jy(n.children[G],e,s,r)}}function Ba(n,e,t){return e.every((r,i)=>Qy[t](n[i].parameters,r.parameters))}var xn=class{constructor(e=new ee([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=oi(this.queryParams),this._queryParamMap}toString(){return ST.serialize(this)}},ee=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return qa(this)}},dr=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=oi(this.parameters),this._parameterMap}toString(){return ev(this)}};function CT(n,e){return fr(n,e)&&n.every((t,r)=>qt(t.parameters,e[r].parameters))}function fr(n,e){return n.length!==e.length?!1:n.every((t,r)=>t.path===e[r].path)}function AT(n,e){let t=[];return Object.entries(n.children).forEach(([r,i])=>{r===G&&(t=t.concat(e(i,r)))}),Object.entries(n.children).forEach(([r,i])=>{r!==G&&(t=t.concat(e(i,r)))}),t}var zs=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=H({token:e,factory:()=>new Ns,providedIn:"root"});let n=e;return n})(),Ns=class{parse(e){let t=new ah(e);return new xn(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${Ds(e.root,!0)}`,r=DT(e.queryParams),i=typeof e.fragment=="string"?`#${bT(e.fragment)}`:"";return`${t}${r}${i}`}},ST=new Ns;function qa(n){return n.segments.map(e=>ev(e)).join("/")}function Ds(n,e){if(!n.hasChildren())return qa(n);if(e){let t=n.children[G]?Ds(n.children[G],!1):"",r=[];return Object.entries(n.children).forEach(([i,s])=>{i!==G&&r.push(`${i}:${Ds(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}else{let t=AT(n,(r,i)=>i===G?[Ds(n.children[G],!1)]:[`${i}:${Ds(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[G]!=null?`${qa(n)}/${t[0]}`:`${qa(n)}/(${t.join("//")})`}}function Zy(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ja(n){return Zy(n).replace(/%3B/gi,";")}function bT(n){return encodeURI(n)}function oh(n){return Zy(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function za(n){return decodeURIComponent(n)}function jy(n){return za(n.replace(/\+/g,"%20"))}function ev(n){return`${oh(n.path)}${RT(n.parameters)}`}function RT(n){return Object.entries(n).map(([e,t])=>`;${oh(e)}=${oh(t)}`).join("")}function DT(n){let e=Object.entries(n).map(([t,r])=>Array.isArray(r)?r.map(i=>`${ja(t)}=${ja(i)}`).join("&"):`${ja(t)}=${ja(r)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var PT=/^[^\/()?;#]+/;function eh(n){let e=n.match(PT);return e?e[0]:""}var xT=/^[^\/()?;=#]+/;function MT(n){let e=n.match(xT);return e?e[0]:""}var VT=/^[^=?&#]+/;function kT(n){let e=n.match(VT);return e?e[0]:""}var NT=/^[^&#]+/;function OT(n){let e=n.match(NT);return e?e[0]:""}var ah=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new ee([],{}):new ee([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[G]=new ee(e,t)),r}parseSegment(){let e=eh(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new oe(4009,!1);return this.capture(e),new dr(za(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=MT(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let i=eh(this.remaining);i&&(r=i,this.capture(r))}e[za(t)]=za(r)}parseQueryParam(e){let t=kT(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let o=OT(this.remaining);o&&(r=o,this.capture(r))}let i=jy(t),s=jy(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=eh(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new oe(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=G);let o=this.parseChildren();t[s]=Object.keys(o).length===1?o[G]:new ee([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new oe(4011,!1)}};function tv(n){return n.segments.length>0?new ee([],{[G]:n}):n}function nv(n){let e={};for(let[r,i]of Object.entries(n.children)){let s=nv(i);if(r===G&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}let t=new ee(n.segments,e);return FT(t)}function FT(n){if(n.numberOfChildren===1&&n.children[G]){let e=n.children[G];return new ee(n.segments.concat(e.segments),e.children)}return n}function ai(n){return n instanceof xn}function LT(n,e,t=null,r=null){let i=rv(n);return iv(i,e,t,r)}function rv(n){let e;function t(s){let o={};for(let c of s.children){let u=t(c);o[c.outlet]=u}let a=new ee(s.url,o);return s===n&&(e=a),a}let r=t(n.root),i=tv(r);return e??i}function iv(n,e,t,r){let i=n;for(;i.parent;)i=i.parent;if(e.length===0)return th(i,i,i,t,r);let s=UT(e);if(s.toRoot())return th(i,i,new ee([],{}),t,r);let o=jT(s,i,n),a=o.processChildren?Ms(o.segmentGroup,o.index,s.commands):ov(o.segmentGroup,o.index,s.commands);return th(i,o.segmentGroup,a,t,r)}function Ga(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function Os(n){return typeof n=="object"&&n!=null&&n.outlets}function th(n,e,t,r,i){let s={};r&&Object.entries(r).forEach(([c,u])=>{s[c]=Array.isArray(u)?u.map(l=>`${l}`):`${u}`});let o;n===e?o=t:o=sv(n,e,t);let a=tv(nv(o));return new xn(a,s,i)}function sv(n,e,t){let r={};return Object.entries(n.children).forEach(([i,s])=>{s===e?r[i]=t:r[i]=sv(s,e,t)}),new ee(n.segments,r)}var Wa=class{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&Ga(r[0]))throw new oe(4003,!1);let i=r.find(Os);if(i&&i!==Hy(r))throw new oe(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function UT(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new Wa(!0,0,n);let e=0,t=!1,r=n.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([c,u])=>{a[c]=typeof u=="string"?u.split("/"):u}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((a,c)=>{c==0&&a==="."||(c==0&&a===""?t=!0:a===".."?e++:a!=""&&i.push(a))}),i):[...i,s]},[]);return new Wa(t,e,r)}var ii=class{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}};function jT(n,e,t){if(n.isAbsolute)return new ii(e,!0,0);if(!t)return new ii(e,!1,NaN);if(t.parent===null)return new ii(t,!0,0);let r=Ga(n.commands[0])?0:1,i=t.segments.length-1+r;return $T(t,i,n.numberOfDoubleDots)}function $T(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new oe(4005,!1);i=r.segments.length}return new ii(r,!1,i-s)}function BT(n){return Os(n[0])?n[0].outlets:{[G]:n}}function ov(n,e,t){if(n??=new ee([],{}),n.segments.length===0&&n.hasChildren())return Ms(n,e,t);let r=qT(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let s=new ee(n.segments.slice(0,r.pathIndex),{});return s.children[G]=new ee(n.segments.slice(r.pathIndex),n.children),Ms(s,0,i)}else return r.match&&i.length===0?new ee(n.segments,{}):r.match&&!n.hasChildren()?ch(n,e,t):r.match?Ms(n,0,i):ch(n,e,t)}function Ms(n,e,t){if(t.length===0)return new ee(n.segments,{});{let r=BT(t),i={};if(Object.keys(r).some(s=>s!==G)&&n.children[G]&&n.numberOfChildren===1&&n.children[G].segments.length===0){let s=Ms(n.children[G],e,t);return new ee(n.segments,s.children)}return Object.entries(r).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=ov(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{r[s]===void 0&&(i[s]=o)}),new ee(n.segments,i)}}function qT(n,e,t){let r=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;let o=n.segments[i],a=t[r];if(Os(a))break;let c=`${a}`,u=r<t.length-1?t[r+1]:null;if(i>0&&c===void 0)break;if(c&&u&&typeof u=="object"&&u.outlets===void 0){if(!By(c,u,o))return s;r+=2}else{if(!By(c,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function ch(n,e,t){let r=n.segments.slice(0,e),i=0;for(;i<t.length;){let s=t[i];if(Os(s)){let c=zT(s.outlets);return new ee(r,c)}if(i===0&&Ga(t[0])){let c=n.segments[e];r.push(new dr(c.path,$y(t[0]))),i++;continue}let o=Os(s)?s.outlets[G]:`${s}`,a=i<t.length-1?t[i+1]:null;o&&a&&Ga(a)?(r.push(new dr(o,$y(a))),i+=2):(r.push(new dr(o,{})),i++)}return new ee(r,{})}function zT(n){let e={};return Object.entries(n).forEach(([t,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[t]=ch(new ee([],{}),0,r))}),e}function $y(n){let e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function By(n,e,t){return n==t.path&&qt(e,t.parameters)}var Vs="imperative",Oe=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(Oe||{}),vt=class{constructor(e,t){this.id=e,this.url=t}},ci=class extends vt{constructor(e,t,r="imperative",i=null){super(e,t),this.type=Oe.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},zt=class extends vt{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=Oe.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},yt=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(yt||{}),Ka=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(Ka||{}),Mn=class extends vt{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=Oe.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Vn=class extends vt{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=Oe.NavigationSkipped}},Fs=class extends vt{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=Oe.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Ha=class extends vt{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Oe.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},uh=class extends vt{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Oe.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},lh=class extends vt{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=Oe.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},hh=class extends vt{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Oe.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},dh=class extends vt{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Oe.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},fh=class{constructor(e){this.route=e,this.type=Oe.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},ph=class{constructor(e){this.route=e,this.type=Oe.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},gh=class{constructor(e){this.snapshot=e,this.type=Oe.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},mh=class{constructor(e){this.snapshot=e,this.type=Oe.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},yh=class{constructor(e){this.snapshot=e,this.type=Oe.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},vh=class{constructor(e){this.snapshot=e,this.type=Oe.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Qa=class{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r,this.type=Oe.Scroll}toString(){let e=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${e}')`}},Ls=class{},Us=class{constructor(e){this.url=e}};var _h=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Gs,this.attachRef=null}},Gs=(()=>{let e=class e{constructor(){this.contexts=new Map}onChildOutletCreated(r,i){let s=this.getOrCreateContext(r);s.outlet=i,this.contexts.set(r,s)}onChildOutletDestroyed(r){let i=this.getContext(r);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let i=this.getContext(r);return i||(i=new _h,this.contexts.set(r,i)),i}getContext(r){return this.contexts.get(r)||null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=H({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Ya=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=wh(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){let t=wh(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=Eh(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return Eh(e,this._root).map(t=>t.value)}};function wh(n,e){if(n===e.value)return e;for(let t of e.children){let r=wh(n,t);if(r)return r}return null}function Eh(n,e){if(n===e.value)return[e];for(let t of e.children){let r=Eh(n,t);if(r.length)return r.unshift(e),r}return[]}var lt=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function ri(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var Xa=class extends Ya{constructor(e,t){super(e),this.snapshot=t,xh(this,e)}toString(){return this.snapshot.toString()}};function av(n){let e=GT(n),t=new He([new dr("",{})]),r=new He({}),i=new He({}),s=new He({}),o=new He(""),a=new ln(t,r,s,o,i,G,n,e.root);return a.snapshot=e.root,new Xa(new lt(a,[]),e)}function GT(n){let e={},t={},r={},i="",s=new js([],e,r,i,t,G,n,null,{});return new Ja("",new lt(s,[]))}var ln=class{constructor(e,t,r,i,s,o,a,c){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=c,this.title=this.dataSubject?.pipe(j(u=>u[qs]))??k(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(j(e=>oi(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(j(e=>oi(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Ph(n,e,t="emptyOnly"){let r,{routeConfig:i}=n;return e!==null&&(t==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:R(R({},e.params),n.params),data:R(R({},e.data),n.data),resolve:R(R(R(R({},n.data),e.data),i?.data),n._resolvedData)}:r={params:R({},n.params),data:R({},n.data),resolve:R(R({},n.data),n._resolvedData??{})},i&&uv(i)&&(r.resolve[qs]=i.title),r}var js=class{get title(){return this.data?.[qs]}constructor(e,t,r,i,s,o,a,c,u){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=c,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=oi(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=oi(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},Ja=class extends Ya{constructor(e,t){super(t),this.url=e,xh(this,t)}toString(){return cv(this._root)}};function xh(n,e){e.value._routerState=n,e.children.forEach(t=>xh(n,t))}function cv(n){let e=n.children.length>0?` { ${n.children.map(cv).join(", ")} } `:"";return`${n.value}${e}`}function nh(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,qt(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),qt(e.params,t.params)||n.paramsSubject.next(t.params),wT(e.url,t.url)||n.urlSubject.next(t.url),qt(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function Ih(n,e){let t=qt(n.params,e.params)&&CT(n.url,e.url),r=!n.parent!=!e.parent;return t&&!r&&(!n.parent||Ih(n.parent,e.parent))}function uv(n){return typeof n.title=="string"||n.title===null}var Mh=(()=>{let e=class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=G,this.activateEvents=new jt,this.deactivateEvents=new jt,this.attachEvents=new jt,this.detachEvents=new jt,this.parentContexts=N(Gs),this.location=N(Ym),this.changeDetector=N(_s),this.environmentInjector=N(ms),this.inputBinder=N(rc,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){let{firstChange:i,previousValue:s}=r.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new oe(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new oe(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new oe(4012,!1);this.location.detach();let r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,i){this.activated=r,this._activatedRoute=i,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){let r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,i){if(this.isActivated)throw new oe(4013,!1);this._activatedRoute=r;let s=this.location,a=r.snapshot.component,c=this.parentContexts.getOrCreateContext(this.name).children,u=new Th(r,c,s.injector);this.activated=s.createComponent(a,{index:s.length,injector:u,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=nt({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Jr]});let n=e;return n})(),Th=class{constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===ln?this.route:e===Gs?this.childContexts:this.parent.get(e,t)}},rc=new z(""),qy=(()=>{let e=class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(r){this.unsubscribeFromRouteData(r),this.subscribeToRouteData(r)}unsubscribeFromRouteData(r){this.outletDataSubscriptions.get(r)?.unsubscribe(),this.outletDataSubscriptions.delete(r)}subscribeToRouteData(r){let{activatedRoute:i}=r,s=_a([i.queryParams,i.params,i.data]).pipe(Ne(([o,a,c],u)=>(c=R(R(R({},o),a),c),u===0?k(c):Promise.resolve(c)))).subscribe(o=>{if(!r.isActivated||!r.activatedComponentRef||r.activatedRoute!==i||i.component===null){this.unsubscribeFromRouteData(r);return}let a=hy(i.component);if(!a){this.unsubscribeFromRouteData(r);return}for(let{templateName:c}of a.inputs)r.activatedComponentRef.setInput(c,o[c])});this.outletDataSubscriptions.set(r,s)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=H({token:e,factory:e.\u0275fac});let n=e;return n})();function WT(n,e,t){let r=$s(n,e._root,t?t._root:void 0);return new Xa(r,e)}function $s(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let r=t.value;r._futureSnapshot=e.value;let i=KT(n,e,t);return new lt(r,i)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>$s(n,a)),o}}let r=HT(e.value),i=e.children.map(s=>$s(n,s));return new lt(r,i)}}function KT(n,e,t){return e.children.map(r=>{for(let i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return $s(n,r,i);return $s(n,r)})}function HT(n){return new ln(new He(n.url),new He(n.params),new He(n.queryParams),new He(n.fragment),new He(n.data),n.outlet,n.component,n)}var lv="ngNavigationCancelingError";function hv(n,e){let{redirectTo:t,navigationBehaviorOptions:r}=ai(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=dv(!1,yt.Redirect);return i.url=t,i.navigationBehaviorOptions=r,i}function dv(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[lv]=!0,t.cancellationCode=e,t}function QT(n){return fv(n)&&ai(n.url)}function fv(n){return!!n&&n[lv]}var YT=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=me({type:e,selectors:[["ng-component"]],standalone:!0,features:[ty],decls:1,vars:0,template:function(i,s){i&1&&it(0,"router-outlet")},dependencies:[Mh],encapsulation:2});let n=e;return n})();function XT(n,e){return n.providers&&!n._injector&&(n._injector=Nl(n.providers,e,`Route: ${n.path}`)),n._injector??e}function Vh(n){let e=n.children&&n.children.map(Vh),t=e?ue(R({},n),{children:e}):R({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==G&&(t.component=YT),t}function Gt(n){return n.outlet||G}function JT(n,e){let t=n.filter(r=>Gt(r)===e);return t.push(...n.filter(r=>Gt(r)!==e)),t}function Ws(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var ZT=(n,e,t,r)=>j(i=>(new Ch(e,i.targetRouterState,i.currentRouterState,t,r).activate(n),i)),Ch=class{constructor(e,t,r,i,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),nh(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){let i=ri(t);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(i===s)if(i.component){let o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=ri(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(r&&r.outlet){let o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=ri(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){let i=ri(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new vh(s.value.snapshot))}),e.children.length&&this.forwardEvent(new mh(e.value.snapshot))}activateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(nh(i),i===s)if(i.component){let o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){let o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),nh(a.route.value),this.activateChildRoutes(e,null,o.children)}else{let a=Ws(i.snapshot);o.attachRef=null,o.route=i,o.injector=a,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}},Za=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},si=class{constructor(e,t){this.component=e,this.route=t}};function eC(n,e,t){let r=n._root,i=e?e._root:null;return Ps(r,i,t,[r.value])}function tC(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function hi(n,e){let t=Symbol(),r=e.get(n,t);return r===t?typeof n=="function"&&!$m(n)?n:e.get(n):r}function Ps(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=ri(e);return n.children.forEach(o=>{nC(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>ks(a,t.getContext(o),i)),i}function nC(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let c=rC(o,s,s.routeConfig.runGuardsAndResolvers);c?i.canActivateChecks.push(new Za(r)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?Ps(n,e,a?a.children:null,r,i):Ps(n,e,t,r,i),c&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new si(a.outlet.component,o))}else o&&ks(e,a,i),i.canActivateChecks.push(new Za(r)),s.component?Ps(n,null,a?a.children:null,r,i):Ps(n,null,t,r,i);return i}function rC(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!fr(n.url,e.url);case"pathParamsOrQueryParamsChange":return!fr(n.url,e.url)||!qt(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Ih(n,e)||!qt(n.queryParams,e.queryParams);case"paramsChange":default:return!Ih(n,e)}}function ks(n,e,t){let r=ri(n),i=n.value;Object.entries(r).forEach(([s,o])=>{i.component?e?ks(o,e.children.getContext(s),t):ks(o,null,t):ks(o,e,t)}),i.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new si(e.outlet.component,i)):t.canDeactivateChecks.push(new si(null,i)):t.canDeactivateChecks.push(new si(null,i))}function Ks(n){return typeof n=="function"}function iC(n){return typeof n=="boolean"}function sC(n){return n&&Ks(n.canLoad)}function oC(n){return n&&Ks(n.canActivate)}function aC(n){return n&&Ks(n.canActivateChild)}function cC(n){return n&&Ks(n.canDeactivate)}function uC(n){return n&&Ks(n.canMatch)}function pv(n){return n instanceof Mm||n?.name==="EmptyError"}var $a=Symbol("INITIAL_VALUE");function ui(){return Ne(n=>_a(n.map(e=>e.pipe(Qr(1),Xr($a)))).pipe(j(e=>{for(let t of e)if(t!==!0){if(t===$a)return $a;if(t===!1||t instanceof xn)return t}return!0}),pt(e=>e!==$a),Qr(1)))}function lC(n,e){return at(t=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return o.length===0&&s.length===0?k(ue(R({},t),{guardsResult:!0})):hC(o,r,i,n).pipe(at(a=>a&&iC(a)?dC(r,s,n,e):k(a)),j(a=>ue(R({},t),{guardsResult:a})))})}function hC(n,e,t,r){return de(n).pipe(at(i=>yC(i.component,i.route,t,e,r)),Ut(i=>i!==!0,!0))}function dC(n,e,t,r){return de(e).pipe(Hr(i=>Vm(pC(i.route.parent,r),fC(i.route,r),mC(n,i.path,t),gC(n,i.route,t))),Ut(i=>i!==!0,!0))}function fC(n,e){return n!==null&&e&&e(new yh(n)),k(!0)}function pC(n,e){return n!==null&&e&&e(new gh(n)),k(!0)}function gC(n,e,t){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return k(!0);let i=r.map(s=>bl(()=>{let o=Ws(e)??t,a=hi(s,o),c=oC(a)?a.canActivate(e,n):bn(o,()=>a(e,n));return kn(c).pipe(Ut())}));return k(i).pipe(ui())}function mC(n,e,t){let r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>tC(o)).filter(o=>o!==null).map(o=>bl(()=>{let a=o.guards.map(c=>{let u=Ws(o.node)??t,l=hi(c,u),h=aC(l)?l.canActivateChild(r,n):bn(u,()=>l(r,n));return kn(h).pipe(Ut())});return k(a).pipe(ui())}));return k(s).pipe(ui())}function yC(n,e,t,r,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return k(!0);let o=s.map(a=>{let c=Ws(e)??i,u=hi(a,c),l=cC(u)?u.canDeactivate(n,e,t,r):bn(c,()=>u(n,e,t,r));return kn(l).pipe(Ut())});return k(o).pipe(ui())}function vC(n,e,t,r){let i=e.canLoad;if(i===void 0||i.length===0)return k(!0);let s=i.map(o=>{let a=hi(o,n),c=sC(a)?a.canLoad(e,t):bn(n,()=>a(e,t));return kn(c)});return k(s).pipe(ui(),gv(r))}function gv(n){return Dm(Ve(e=>{if(ai(e))throw hv(n,e)}),j(e=>e===!0))}function _C(n,e,t,r){let i=e.canMatch;if(!i||i.length===0)return k(!0);let s=i.map(o=>{let a=hi(o,n),c=uC(a)?a.canMatch(e,t):bn(n,()=>a(e,t));return kn(c)});return k(s).pipe(ui(),gv(r))}var Bs=class{constructor(e){this.segmentGroup=e||null}},ec=class extends Error{constructor(e){super(),this.urlTree=e}};function ni(n){return ds(new Bs(n))}function wC(n){return ds(new oe(4e3,!1))}function EC(n){return ds(dv(!1,yt.GuardRejected))}var Ah=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return k(r);if(i.numberOfChildren>1||!i.children[G])return wC(e.redirectTo);i=i.children[G]}}applyRedirectCommands(e,t,r){let i=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t.startsWith("/"))throw new ec(i);return i}applyRedirectCreateUrlTree(e,t,r,i){let s=this.createSegmentGroup(e,t.root,r,i);return new xn(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let r={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s.startsWith(":")){let a=s.substring(1);r[i]=t[a]}else r[i]=s}),r}createSegmentGroup(e,t,r,i){let s=this.createSegments(e,t.segments,r,i),o={};return Object.entries(t.children).forEach(([a,c])=>{o[a]=this.createSegmentGroup(e,c,r,i)}),new ee(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){let i=r[t.path.substring(1)];if(!i)throw new oe(4001,!1);return i}findOrReturn(e,t){let r=0;for(let i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}},Sh={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function IC(n,e,t,r,i){let s=kh(n,e,t);return s.matched?(r=XT(e,r),_C(r,e,t,i).pipe(j(o=>o===!0?s:R({},Sh)))):k(s)}function kh(n,e,t){if(e.path==="**")return TC(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?R({},Sh):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let i=(e.matcher||_T)(t,n,e);if(!i)return R({},Sh);let s={};Object.entries(i.posParams??{}).forEach(([a,c])=>{s[a]=c.path});let o=i.consumed.length>0?R(R({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function TC(n){return{matched:!0,parameters:n.length>0?Hy(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function zy(n,e,t,r){return t.length>0&&SC(n,t,r)?{segmentGroup:new ee(e,AC(r,new ee(t,n.children))),slicedSegments:[]}:t.length===0&&bC(n,t,r)?{segmentGroup:new ee(n.segments,CC(n,t,r,n.children)),slicedSegments:t}:{segmentGroup:new ee(n.segments,n.children),slicedSegments:t}}function CC(n,e,t,r){let i={};for(let s of t)if(ic(n,e,s)&&!r[Gt(s)]){let o=new ee([],{});i[Gt(s)]=o}return R(R({},r),i)}function AC(n,e){let t={};t[G]=e;for(let r of n)if(r.path===""&&Gt(r)!==G){let i=new ee([],{});t[Gt(r)]=i}return t}function SC(n,e,t){return t.some(r=>ic(n,e,r)&&Gt(r)!==G)}function bC(n,e,t){return t.some(r=>ic(n,e,r))}function ic(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function RC(n,e,t,r){return Gt(n)!==r&&(r===G||!ic(e,t,n))?!1:kh(e,n,t).matched}function DC(n,e,t){return e.length===0&&!n.children[t]}var bh=class{};function PC(n,e,t,r,i,s,o="emptyOnly"){return new Rh(n,e,t,r,i,o,s).recognize()}var xC=31,Rh=class{constructor(e,t,r,i,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new Ah(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new oe(4002,`'${e.segmentGroup}'`)}recognize(){let e=zy(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(j(t=>{let r=new js([],Object.freeze({}),Object.freeze(R({},this.urlTree.queryParams)),this.urlTree.fragment,{},G,this.rootComponentType,null,{}),i=new lt(r,t),s=new Ja("",i),o=LT(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(s._root,null),{state:s,tree:o}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e,G).pipe(cn(r=>{if(r instanceof ec)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof Bs?this.noMatchError(r):r}))}inheritParamsAndData(e,t){let r=e.value,i=Ph(r,t,this.paramsInheritanceStrategy);r.params=Object.freeze(i.params),r.data=Object.freeze(i.data),e.children.forEach(s=>this.inheritParamsAndData(s,r))}processSegmentGroup(e,t,r,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,t,r):this.processSegment(e,t,r,r.segments,i,!0).pipe(j(s=>s instanceof lt?[s]:[]))}processChildren(e,t,r){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return de(i).pipe(Hr(s=>{let o=r.children[s],a=JT(t,s);return this.processSegmentGroup(e,a,o,s)}),Yr((s,o)=>(s.push(...o),s)),Rl(null),Lm(),at(s=>{if(s===null)return ni(r);let o=mv(s);return MC(o),k(o)}))}processSegment(e,t,r,i,s,o){return de(t).pipe(Hr(a=>this.processSegmentAgainstRoute(a._injector??e,t,a,r,i,s,o).pipe(cn(c=>{if(c instanceof Bs)return k(null);throw c}))),Ut(a=>!!a),cn(a=>{if(pv(a))return DC(r,i,s)?k(new bh):ni(r);throw a}))}processSegmentAgainstRoute(e,t,r,i,s,o,a){return RC(r,i,s,o)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,r,s,o):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,r,s,o):ni(i):ni(i)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){let{matched:a,consumedSegments:c,positionalParamSegments:u,remainingSegments:l}=kh(t,i,s);if(!a)return ni(t);i.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>xC&&(this.allowRedirects=!1));let h=this.applyRedirects.applyRedirectCommands(c,i.redirectTo,u);return this.applyRedirects.lineralizeSegments(i,h).pipe(at(d=>this.processSegment(e,r,t,d.concat(l),o,!1)))}matchSegmentAgainstRoute(e,t,r,i,s){let o=IC(t,r,i,e,this.urlSerializer);return r.path==="**"&&(t.children={}),o.pipe(Ne(a=>a.matched?(e=r._injector??e,this.getChildConfig(e,r,i).pipe(Ne(({routes:c})=>{let u=r._loadedInjector??e,{consumedSegments:l,remainingSegments:h,parameters:d}=a,f=new js(l,d,Object.freeze(R({},this.urlTree.queryParams)),this.urlTree.fragment,kC(r),Gt(r),r.component??r._loadedComponent??null,r,NC(r)),{segmentGroup:E,slicedSegments:w}=zy(t,l,h,c);if(w.length===0&&E.hasChildren())return this.processChildren(u,c,E).pipe(j(M=>M===null?null:new lt(f,M)));if(c.length===0&&w.length===0)return k(new lt(f,[]));let _=Gt(r)===s;return this.processSegment(u,c,E,w,_?G:s,!0).pipe(j(M=>new lt(f,M instanceof lt?[M]:[])))}))):ni(t)))}getChildConfig(e,t,r){return t.children?k({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?k({routes:t._loadedRoutes,injector:t._loadedInjector}):vC(e,t,r,this.urlSerializer).pipe(at(i=>i?this.configLoader.loadChildren(e,t).pipe(Ve(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):EC(t))):k({routes:[],injector:e})}};function MC(n){n.sort((e,t)=>e.value.outlet===G?-1:t.value.outlet===G?1:e.value.outlet.localeCompare(t.value.outlet))}function VC(n){let e=n.value.routeConfig;return e&&e.path===""}function mv(n){let e=[],t=new Set;for(let r of n){if(!VC(r)){e.push(r);continue}let i=e.find(s=>r.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...r.children),t.add(i)):e.push(r)}for(let r of t){let i=mv(r.children);e.push(new lt(r.value,i))}return e.filter(r=>!t.has(r))}function kC(n){return n.data||{}}function NC(n){return n.resolve||{}}function OC(n,e,t,r,i,s){return at(o=>PC(n,e,t,r,o.extractedUrl,i,s).pipe(j(({state:a,tree:c})=>ue(R({},o),{targetSnapshot:a,urlAfterRedirects:c}))))}function FC(n,e){return at(t=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return k(t);let s=new Set(i.map(c=>c.route)),o=new Set;for(let c of s)if(!o.has(c))for(let u of yv(c))o.add(u);let a=0;return de(o).pipe(Hr(c=>s.has(c)?LC(c,r,n,e):(c.data=Ph(c,c.parent,n).resolve,k(void 0))),Ve(()=>a++),Dl(1),at(c=>a===o.size?k(t):or))})}function yv(n){let e=n.children.map(t=>yv(t)).flat();return[n,...e]}function LC(n,e,t,r){let i=n.routeConfig,s=n._resolve;return i?.title!==void 0&&!uv(i)&&(s[qs]=i.title),UC(s,n,e,r).pipe(j(o=>(n._resolvedData=o,n.data=Ph(n,n.parent,t).resolve,null)))}function UC(n,e,t,r){let i=sh(n);if(i.length===0)return k({});let s={};return de(i).pipe(at(o=>jC(n[o],e,t,r).pipe(Ut(),Ve(a=>{s[o]=a}))),Dl(1),Om(s),cn(o=>pv(o)?or:ds(o)))}function jC(n,e,t,r){let i=Ws(e)??r,s=hi(n,i),o=s.resolve?s.resolve(e,t):bn(i,()=>s(e,t));return kn(o)}function rh(n){return Ne(e=>{let t=n(e);return t?de(t).pipe(j(()=>e)):k(e)})}var vv=(()=>{let e=class e{buildTitle(r){let i,s=r.root;for(;s!==void 0;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(o=>o.outlet===G);return i}getResolvedTitleForRoute(r){return r.data[qs]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=H({token:e,factory:()=>N($C),providedIn:"root"});let n=e;return n})(),$C=(()=>{let e=class e extends vv{constructor(r){super(),this.title=r}updateTitle(r){let i=this.buildTitle(r);i!==void 0&&this.title.setTitle(i)}};e.\u0275fac=function(i){return new(i||e)(b(Fy))},e.\u0275prov=H({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Hs=new z("",{providedIn:"root",factory:()=>({})}),tc=new z(""),Nh=(()=>{let e=class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=N(xa)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return k(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);let i=kn(r.loadComponent()).pipe(j(_v),Ve(o=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=o}),wa(()=>{this.componentLoaders.delete(r)})),s=new Al(i,()=>new Lt).pipe(Cl());return this.componentLoaders.set(r,s),s}loadChildren(r,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return k({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=BC(i,this.compiler,r,this.onLoadEndListener).pipe(wa(()=>{this.childrenLoaders.delete(i)})),a=new Al(o,()=>new Lt).pipe(Cl());return this.childrenLoaders.set(i,a),a}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=H({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function BC(n,e,t,r){return kn(n.loadChildren()).pipe(j(_v),at(i=>i instanceof Jm||Array.isArray(i)?k(i):de(e.compileModuleAsync(i))),j(i=>{r&&r(n);let s,o,a=!1;return Array.isArray(i)?(o=i,a=!0):(s=i.create(t).injector,o=s.get(tc,[],{optional:!0,self:!0}).flat()),{routes:o.map(Vh),injector:s}}))}function qC(n){return n&&typeof n=="object"&&"default"in n}function _v(n){return qC(n)?n.default:n}var Oh=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=H({token:e,factory:()=>N(zC),providedIn:"root"});let n=e;return n})(),zC=(()=>{let e=class e{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,i){return r}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=H({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),wv=new z(""),Ev=new z("");function GC(n,e,t){let r=n.get(Ev),i=n.get(ct);return n.get(re).runOutsideAngular(()=>{if(!i.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,Promise.resolve();let s,o=new Promise(u=>{s=u}),a=i.startViewTransition(()=>(s(),WC(n))),{onViewTransitionCreated:c}=r;return c&&bn(n,()=>c({transition:a,from:e,to:t})),o})}function WC(n){return new Promise(e=>{Qm(e,{injector:n})})}var Fh=(()=>{let e=class e{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Lt,this.transitionAbortSubject=new Lt,this.configLoader=N(Nh),this.environmentInjector=N(ms),this.urlSerializer=N(zs),this.rootContexts=N(Gs),this.location=N(Ts),this.inputBindingEnabled=N(rc,{optional:!0})!==null,this.titleStrategy=N(vv),this.options=N(Hs,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=N(Oh),this.createViewTransition=N(wv,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>k(void 0),this.rootComponentType=null;let r=s=>this.events.next(new fh(s)),i=s=>this.events.next(new ph(s));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=r}complete(){this.transitions?.complete()}handleNavigationRequest(r){let i=++this.navigationId;this.transitions?.next(ue(R(R({},this.transitions.value),r),{id:i}))}setupNavigations(r,i,s){return this.transitions=new He({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Vs,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(pt(o=>o.id!==0),j(o=>ue(R({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),Ne(o=>{this.currentTransition=o;let a=!1,c=!1;return k(o).pipe(Ve(u=>{this.currentNavigation={id:u.id,initialUrl:u.rawUrl,extractedUrl:u.extractedUrl,trigger:u.source,extras:u.extras,previousNavigation:this.lastSuccessfulNavigation?ue(R({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Ne(u=>{let l=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),h=u.extras.onSameUrlNavigation??r.onSameUrlNavigation;if(!l&&h!=="reload"){let d="";return this.events.next(new Vn(u.id,this.urlSerializer.serialize(u.rawUrl),d,Ka.IgnoredSameUrlNavigation)),u.resolve(null),or}if(this.urlHandlingStrategy.shouldProcessUrl(u.rawUrl))return k(u).pipe(Ne(d=>{let f=this.transitions?.getValue();return this.events.next(new ci(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),f!==this.transitions?.getValue()?or:Promise.resolve(d)}),OC(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),Ve(d=>{o.targetSnapshot=d.targetSnapshot,o.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=ue(R({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let f=new Ha(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(f)}));if(l&&this.urlHandlingStrategy.shouldProcessUrl(u.currentRawUrl)){let{id:d,extractedUrl:f,source:E,restoredState:w,extras:_}=u,M=new ci(d,this.urlSerializer.serialize(f),E,w);this.events.next(M);let $=av(this.rootComponentType).snapshot;return this.currentTransition=o=ue(R({},u),{targetSnapshot:$,urlAfterRedirects:f,extras:ue(R({},_),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=f,k(o)}else{let d="";return this.events.next(new Vn(u.id,this.urlSerializer.serialize(u.extractedUrl),d,Ka.IgnoredByUrlHandlingStrategy)),u.resolve(null),or}}),Ve(u=>{let l=new uh(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(l)}),j(u=>(this.currentTransition=o=ue(R({},u),{guards:eC(u.targetSnapshot,u.currentSnapshot,this.rootContexts)}),o)),lC(this.environmentInjector,u=>this.events.next(u)),Ve(u=>{if(o.guardsResult=u.guardsResult,ai(u.guardsResult))throw hv(this.urlSerializer,u.guardsResult);let l=new lh(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot,!!u.guardsResult);this.events.next(l)}),pt(u=>u.guardsResult?!0:(this.cancelNavigationTransition(u,"",yt.GuardRejected),!1)),rh(u=>{if(u.guards.canActivateChecks.length)return k(u).pipe(Ve(l=>{let h=new hh(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}),Ne(l=>{let h=!1;return k(l).pipe(FC(this.paramsInheritanceStrategy,this.environmentInjector),Ve({next:()=>h=!0,complete:()=>{h||this.cancelNavigationTransition(l,"",yt.NoDataFromResolver)}}))}),Ve(l=>{let h=new dh(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}))}),rh(u=>{let l=h=>{let d=[];h.routeConfig?.loadComponent&&!h.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(h.routeConfig).pipe(Ve(f=>{h.component=f}),j(()=>{})));for(let f of h.children)d.push(...l(f));return d};return _a(l(u.targetSnapshot.root)).pipe(Rl(null),Qr(1))}),rh(()=>this.afterPreactivation()),Ne(()=>{let{currentSnapshot:u,targetSnapshot:l}=o,h=this.createViewTransition?.(this.environmentInjector,u.root,l.root);return h?de(h).pipe(j(()=>o)):k(o)}),j(u=>{let l=WT(r.routeReuseStrategy,u.targetSnapshot,u.currentRouterState);return this.currentTransition=o=ue(R({},u),{targetRouterState:l}),this.currentNavigation.targetRouterState=l,o}),Ve(()=>{this.events.next(new Ls)}),ZT(this.rootContexts,r.routeReuseStrategy,u=>this.events.next(u),this.inputBindingEnabled),Qr(1),Ve({next:u=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new zt(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects))),this.titleStrategy?.updateTitle(u.targetRouterState.snapshot),u.resolve(!0)},complete:()=>{a=!0}}),Um(this.transitionAbortSubject.pipe(Ve(u=>{throw u}))),wa(()=>{!a&&!c&&this.cancelNavigationTransition(o,"",yt.SupersededByNewNavigation),this.currentNavigation?.id===o.id&&(this.currentNavigation=null)}),cn(u=>{if(c=!0,fv(u))this.events.next(new Mn(o.id,this.urlSerializer.serialize(o.extractedUrl),u.message,u.cancellationCode)),QT(u)?this.events.next(new Us(u.url)):o.resolve(!1);else{this.events.next(new Fs(o.id,this.urlSerializer.serialize(o.extractedUrl),u,o.targetSnapshot??void 0));try{o.resolve(r.errorHandler(u))}catch(l){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(l)}}return or}))}))}cancelNavigationTransition(r,i,s){let o=new Mn(r.id,this.urlSerializer.serialize(r.extractedUrl),i,s);this.events.next(o),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=H({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function KC(n){return n!==Vs}var HC=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=H({token:e,factory:()=>N(QC),providedIn:"root"});let n=e;return n})(),Dh=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},QC=(()=>{let e=class e extends Dh{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Zr(e)))(s||e)}})(),e.\u0275prov=H({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Iv=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=H({token:e,factory:()=>N(YC),providedIn:"root"});let n=e;return n})(),YC=(()=>{let e=class e extends Iv{constructor(){super(...arguments),this.location=N(Ts),this.urlSerializer=N(zs),this.options=N(Hs,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=N(Oh),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new xn,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=av(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(r){return this.location.subscribe(i=>{i.type==="popstate"&&r(i.url,i.state)})}handleRouterEvent(r,i){if(r instanceof ci)this.stateMemento=this.createStateMemento();else if(r instanceof Vn)this.rawUrlTree=i.initialUrl;else if(r instanceof Ha){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let s=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(s,i)}}else r instanceof Ls?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):r instanceof Mn&&(r.code===yt.GuardRejected||r.code===yt.NoDataFromResolver)?this.restoreHistory(i):r instanceof Fs?this.restoreHistory(i,!0):r instanceof zt&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,i){let s=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl){let o=this.browserPageId,a=R(R({},i.extras.state),this.generateNgRouterState(i.id,o));this.location.replaceState(s,"",a)}else{let o=R(R({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(s,"",o)}}restoreHistory(r,i=!1){if(this.canceledNavigationResolution==="computed"){let s=this.browserPageId,o=this.currentPageId-s;o!==0?this.location.historyGo(o):this.currentUrlTree===r.finalUrl&&o===0&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,i){return this.canceledNavigationResolution==="computed"?{navigationId:r,\u0275routerPageId:i}:{navigationId:r}}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Zr(e)))(s||e)}})(),e.\u0275prov=H({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),xs=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(xs||{});function Tv(n,e){n.events.pipe(pt(t=>t instanceof zt||t instanceof Mn||t instanceof Fs||t instanceof Vn),j(t=>t instanceof zt||t instanceof Vn?xs.COMPLETE:(t instanceof Mn?t.code===yt.Redirect||t.code===yt.SupersededByNewNavigation:!1)?xs.REDIRECTING:xs.FAILED),pt(t=>t!==xs.REDIRECTING),Qr(1)).subscribe(()=>{e()})}function XC(n){throw n}var JC={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},ZC={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},ye=(()=>{let e=class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=N(ba),this.stateManager=N(Iv),this.options=N(Hs,{optional:!0})||{},this.pendingTasks=N(Zm),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=N(Fh),this.urlSerializer=N(zs),this.location=N(Ts),this.urlHandlingStrategy=N(Oh),this._events=new Lt,this.errorHandler=this.options.errorHandler||XC,this.navigated=!1,this.routeReuseStrategy=N(HC),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=N(tc,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!N(rc,{optional:!0}),this.eventsSubscription=new Rm,this.isNgZoneEnabled=N(re)instanceof re&&re.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let r=this.navigationTransitions.events.subscribe(i=>{try{let s=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(s!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof Mn&&i.code!==yt.Redirect&&i.code!==yt.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof zt)this.navigated=!0;else if(i instanceof Us){let a=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),c={info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||KC(s.source)};this.scheduleNavigation(a,Vs,null,c,{resolve:s.resolve,reject:s.reject,promise:s.promise})}}tA(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Vs,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((r,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(r,"popstate",i)},0)})}navigateToSyncWithBrowser(r,i,s){let o={replaceUrl:!0},a=s?.navigationId?s:null;if(s){let u=R({},s);delete u.navigationId,delete u.\u0275routerPageId,Object.keys(u).length!==0&&(o.state=u)}let c=this.parseUrl(r);this.scheduleNavigation(c,i,a,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map(Vh),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,i={}){let{relativeTo:s,queryParams:o,fragment:a,queryParamsHandling:c,preserveFragment:u}=i,l=u?this.currentUrlTree.fragment:a,h=null;switch(c){case"merge":h=R(R({},this.currentUrlTree.queryParams),o);break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=o||null}h!==null&&(h=this.removeEmptyProps(h));let d;try{let f=s?s.snapshot:this.routerState.snapshot.root;d=rv(f)}catch{(typeof r[0]!="string"||!r[0].startsWith("/"))&&(r=[]),d=this.currentUrlTree.root}return iv(d,r,h,l??null)}navigateByUrl(r,i={skipLocationChange:!1}){let s=ai(r)?r:this.parseUrl(r),o=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(o,Vs,null,i)}navigate(r,i={skipLocationChange:!1}){return eA(r),this.navigateByUrl(this.createUrlTree(r,i),i)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,i){let s;if(i===!0?s=R({},JC):i===!1?s=R({},ZC):s=i,ai(r))return Uy(this.currentUrlTree,r,s);let o=this.parseUrl(r);return Uy(this.currentUrlTree,o,s)}removeEmptyProps(r){return Object.entries(r).reduce((i,[s,o])=>(o!=null&&(i[s]=o),i),{})}scheduleNavigation(r,i,s,o,a){if(this.disposed)return Promise.resolve(!1);let c,u,l;a?(c=a.resolve,u=a.reject,l=a.promise):l=new Promise((d,f)=>{c=d,u=f});let h=this.pendingTasks.add();return Tv(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(h))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:o,resolve:c,reject:u,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(d=>Promise.reject(d))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=H({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function eA(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new oe(4008,!1)}function tA(n){return!(n instanceof Ls)&&!(n instanceof Us)}var sc=(()=>{let e=class e{constructor(r,i,s,o,a,c){this.router=r,this.route=i,this.tabIndexAttribute=s,this.renderer=o,this.el=a,this.locationStrategy=c,this.href=null,this.commands=null,this.onChanges=new Lt,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let u=a.nativeElement.tagName?.toLowerCase();this.isAnchorElement=u==="a"||u==="area",this.isAnchorElement?this.subscription=r.events.subscribe(l=>{l instanceof zt&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(r){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",r)}ngOnChanges(r){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(r){r!=null?(this.commands=Array.isArray(r)?r:[r],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(r,i,s,o,a){let c=this.urlTree;if(c===null||this.isAnchorElement&&(r!==0||i||s||o||a||typeof this.target=="string"&&this.target!="_self"))return!0;let u={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(c,u),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let r=this.urlTree;this.href=r!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(r)):null;let i=this.href===null?null:Km(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(r,i){let s=this.renderer,o=this.el.nativeElement;i!==null?s.setAttribute(o,r,i):s.removeAttribute(o,r)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};e.\u0275fac=function(i){return new(i||e)(L(ye),L(ln),Wm("tabindex"),L(vs),L(ps),L(Is))},e.\u0275dir=nt({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,s){i&1&&Ee("click",function(a){return s.onClick(a.button,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey)}),i&2&&Sa("target",s.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[un.HasDecoratorInputTransform,"preserveFragment","preserveFragment",cr],skipLocationChange:[un.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",cr],replaceUrl:[un.HasDecoratorInputTransform,"replaceUrl","replaceUrl",cr],routerLink:"routerLink"},standalone:!0,features:[Xm,Jr]});let n=e;return n})();var nc=class{};var nA=(()=>{let e=class e{constructor(r,i,s,o,a){this.router=r,this.injector=s,this.preloadingStrategy=o,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe(pt(r=>r instanceof zt),Hr(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(r,i){let s=[];for(let o of i){o.providers&&!o._injector&&(o._injector=Nl(o.providers,r,`Route: ${o.path}`));let a=o._injector??r,c=o._loadedInjector??a;(o.loadChildren&&!o._loadedRoutes&&o.canLoad===void 0||o.loadComponent&&!o._loadedComponent)&&s.push(this.preloadConfig(a,o)),(o.children||o._loadedRoutes)&&s.push(this.processRoutes(c,o.children??o._loadedRoutes))}return de(s).pipe(Sl())}preloadConfig(r,i){return this.preloadingStrategy.preload(i,()=>{let s;i.loadChildren&&i.canLoad===void 0?s=this.loader.loadChildren(r,i):s=k(null);let o=s.pipe(at(a=>a===null?k(void 0):(i._loadedRoutes=a.routes,i._loadedInjector=a.injector,this.processRoutes(a.injector??r,a.routes))));if(i.loadComponent&&!i._loadedComponent){let a=this.loader.loadComponent(i);return de([o,a]).pipe(Sl())}else return o})}};e.\u0275fac=function(i){return new(i||e)(b(ye),b(xa),b(ms),b(nc),b(Nh))},e.\u0275prov=H({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Cv=new z(""),rA=(()=>{let e=class e{constructor(r,i,s,o,a={}){this.urlSerializer=r,this.transitions=i,this.viewportScroller=s,this.zone=o,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration||="disabled",a.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof ci?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=r.navigationTrigger,this.restoredId=r.restoredState?r.restoredState.navigationId:0):r instanceof zt?(this.lastId=r.id,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.urlAfterRedirects).fragment)):r instanceof Vn&&r.code===Ka.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof Qa&&(r.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(r.position):r.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(r.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(r,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Qa(r,this.lastSource==="popstate"?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};e.\u0275fac=function(i){Ca()},e.\u0275prov=H({token:e,factory:e.\u0275fac});let n=e;return n})();function iA(n){return n.routerState.root}function Qs(n,e){return{\u0275kind:n,\u0275providers:e}}function sA(){let n=N(Rn);return e=>{let t=n.get(Ul);if(e!==t.components[0])return;let r=n.get(ye),i=n.get(Av);n.get(Lh)===1&&r.initialNavigation(),n.get(Sv,null,Ml.Optional)?.setUpPreloading(),n.get(Cv,null,Ml.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var Av=new z("",{factory:()=>new Lt}),Lh=new z("",{providedIn:"root",factory:()=>1});function oA(){return Qs(2,[{provide:Lh,useValue:0},{provide:Ll,multi:!0,deps:[Rn],useFactory:e=>{let t=e.get(py,Promise.resolve());return()=>t.then(()=>new Promise(r=>{let i=e.get(ye),s=e.get(Av);Tv(i,()=>{r(!0)}),e.get(Fh).afterPreactivation=()=>(r(!0),s.closed?k(void 0):s),i.initialNavigation()}))}}])}function aA(){return Qs(3,[{provide:Ll,multi:!0,useFactory:()=>{let e=N(ye);return()=>{e.setUpLocationChangeListener()}}},{provide:Lh,useValue:2}])}var Sv=new z("");function cA(n){return Qs(0,[{provide:Sv,useExisting:nA},{provide:nc,useExisting:n}])}function uA(){return Qs(8,[qy,{provide:rc,useExisting:qy}])}function lA(n){let e=[{provide:wv,useValue:GC},{provide:Ev,useValue:R({skipNextTransition:!!n?.skipInitialTransition},n)}];return Qs(9,e)}var Gy=new z("ROUTER_FORROOT_GUARD"),hA=[Ts,{provide:zs,useClass:Ns},ye,Gs,{provide:ln,useFactory:iA,deps:[ye]},Nh,[]],Uh=(()=>{let e=class e{constructor(r){}static forRoot(r,i){return{ngModule:e,providers:[hA,[],{provide:tc,multi:!0,useValue:r},{provide:Gy,useFactory:gA,deps:[[ye,new rt,new zm]]},{provide:Hs,useValue:i||{}},i?.useHash?fA():pA(),dA(),i?.preloadingStrategy?cA(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?mA(i):[],i?.bindToComponentInputs?uA().\u0275providers:[],i?.enableViewTransitions?lA().\u0275providers:[],yA()]}}static forChild(r){return{ngModule:e,providers:[{provide:tc,multi:!0,useValue:r}]}}};e.\u0275fac=function(i){return new(i||e)(b(Gy,8))},e.\u0275mod=Se({type:e}),e.\u0275inj=be({});let n=e;return n})();function dA(){return{provide:Cv,useFactory:()=>{let n=N(Ey),e=N(re),t=N(Hs),r=N(Fh),i=N(zs);return t.scrollOffset&&n.setOffset(t.scrollOffset),new rA(i,r,n,e,t)}}}function fA(){return{provide:Is,useClass:my}}function pA(){return{provide:Is,useClass:gy}}function gA(n){return"guarded"}function mA(n){return[n.initialNavigation==="disabled"?aA().\u0275providers:[],n.initialNavigation==="enabledBlocking"?oA().\u0275providers:[]]}var Wy=new z("");function yA(){return[{provide:Wy,useFactory:sA},{provide:ay,multi:!0,useExisting:Wy}]}var vA="firebase",_A="10.8.0";ut(vA,_A,"app");var Wt=new Es("ANGULARFIRE2_VERSION");function ac(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Ys=(n,e)=>{let t=e?[e]:Oa(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Dt=class{constructor(){return Ys(wA)}},wA="app-check";function di(){}var oc=class{zone;delegate;constructor(e,t=Pm){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},jh=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",di,{},di,di)),t.pipe(Ve({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Nn=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new oc(Zone.current)),this.insideAngular=t.run(()=>new oc(Zone.current,va)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(b(re))};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function cc(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function EA(n){return cc().ngZone.runOutsideAngular(()=>n())}function pr(n){return cc().ngZone.run(()=>n())}function Xe(n){return IA(cc())(n)}function IA(n){return function(t){return t=t.lift(new jh(n.ngZone)),t.pipe(ar(n.outsideAngular),Tn(n.insideAngular))}}var TA=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),pr(()=>n.apply(void 0,r))},uc=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=pr(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",di,{},di,di))),r[s]=TA(r[s],t));let i=EA(()=>n.apply(this,r));if(!e)if(i instanceof In){let s=cc();return i.pipe(ar(s.outsideAngular),Tn(s.insideAngular))}else return pr(()=>i);return i instanceof In?i.pipe(Xe):i instanceof Promise?pr(()=>new Promise((s,o)=>i.then(a=>pr(()=>s(a)),a=>pr(()=>o(a))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:pr(()=>i)};var fi=class{constructor(e){return e}},pi=class{constructor(){return Oa()}};var CA=new Map,AA={activated:!1,tokenObservers:[]},SA={initialized:!1,enabled:!1};function Pt(n){return CA.get(n)||Object.assign({},AA)}function Mv(){return SA}var bA="https://content-firebaseappcheck.googleapis.com/v1";var RA="exchangeDebugToken",Rv={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},C1=24*60*60*1e3;var Bh=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return m(this,null,function*(){this.stop();try{this.pending=new $l,this.pending.promise.catch(t=>{}),yield DA(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new $l,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function DA(n){return new Promise(e=>{setTimeout(e,n)})}var PA={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},On=new by("appCheck","AppCheck",PA);function Vv(n){if(!Pt(n).activated)throw On.create("use-before-activation",{appName:n.name})}function kv(r,i){return m(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let f=yield o.getHeartbeatsHeader();f&&(s["X-Firebase-Client"]=f)}let a={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(n,a)}catch(f){throw On.create("fetch-network-error",{originalErrorMessage:f?.message})}if(c.status!==200)throw On.create("fetch-status-error",{httpStatus:c.status});let u;try{u=yield c.json()}catch(f){throw On.create("fetch-parse-error",{originalErrorMessage:f?.message})}let l=u.ttl.match(/^([\d.]+)(s)$/);if(!l||!l[2]||isNaN(Number(l[1])))throw On.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${u.ttl}`});let h=Number(l[1])*1e3,d=Date.now();return{token:u.token,expireTimeMillis:d+h,issuedAtTimeMillis:d}})}function Nv(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${bA}/projects/${t}/apps/${r}:${RA}?key=${i}`,body:{debug_token:e}}}var xA="firebase-app-check-database",MA=1,qh="firebase-app-check-store";var lc=null;function VA(){return lc||(lc=new Promise((n,e)=>{try{let t=indexedDB.open(xA,MA);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(On.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(qh,{keyPath:"compositeKey"})}}}catch(t){e(On.create("storage-open",{originalErrorMessage:t?.message}))}}),lc)}function kA(n,e){return NA(OA(n),e)}function NA(n,e){return m(this,null,function*(){let r=(yield VA()).transaction(qh,"readwrite"),s=r.objectStore(qh).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=c=>{o()},r.onerror=c=>{var u;a(On.create("storage-set",{originalErrorMessage:(u=c.target.error)===null||u===void 0?void 0:u.message}))}})})}function OA(n){return`${n.options.appId}-${n.name}`}var zh=new ka("@firebase/app-check");function $h(n,e){return Va()?kA(n,e).catch(t=>{zh.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Ov(){return Mv().enabled}function Fv(){return m(this,null,function*(){let n=Mv();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var FA={error:"UNKNOWN_ERROR"};function LA(n){return Ty.encodeString(JSON.stringify(n),!1)}function Gh(n,e=!1){return m(this,null,function*(){let t=n.app;Vv(t);let r=Pt(t),i=r.token,s;if(i&&!Xs(i)&&(r.token=void 0,i=void 0),!i){let c=yield r.cachedTokenPromise;c&&(Xs(c)?i=c:yield $h(t,void 0))}if(!e&&i&&Xs(i))return{token:i.token};let o=!1;if(Ov()){r.exchangeTokenPromise||(r.exchangeTokenPromise=kv(Nv(t,yield Fv()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let c=yield r.exchangeTokenPromise;return yield $h(t,c),r.token=c,{token:c.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield Pt(t).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?zh.warn(c.message):zh.error(c),s=c}let a;return i?s?Xs(i)?a={token:i.token,internalError:s}:a=Pv(s):(a={token:i.token},r.token=i,yield $h(t,i)):a=Pv(s),o&&BA(t,a),a})}function UA(n){return m(this,null,function*(){let e=n.app;Vv(e);let{provider:t}=Pt(e);if(Ov()){let r=yield Fv(),{token:i}=yield kv(Nv(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function jA(n,e,t,r){let{app:i}=n,s=Pt(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Xs(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),Dv(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Dv(n))}function Lv(n,e){let t=Pt(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function Dv(n){let{app:e}=n,t=Pt(e),r=t.tokenRefresher;r||(r=$A(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function $A(n){let{app:e}=n;return new Bh(()=>m(this,null,function*(){let t=Pt(e),r;if(t.token?r=yield Gh(n,!0):r=yield Gh(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=Pt(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Rv.RETRIAL_MIN_WAIT,Rv.RETRIAL_MAX_WAIT)}function BA(n,e){let t=Pt(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Xs(n){return n.expireTimeMillis-Date.now()>0}function Pv(n){return{token:LA(FA),error:n}}var Wh=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Pt(this.app);for(let t of e)Lv(this.app,t.next);return Promise.resolve()}};function qA(n,e){return new Wh(n,e)}function zA(n){return{getToken:e=>Gh(n,e),getLimitedUseToken:()=>UA(n),addTokenListener:e=>jA(n,"INTERNAL",e),removeTokenListener:e=>Lv(n.app,e)}}var GA="@firebase/app-check",WA="0.8.2";var KA="app-check",xv="app-check-internal";function HA(){As(new hr(KA,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return qA(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(xv).initialize()})),As(new hr(xv,n=>{let e=n.getProvider("app-check").getImmediate();return zA(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),ut(GA,WA)}HA();var QA=["localhost","0.0.0.0","127.0.0.1"],O1=typeof window<"u"&&QA.includes(window.location.hostname);var YA="firebase",XA="10.8.0";st.registerVersion(YA,XA,"app-compat");var JA=["ngOnDestroy"],$v=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(JA.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let c=a?.[s];return typeof c=="function"?c.bind(a):c?.then?c.then(u=>t.run(()=>u)):t.run(()=>c)});return new Proxy(()=>{},{get:(a,c)=>o[c],apply:(a,c,u)=>o.then(l=>{let h=l?.(...u);return r?.spy?.apply&&r.spy.apply(s,u,h),h})})})});var hc=class{constructor(e){return e}},gi=new z("angularfire2.app.options"),mi=new z("angularfire2.app.name");function Js(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=st.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>st.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;ZA("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new hc(o)}var ZA=(n,...e)=>{jl()&&typeof console<"u"&&console[n](...e)},eS={provide:hc,useFactory:Js,deps:[gi,re,[new rt,mi]]},Bv=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:gi,useValue:t},{provide:mi,useValue:r}]}}constructor(t){st.registerVersion("angularfire",Wt.full,"core"),st.registerVersion("angularfire",Wt.full,"app-compat"),st.registerVersion("angular",sy.full,t.toString())}static \u0275fac=function(r){return new(r||n)(b(At))};static \u0275mod=Se({type:n});static \u0275inj=be({providers:[eS]})}return n})();function dc(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return tS(i,o)||(jv("error",`${e} was already initialized on the ${t} Firebase App with different settings.${nS?" You may need to reload as Firebase is not HMR aware.":""}`),jv("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function tS(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var nS=typeof module<"u"&&!!module.hot,jv=(n,...e)=>{jl()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Kh=new z("angularfire2.auth.use-emulator"),Hh=new z("angularfire2.auth.settings"),Qh=new z("angularfire2.auth.tenant-id"),Yh=new z("angularfire2.auth.langugage-code"),Xh=new z("angularfire2.auth.use-device-language"),Jh=new z("angularfire.auth.persistence"),Zh=(n,e,t,r,i,s,o,a)=>dc(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let c=e.runOutsideAngular(()=>n.auth());if(t&&c.useEmulator(...t),r&&(c.tenantId=r),c.languageCode=i,s&&c.useDeviceLanguage(),o)for(let[u,l]of Object.entries(o))c.settings[u]=l;return a&&c.setPersistence(a),c},[t,r,i,s,o,a]),gr=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,c,u,l,h,d,f){let E=new Lt,w=k(void 0).pipe(Tn(o.outsideAngular),Ne(()=>s.runOutsideAngular(()=>import("./chunk-BFNZ6PW5.js"))),j(()=>Js(t,s,r)),j(_=>Zh(_,s,a,u,l,h,c,d)),Pl({bufferSize:1,refCount:!1}));if(lr(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=k(null);else{w.pipe(Ut()).subscribe();let _=w.pipe(Ne(D=>D.getRedirectResult().then(W=>W,()=>null)),Xe,Pl({bufferSize:1,refCount:!1})),M=w.pipe(Ne(D=>new In(W=>({unsubscribe:s.runOutsideAngular(()=>D.onAuthStateChanged(K=>W.next(K),K=>W.error(K),()=>W.complete()))})))),$=w.pipe(Ne(D=>new In(W=>({unsubscribe:s.runOutsideAngular(()=>D.onIdTokenChanged(K=>W.next(K),K=>W.error(K),()=>W.complete()))}))));this.authState=_.pipe(xl(M),ar(o.outsideAngular),Tn(o.insideAngular)),this.user=_.pipe(xl($),ar(o.outsideAngular),Tn(o.insideAngular)),this.idToken=this.user.pipe(Ne(D=>D?de(D.getIdToken()):k(null))),this.idTokenResult=this.user.pipe(Ne(D=>D?de(D.getIdTokenResult()):k(null))),this.credential=Nm(_,E,this.authState.pipe(pt(D=>!D))).pipe(j(D=>D?.user?D:null),ar(o.outsideAngular),Tn(o.insideAngular))}return $v(this,w,s,{spy:{apply:(_,M,$)=>{(_.startsWith("signIn")||_.startsWith("createUser"))&&$.then(D=>E.next(D))}}})}static \u0275fac=function(r){return new(r||n)(b(gi),b(mi,8),b(At),b(re),b(Nn),b(Kh,8),b(Hh,8),b(Qh,8),b(Yh,8),b(Xh,8),b(Jh,8),b(Dt,8))};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),qv=(()=>{class n{constructor(){st.registerVersion("angularfire",Wt.full,"auth-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Se({type:n});static \u0275inj=be({providers:[gr]})}return n})();var Fn=(()=>{let e=class e{constructor(r,i){this.afAuth=r,this.router=i,this.authState$=this.afAuth.authState}login(r,i){return this.afAuth.signInWithEmailAndPassword(r,i)}register(r,i,s){return this.afAuth.createUserWithEmailAndPassword(r,i).then(o=>{if(o?.user)return o.user.updateProfile({displayName:s});throw new Error("User is null")})}logout(){this.afAuth.signOut().then(()=>{this.router.navigate(["/home"])})}isAuthenticated(){return this.afAuth.authState!==null}};e.\u0275fac=function(i){return new(i||e)(b(gr),b(ye))},e.\u0275prov=H({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Zv=(()=>{let e=class e{constructor(r,i){this._renderer=r,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(r,i){this._renderer.setProperty(this._elementRef.nativeElement,r,i)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}};e.\u0275fac=function(i){return new(i||e)(L(vs),L(ps))},e.\u0275dir=nt({type:e});let n=e;return n})(),rS=(()=>{let e=class e extends Zv{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Zr(e)))(s||e)}})(),e.\u0275dir=nt({type:e,features:[Dn]});let n=e;return n})(),e_=new z("");var iS={provide:e_,useExisting:gs(()=>Ln),multi:!0};function sS(){let n=ur()?ur().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var oS=new z(""),Ln=(()=>{let e=class e extends Zv{constructor(r,i,s){super(r,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!sS())}writeValue(r){let i=r??"";this.setProperty("value",i)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}};e.\u0275fac=function(i){return new(i||e)(L(vs),L(ps),L(oS,8))},e.\u0275dir=nt({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&Ee("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[ws([iS]),Dn]});let n=e;return n})();function aS(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}var nd=new z(""),t_=new z("");function cS(n){return aS(n.value)?{required:!0}:null}function Gv(n){return null}function n_(n){return n!=null}function r_(n){return Pa(n)?de(n):n}function i_(n){let e={};return n.forEach(t=>{e=t!=null?R(R({},e),t):e}),Object.keys(e).length===0?null:e}function s_(n,e){return e.map(t=>t(n))}function uS(n){return!n.validate}function o_(n){return n.map(e=>uS(e)?e:t=>e.validate(t))}function lS(n){if(!n)return null;let e=n.filter(n_);return e.length==0?null:function(t){return i_(s_(t,e))}}function rd(n){return n!=null?lS(o_(n)):null}function hS(n){if(!n)return null;let e=n.filter(n_);return e.length==0?null:function(t){let r=s_(t,e).map(r_);return km(r).pipe(j(i_))}}function id(n){return n!=null?hS(o_(n)):null}function Wv(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function dS(n){return n._rawValidators}function fS(n){return n._rawAsyncValidators}function td(n){return n?Array.isArray(n)?n:[n]:[]}function pc(n,e){return Array.isArray(n)?n.includes(e):n===e}function Kv(n,e){let t=td(e);return td(n).forEach(i=>{pc(t,i)||t.push(i)}),t}function Hv(n,e){return td(e).filter(t=>!pc(n,t))}var gc=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=rd(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=id(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},vi=class extends gc{get formDirective(){return null}get path(){return null}},no=class extends gc{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},mc=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},pS={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},IM=ue(R({},pS),{"[class.ng-submitted]":"isSubmitted"}),_i=(()=>{let e=class e extends mc{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(L(no,2))},e.\u0275dir=nt({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&Ol("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[Dn]});let n=e;return n})(),a_=(()=>{let e=class e extends mc{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(L(vi,10))},e.\u0275dir=nt({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,s){i&2&&Ol("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[Dn]});let n=e;return n})();var Zs="VALID",fc="INVALID",yi="PENDING",eo="DISABLED";function c_(n){return(_c(n)?n.validators:n)||null}function gS(n){return Array.isArray(n)?rd(n):n||null}function u_(n,e){return(_c(e)?e.asyncValidators:n)||null}function mS(n){return Array.isArray(n)?id(n):n||null}function _c(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function yS(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new oe(1e3,"");if(!r[t])throw new oe(1001,"")}function vS(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new oe(1002,"")})}var yc=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Zs}get invalid(){return this.status===fc}get pending(){return this.status==yi}get disabled(){return this.status===eo}get enabled(){return this.status!==eo}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(Kv(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(Kv(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(Hv(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(Hv(e,this._rawAsyncValidators))}hasValidator(e){return pc(this._rawValidators,e)}hasAsyncValidator(e){return pc(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=yi,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=eo,this.errors=null,this._forEachChild(r=>{r.disable(ue(R({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(ue(R({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Zs,this._forEachChild(r=>{r.enable(ue(R({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(ue(R({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Zs||this.status===yi)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?eo:Zs}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=yi,this._hasOwnPendingAsyncValidator=!0;let t=r_(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new jt,this.statusChanges=new jt}_calculateStatus(){return this._allControlsDisabled()?eo:this.errors?fc:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(yi)?yi:this._anyControlsHaveStatus(fc)?fc:Zs}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){_c(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=gS(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=mS(this._rawAsyncValidators)}},vc=class extends yc{constructor(e,t,r){super(c_(t),u_(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){vS(this,!0,e),Object.keys(e).forEach(r=>{yS(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var sd=new z("CallSetDisabledState",{providedIn:"root",factory:()=>od}),od="always";function _S(n,e){return[...e.path,n]}function l_(n,e,t=od){h_(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),ES(n,e),TS(n,e),IS(n,e),wS(n,e)}function Qv(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function wS(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function h_(n,e){let t=dS(n);e.validator!==null?n.setValidators(Wv(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=fS(n);e.asyncValidator!==null?n.setAsyncValidators(Wv(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();Qv(e._rawValidators,i),Qv(e._rawAsyncValidators,i)}function ES(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&d_(n,e)})}function IS(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&d_(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function d_(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function TS(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function CS(n,e){n==null,h_(n,e)}function AS(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function SS(n){return Object.getPrototypeOf(n.constructor)===rS}function bS(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function RS(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===Ln?t=s:SS(s)?r=s:i=s}),i||r||t||null}var DS={provide:vi,useExisting:gs(()=>ad)},to=Promise.resolve(),ad=(()=>{let e=class e extends vi{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._directives=new Set,this.ngSubmit=new jt,this.form=new vc({},rd(r),id(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(r){to.then(()=>{let i=this._findContainer(r.path);r.control=i.registerControl(r.name,r.control),l_(r.control,r,this.callSetDisabledState),r.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(r)})}getControl(r){return this.form.get(r.path)}removeControl(r){to.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name),this._directives.delete(r)})}addFormGroup(r){to.then(()=>{let i=this._findContainer(r.path),s=new vc({});CS(s,r),i.registerControl(r.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(r){to.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name)})}getFormGroup(r){return this.form.get(r.path)}updateModel(r,i){to.then(()=>{this.form.get(r.path).setValue(i)})}setValue(r){this.control.setValue(r)}onSubmit(r){return this.submitted=!0,bS(this.form,this._directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(r){return r.pop(),r.length?this.form.get(r):this.form}};e.\u0275fac=function(i){return new(i||e)(L(nd,10),L(t_,10),L(sd,8))},e.\u0275dir=nt({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,s){i&1&&Ee("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{options:[un.None,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ws([DS]),Dn]});let n=e;return n})();function Yv(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function Xv(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var PS=class extends yc{constructor(e=null,t,r){super(c_(t),u_(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),_c(t)&&(t.nonNullable||t.initialValueIsDefault)&&(Xv(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){Yv(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){Yv(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){Xv(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var xS={provide:no,useExisting:gs(()=>mr)},Jv=Promise.resolve(),mr=(()=>{let e=class e extends no{constructor(r,i,s,o,a,c){super(),this._changeDetectorRef=a,this.callSetDisabledState=c,this.control=new PS,this._registered=!1,this.name="",this.update=new jt,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=RS(this,o)}ngOnChanges(r){if(this._checkForErrors(),!this._registered||"name"in r){if(this._registered&&(this._checkName(),this.formDirective)){let i=r.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in r&&this._updateDisabled(r),AS(r,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){l_(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(r){Jv.then(()=>{this.control.setValue(r,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(r){let i=r.isDisabled.currentValue,s=i!==0&&cr(i);Jv.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(r){return this._parent?_S(r,this._parent):[r]}};e.\u0275fac=function(i){return new(i||e)(L(vi,9),L(nd,10),L(t_,10),L(e_,10),L(_s,8),L(sd,8))},e.\u0275dir=nt({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[un.None,"disabled","isDisabled"],model:[un.None,"ngModel","model"],options:[un.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[ws([xS]),Dn,Jr]});let n=e;return n})(),f_=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=nt({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let n=e;return n})();var MS=(()=>{let e=class e{constructor(){this._validator=Gv}ngOnChanges(r){if(this.inputName in r){let i=this.normalizeInput(r[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):Gv,this._onChange&&this._onChange()}}validate(r){return this._validator(r)}registerOnValidatorChange(r){this._onChange=r}enabled(r){return r!=null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=nt({type:e,features:[Jr]});let n=e;return n})();var VS={provide:nd,useExisting:gs(()=>cd),multi:!0};var cd=(()=>{let e=class e extends MS{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=cr,this.createValidator=r=>cS}enabled(r){return r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Zr(e)))(s||e)}})(),e.\u0275dir=nt({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(i,s){i&2&&Sa("required",s._enabled?"":null)},inputs:{required:"required"},features:[ws([VS]),Dn]});let n=e;return n})();var kS=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Se({type:e}),e.\u0275inj=be({});let n=e;return n})();var p_=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:sd,useValue:r.callSetDisabledState??od}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Se({type:e}),e.\u0275inj=be({imports:[kS]});let n=e;return n})();function NS(n,e){if(n&1&&(A(0,"div",12),O(1),P()),n&2){let t=Ye();F(),gt(t.errorMessage)}}var g_=(()=>{let e=class e{constructor(r,i){this.authService=r,this.router=i}login(){this.authService.login(this.email,this.password).then(()=>{this.router.navigate(["/home"])}).catch(r=>{switch(r.code){case"auth/user-not-found":this.errorMessage="User not found. Please check your email or register for an account.";break;case"auth/wrong-password":this.errorMessage="Incorrect password. Please try again or reset your password.";break;case"auth/too-many-requests":this.errorMessage="Too many login attempts. Please try again later.";break;default:this.errorMessage="An error occurred during login. Please try again later.";break}})}};e.\u0275fac=function(i){return new(i||e)(L(Fn),L(ye))},e.\u0275cmp=me({type:e,selectors:[["app-login"]],decls:21,vars:4,consts:[[1,"login-area"],[1,"login-container"],[1,"form-group"],["for","email"],["type","email","id","email","name","email","required","",3,"ngModel","ngModelChange"],["for","password"],["type","password","id","password","name","password","required","",3,"ngModel","ngModelChange"],[1,"login-btn"],[3,"disabled","click"],["class","login-error","style","color: red;",4,"ngIf"],[1,"login-question"],["routerLink","/register"],[1,"login-error",2,"color","red"]],template:function(i,s){i&1&&(A(0,"div",0)(1,"div",1)(2,"h2"),O(3,"Login"),P(),A(4,"form")(5,"div",2)(6,"label",3),O(7,"Email:"),P(),A(8,"input",4),Rt("ngModelChange",function(a){return bt(s.email,a)||(s.email=a),a}),P()(),A(9,"div",2)(10,"label",5),O(11,"Password:"),P(),A(12,"input",6),Rt("ngModelChange",function(a){return bt(s.password,a)||(s.password=a),a}),P()(),A(13,"div",7)(14,"button",8),Ee("click",function(){return s.login()}),O(15,"Login"),P()()(),Qe(16,NS,2,1,"div",9),A(17,"div",10),O(18," Don't have an account? "),A(19,"a",11),O(20,"Register"),P()()()()),i&2&&(F(8),St("ngModel",s.email),F(4),St("ngModel",s.password),F(2),le("disabled",!s.email||!s.password),F(2),le("ngIf",s.errorMessage))},dependencies:[$t,sc,f_,Ln,_i,a_,cd,mr,ad],styles:['.login-area[_ngcontent-%COMP%]{background-image:url("./media/background_primaPagina-VNXITWOT.jpg");background-size:cover;background-repeat:no-repeat;background-position:center center;width:100%;height:100%;position:fixed;overflow:auto}.login-container[_ngcontent-%COMP%]{max-width:400px;margin:5% auto auto;padding:20px;border:1px solid #ccc;border-radius:5px;box-shadow:0 0 10px #0000001a;background-color:#fde8a9}.form-group[_ngcontent-%COMP%]{margin-top:15px}label[_ngcontent-%COMP%]{display:block;margin-bottom:5px}input[_ngcontent-%COMP%]{background-color:#ffffe0;width:100%;padding:8px;box-sizing:border-box;border:1px solid #ccc;border-radius:4px}button[_ngcontent-%COMP%]{background-color:#8bd7cf;font-size:30px;color:#000;padding:10px 15px;border-color:#000;border-radius:3px;border-width:2px;cursor:pointer;width:65%;margin-top:10%}.login-btn[_ngcontent-%COMP%]{display:flex;justify-content:center}button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}@font-face{font-family:myFont;src:url("./media/IndieFlower-Regular-MMQ6D5WT.ttf")}*[_ngcontent-%COMP%]{box-sizing:border-box;font-family:myFont,sans-serif;font-size:1.05em}.login-question[_ngcontent-%COMP%]{margin-top:10px;text-align:center}a[_ngcontent-%COMP%]{text-decoration:none}']});let n=e;return n})();function OS(n,e){if(n&1&&(A(0,"div",12),O(1),P()),n&2){let t=Ye();F(),gt(t.errorMessage)}}var m_=(()=>{let e=class e{constructor(r,i){this.authService=r,this.router=i}register(){this.authService.register(this.email,this.password,this.username).then(()=>{this.router.navigate(["/home"])}).catch(r=>{r.code==="auth/email-already-in-use"?this.errorMessage="Email is already in use.":this.errorMessage=r.message})}};e.\u0275fac=function(i){return new(i||e)(L(Fn),L(ye))},e.\u0275cmp=me({type:e,selectors:[["app-register"]],decls:20,vars:5,consts:[[1,"registration-area"],[1,"registration-container"],[1,"form-group"],["for","email"],["type","email","id","email","placeholder","Enter email",3,"ngModel","ngModelChange"],["for","password"],["type","password","id","password","placeholder","Enter password",3,"ngModel","ngModelChange"],["for","username"],["type","text","id","username","placeholder","Enter username",3,"ngModel","ngModelChange"],[1,"register-btn"],[3,"disabled","click"],["style","color: red;",4,"ngIf"],[2,"color","red"]],template:function(i,s){i&1&&(A(0,"div",0)(1,"div",1)(2,"h2"),O(3,"Register"),P(),A(4,"div",2)(5,"label",3),O(6,"Email:"),P(),A(7,"input",4),Rt("ngModelChange",function(a){return bt(s.email,a)||(s.email=a),a}),P()(),A(8,"div",2)(9,"label",5),O(10,"Password:"),P(),A(11,"input",6),Rt("ngModelChange",function(a){return bt(s.password,a)||(s.password=a),a}),P()(),A(12,"div",2)(13,"label",7),O(14,"Username:"),P(),A(15,"input",8),Rt("ngModelChange",function(a){return bt(s.username,a)||(s.username=a),a}),P()(),A(16,"div",9)(17,"button",10),Ee("click",function(){return s.register()}),O(18,"Register"),P()(),Qe(19,OS,2,1,"div",11),P()()),i&2&&(F(7),St("ngModel",s.email),F(4),St("ngModel",s.password),F(4),St("ngModel",s.username),F(2),le("disabled",!s.email||!s.password||!s.username),F(2),le("ngIf",s.errorMessage))},dependencies:[$t,Ln,_i,mr],styles:['.registration-area[_ngcontent-%COMP%]{background-image:url("./media/background_primaPagina-VNXITWOT.jpg");background-size:cover;background-repeat:no-repeat;background-position:center center;width:100%;height:100%;position:fixed;overflow:auto}.registration-container[_ngcontent-%COMP%]{max-width:400px;margin:15px auto;padding:20px;border:1px solid #ccc;border-radius:5px;box-shadow:0 0 10px #0000001a;background-color:#fde8a9}.form-group[_ngcontent-%COMP%]{margin-top:15px}label[_ngcontent-%COMP%]{display:block;margin-bottom:5px}input[_ngcontent-%COMP%]{background-color:#ffffe0;width:100%;padding:8px;box-sizing:border-box;border:1px solid #ccc;border-radius:4px}button[_ngcontent-%COMP%]{background-color:#8bd7cf;font-size:30px;color:#000;padding:10px 15px;border-color:#000;border-radius:3px;border-width:2px;cursor:pointer;width:65%;margin-top:10%}.register-btn[_ngcontent-%COMP%]{display:flex;justify-content:center}button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}@font-face{font-family:myFont;src:url("./media/IndieFlower-Regular-MMQ6D5WT.ttf")}*[_ngcontent-%COMP%]{box-sizing:border-box;font-family:myFont,sans-serif;font-size:1.05em}']});let n=e;return n})();var FS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Mt={},T,xd=xd||{},U=FS||self;function Vc(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function yo(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function LS(n){return Object.prototype.hasOwnProperty.call(n,ld)&&n[ld]||(n[ld]=++US)}var ld="closure_uid_"+(1e9*Math.random()>>>0),US=0;function jS(n,e,t){return n.call.apply(n.bind,arguments)}function $S(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function ze(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?ze=jS:ze=$S,ze.apply(null,arguments)}function wc(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function Le(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function Un(){this.s=this.s,this.o=this.o}var BS=0;Un.prototype.s=!1;Un.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),BS!=0)&&LS(this)};Un.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var D_=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Md(n){let e=n.length;if(0<e){let t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function y_(n,e){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(Vc(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function Ge(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Ge.prototype.h=function(){this.defaultPrevented=!0};var qS=function(){if(!U.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let t=()=>{};U.addEventListener("test",t,e),U.removeEventListener("test",t,e)}catch{}return n}();function co(n){return/^[\s\xa0]*$/.test(n)}function kc(){var n=U.navigator;return n&&(n=n.userAgent)?n:""}function Kt(n){return kc().indexOf(n)!=-1}function Vd(n){return Vd[" "](n),n}Vd[" "]=function(){};function zS(n,e){var t=Mb;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var GS=Kt("Opera"),Ti=Kt("Trident")||Kt("MSIE"),P_=Kt("Edge"),gd=P_||Ti,x_=Kt("Gecko")&&!(kc().toLowerCase().indexOf("webkit")!=-1&&!Kt("Edge"))&&!(Kt("Trident")||Kt("MSIE"))&&!Kt("Edge"),WS=kc().toLowerCase().indexOf("webkit")!=-1&&!Kt("Edge");function M_(){var n=U.document;return n?n.documentMode:void 0}var md;e:{if(Ec="",Ic=function(){var n=kc();if(x_)return/rv:([^\);]+)(\)|;)/.exec(n);if(P_)return/Edge\/([\d\.]+)/.exec(n);if(Ti)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(WS)return/WebKit\/(\S+)/.exec(n);if(GS)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),Ic&&(Ec=Ic?Ic[1]:""),Ti&&(Tc=M_(),Tc!=null&&Tc>parseFloat(Ec))){md=String(Tc);break e}md=Ec}var Ec,Ic,Tc,yd;U.document&&Ti?(hd=M_(),yd=hd||parseInt(md,10)||void 0):yd=void 0;var hd,KS=yd;function uo(n,e){if(Ge.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(x_){e:{try{Vd(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:HS[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&uo.$.h.call(this)}}Le(uo,Ge);var HS={2:"touch",3:"pen",4:"mouse"};uo.prototype.h=function(){uo.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var vo="closure_listenable_"+(1e6*Math.random()|0),QS=0;function YS(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++QS,this.fa=this.ia=!1}function Nc(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function kd(n,e,t){for(let r in n)e.call(t,n[r],r,n)}function XS(n,e){for(let t in n)e.call(void 0,n[t],t,n)}function V_(n){let e={};for(let t in n)e[t]=n[t];return e}var v_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function k_(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<v_.length;s++)t=v_[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Oc(n){this.src=n,this.g={},this.h=0}Oc.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=_d(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new YS(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function vd(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=D_(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Nc(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function _d(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var Nd="closure_lm_"+(1e6*Math.random()|0),dd={};function N_(n,e,t,r,i){if(r&&r.once)return F_(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)N_(n,e[s],t,r,i);return null}return t=Ld(t),n&&n[vo]?n.O(e,t,yo(r)?!!r.capture:!!r,i):O_(n,e,t,!1,r,i)}function O_(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=yo(i)?!!i.capture:!!i,a=Fd(n);if(a||(n[Nd]=a=new Oc(n)),t=a.add(e,t,r,o,s),t.proxy)return t;if(r=JS(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)qS||(i=o),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(U_(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function JS(){function n(t){return e.call(n.src,n.listener,t)}let e=ZS;return n}function F_(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)F_(n,e[s],t,r,i);return null}return t=Ld(t),n&&n[vo]?n.P(e,t,yo(r)?!!r.capture:!!r,i):O_(n,e,t,!0,r,i)}function L_(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)L_(n,e[s],t,r,i);else r=yo(r)?!!r.capture:!!r,t=Ld(t),n&&n[vo]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=_d(s,t,r,i),-1<t&&(Nc(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=Fd(n))&&(e=n.g[e.toString()],n=-1,e&&(n=_d(e,t,r,i)),(t=-1<n?e[n]:null)&&Od(t))}function Od(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[vo])vd(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(U_(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Fd(e))?(vd(t,n),t.h==0&&(t.src=null,e[Nd]=null)):Nc(n)}}}function U_(n){return n in dd?dd[n]:dd[n]="on"+n}function ZS(n,e){if(n.fa)n=!0;else{e=new uo(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Od(n),n=t.call(r,e)}return n}function Fd(n){return n=n[Nd],n instanceof Oc?n:null}var fd="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ld(n){return typeof n=="function"?n:(n[fd]||(n[fd]=function(e){return n.handleEvent(e)}),n[fd])}function Fe(){Un.call(this),this.i=new Oc(this),this.S=this,this.J=null}Le(Fe,Un);Fe.prototype[vo]=!0;Fe.prototype.removeEventListener=function(n,e,t,r){L_(this,n,e,t,r)};function Be(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new Ge(e,n);else if(e instanceof Ge)e.target=e.target||n;else{var i=e;e=new Ge(r,n),k_(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=Cc(o,r,!0,e)&&i}if(o=e.g=n,i=Cc(o,r,!0,e)&&i,i=Cc(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)o=e.g=t[s],i=Cc(o,r,!1,e)&&i}Fe.prototype.N=function(){if(Fe.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Nc(t[r]);delete n.g[e],n.h--}}this.J=null};Fe.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};Fe.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function Cc(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,c=o.la||o.src;o.ia&&vd(n.i,o),i=a.call(c,r)!==!1&&i}}return i&&!r.defaultPrevented}var Ud=U.JSON.stringify,wd=class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function eb(){var n=jd;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Ed=class{constructor(){this.h=this.g=null}add(e,t){let r=j_.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},j_=new wd(()=>new Id,n=>n.reset()),Id=class{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}};function tb(n){var e=1;n=n.split(":");let t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function nb(n){U.setTimeout(()=>{throw n},0)}var lo,ho=!1,jd=new Ed,$_=()=>{let n=U.Promise.resolve(void 0);lo=()=>{n.then(rb)}},rb=()=>{for(var n;n=eb();){try{n.h.call(n.g)}catch(t){nb(t)}var e=j_;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}ho=!1};function Fc(n,e){Fe.call(this),this.h=n||1,this.g=e||U,this.j=ze(this.qb,this),this.l=Date.now()}Le(Fc,Fe);T=Fc.prototype;T.ga=!1;T.T=null;T.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Be(this,"tick"),this.ga&&($d(this),this.start()))}};T.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function $d(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}T.N=function(){Fc.$.N.call(this),$d(this),delete this.g};function Bd(n,e,t){if(typeof n=="function")t&&(n=ze(n,t));else if(n&&typeof n.handleEvent=="function")n=ze(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:U.setTimeout(n,e||0)}function B_(n){n.g=Bd(()=>{n.g=null,n.i&&(n.i=!1,B_(n))},n.j);let e=n.h;n.h=null,n.m.apply(null,e)}var Td=class extends Un{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:B_(this)}N(){super.N(),this.g&&(U.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function fo(n){Un.call(this),this.h=n,this.g={}}Le(fo,Un);var __=[];function q_(n,e,t,r){Array.isArray(t)||(t&&(__[0]=t.toString()),t=__);for(var i=0;i<t.length;i++){var s=N_(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function z_(n){kd(n.g,function(e,t){this.g.hasOwnProperty(t)&&Od(e)},n),n.g={}}fo.prototype.N=function(){fo.$.N.call(this),z_(this)};fo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Lc(){this.g=!0}Lc.prototype.Ea=function(){this.g=!1};function ib(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+u+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+o})}function sb(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+o})}function Ei(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+ab(n,t)+(r?" "+r:"")})}function ob(n,e){n.info(function(){return"TIMEOUT: "+e})}Lc.prototype.info=function(){};function ab(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return Ud(t)}catch{return e}}var wr={},w_=null;function Uc(){return w_=w_||new Fe}wr.Ta="serverreachability";function G_(n){Ge.call(this,wr.Ta,n)}Le(G_,Ge);function po(n){let e=Uc();Be(e,new G_(e))}wr.STAT_EVENT="statevent";function W_(n,e){Ge.call(this,wr.STAT_EVENT,n),this.stat=e}Le(W_,Ge);function Je(n){let e=Uc();Be(e,new W_(e,n))}wr.Ua="timingevent";function K_(n,e){Ge.call(this,wr.Ua,n),this.size=e}Le(K_,Ge);function _o(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return U.setTimeout(function(){n()},e)}var jc={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},H_={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function qd(){}qd.prototype.h=null;function E_(n){return n.h||(n.h=n.i())}function Q_(){}var wo={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function zd(){Ge.call(this,"d")}Le(zd,Ge);function Gd(){Ge.call(this,"c")}Le(Gd,Ge);var Cd;function $c(){}Le($c,qd);$c.prototype.g=function(){return new XMLHttpRequest};$c.prototype.i=function(){return{}};Cd=new $c;function Eo(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new fo(this),this.P=cb,n=gd?125:void 0,this.V=new Fc(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Y_}function Y_(){this.i=null,this.g="",this.h=!1}var cb=45e3,X_={},Ad={};T=Eo.prototype;T.setTimeout=function(n){this.P=n};function Sd(n,e,t){n.L=1,n.A=qc(fn(e)),n.u=t,n.S=!0,J_(n,null)}function J_(n,e){n.G=Date.now(),Io(n),n.B=fn(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),ow(t.i,"t",r),n.o=0,t=n.l.J,n.h=new Y_,n.g=bw(n.l,t?e:null,!n.u),0<n.O&&(n.M=new Td(ze(n.Pa,n,n.g),n.O)),q_(n.U,n.g,"readystatechange",n.nb),e=n.I?V_(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),po(),ib(n.j,n.v,n.B,n.m,n.W,n.u)}T.nb=function(n){n=n.target;let e=this.M;e&&Ht(n)==3?e.l():this.Pa(n)};T.Pa=function(n){try{if(n==this.g)e:{let l=Ht(this.g);var e=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||gd||this.g&&(this.h.h||this.g.ja()||A_(this.g)))){this.J||l!=4||e==7||(e==8||0>=h?po(3):po(2)),Bc(this);var t=this.g.da();this.ca=t;t:if(Z_(this)){var r=A_(this.g);n="";var i=r.length,s=Ht(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){yr(this),ao(this);var o="";break t}this.h.i=new U.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,sb(this.j,this.v,this.B,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!co(a)){var u=a;break t}}u=null}if(t=u)Ei(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,bd(this,t);else{this.i=!1,this.s=3,Je(12),yr(this),ao(this);break e}}this.S?(ew(this,l,o),gd&&this.i&&l==3&&(q_(this.U,this.V,"tick",this.mb),this.V.start())):(Ei(this.j,this.m,o,null),bd(this,o)),l==4&&yr(this),this.i&&!this.J&&(l==4?Tw(this.l,this):(this.i=!1,Io(this)))}else Db(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,Je(12)):(this.s=0,Je(13)),yr(this),ao(this)}}}catch{}finally{}};function Z_(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function ew(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=ub(n,t),i==Ad){e==4&&(n.s=4,Je(14),r=!1),Ei(n.j,n.m,null,"[Incomplete Response]");break}else if(i==X_){n.s=4,Je(15),Ei(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else Ei(n.j,n.m,i,null),bd(n,i);Z_(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,Je(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Xd(e),e.M=!0,Je(11))):(Ei(n.j,n.m,t,"[Invalid Chunked Response]"),yr(n),ao(n))}T.mb=function(){if(this.g){var n=Ht(this.g),e=this.g.ja();this.o<e.length&&(Bc(this),ew(this,n,e),this.i&&n!=4&&Io(this))}};function ub(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?Ad:(t=Number(e.substring(t,r)),isNaN(t)?X_:(r+=1,r+t>e.length?Ad:(e=e.slice(r,r+t),n.o=r+t,e)))}T.cancel=function(){this.J=!0,yr(this)};function Io(n){n.Y=Date.now()+n.P,tw(n,n.P)}function tw(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=_o(ze(n.lb,n),e)}function Bc(n){n.C&&(U.clearTimeout(n.C),n.C=null)}T.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(ob(this.j,this.B),this.L!=2&&(po(),Je(17)),yr(this),this.s=2,ao(this)):tw(this,this.Y-n)};function ao(n){n.l.H==0||n.J||Tw(n.l,n)}function yr(n){Bc(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,$d(n.V),z_(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function bd(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||Rd(t.i,n))){if(!n.K&&Rd(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)Dc(t),Wc(t);else break e;Yd(t),Je(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=_o(ze(t.ib,t),6e3));if(1>=uw(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else vr(t,11)}else if((n.K||t.g==n)&&Dc(t),!co(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let u=i[e];if(t.V=u[0],u=u[1],t.H==2)if(u[0]=="c"){t.K=u[1],t.pa=u[2];let l=u[3];l!=null&&(t.ra=l,t.l.info("VER="+t.ra));let h=u[4];h!=null&&(t.Ga=h,t.l.info("SVER="+t.Ga));let d=u[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;let f=n.g;if(f){let E=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(E){var s=r.i;s.g||E.indexOf("spdy")==-1&&E.indexOf("quic")==-1&&E.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(Wd(s,s.h),s.h=null))}if(r.F){let w=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;w&&(r.Da=w,ae(r.I,r.F,w))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var o=n;if(r.wa=Sw(r,r.J?r.pa:null,r.Y),o.K){lw(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(Bc(a),Io(a)),r.g=o}else Ew(r);0<t.j.length&&Kc(t)}else u[0]!="stop"&&u[0]!="close"||vr(t,7);else t.H==3&&(u[0]=="stop"||u[0]=="close"?u[0]=="stop"?vr(t,7):Qd(t):u[0]!="noop"&&t.h&&t.h.Aa(u),t.A=0)}}po(4)}catch{}}function lb(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(Vc(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function hb(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Vc(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(let r in n)e[t++]=r;return e}}}function nw(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(Vc(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=hb(n),r=lb(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var rw=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function db(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function _r(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof _r){this.h=n.h,bc(this,n.j),this.s=n.s,this.g=n.g,Rc(this,n.m),this.l=n.l;var e=n.i,t=new go;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),I_(this,t),this.o=n.o}else n&&(e=String(n).match(rw))?(this.h=!1,bc(this,e[1]||"",!0),this.s=so(e[2]||""),this.g=so(e[3]||"",!0),Rc(this,e[4]),this.l=so(e[5]||"",!0),I_(this,e[6]||"",!0),this.o=so(e[7]||"")):(this.h=!1,this.i=new go(null,this.h))}_r.prototype.toString=function(){var n=[],e=this.j;e&&n.push(oo(e,T_,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(oo(e,T_,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(oo(t,t.charAt(0)=="/"?gb:pb,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",oo(t,yb)),n.join("")};function fn(n){return new _r(n)}function bc(n,e,t){n.j=t?so(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Rc(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function I_(n,e,t){e instanceof go?(n.i=e,vb(n.i,n.h)):(t||(e=oo(e,mb)),n.i=new go(e,n.h))}function ae(n,e,t){n.i.set(e,t)}function qc(n){return ae(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function so(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function oo(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,fb),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function fb(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var T_=/[#\/\?@]/g,pb=/[#\?:]/g,gb=/[#\?]/g,mb=/[#\?@]/g,yb=/#/g;function go(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function jn(n){n.g||(n.g=new Map,n.h=0,n.i&&db(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}T=go.prototype;T.add=function(n,e){jn(this),this.i=null,n=Ci(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function iw(n,e){jn(n),e=Ci(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function sw(n,e){return jn(n),e=Ci(n,e),n.g.has(e)}T.forEach=function(n,e){jn(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};T.ta=function(){jn(this);let n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){let i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};T.Z=function(n){jn(this);let e=[];if(typeof n=="string")sw(this,n)&&(e=e.concat(this.g.get(Ci(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};T.set=function(n,e){return jn(this),this.i=null,n=Ci(this,n),sw(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};T.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function ow(n,e,t){iw(n,e),0<t.length&&(n.i=null,n.g.set(Ci(n,e),Md(t)),n.h+=t.length)}T.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function Ci(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function vb(n,e){e&&!n.j&&(jn(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(iw(this,r),ow(this,i,t))},n)),n.j=e}var _b=class{constructor(n,e){this.g=n,this.map=e}};function aw(n){this.l=n||wb,U.PerformanceNavigationTiming?(n=U.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(U.g&&U.g.Ka&&U.g.Ka()&&U.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var wb=10;function cw(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function uw(n){return n.h?1:n.g?n.g.size:0}function Rd(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function Wd(n,e){n.g?n.g.add(e):n.h=e}function lw(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}aw.prototype.cancel=function(){if(this.i=hw(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function hw(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(let t of n.g.values())e=e.concat(t.F);return e}return Md(n.i)}var Eb=class{stringify(n){return U.JSON.stringify(n,void 0)}parse(n){return U.JSON.parse(n,void 0)}};function Ib(){this.g=new Eb}function Tb(n,e,t){let r=t||"";try{nw(n,function(i,s){let o=i;yo(i)&&(o=Ud(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Cb(n,e){let t=new Lc;if(U.Image){let r=new Image;r.onload=wc(Ac,t,r,"TestLoadImage: loaded",!0,e),r.onerror=wc(Ac,t,r,"TestLoadImage: error",!1,e),r.onabort=wc(Ac,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=wc(Ac,t,r,"TestLoadImage: timeout",!1,e),U.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function Ac(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function To(n){this.l=n.ec||null,this.j=n.ob||!1}Le(To,qd);To.prototype.g=function(){return new zc(this.l,this.j)};To.prototype.i=function(n){return function(){return n}}({});function zc(n,e){Fe.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Kd,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Le(zc,Fe);var Kd=0;T=zc.prototype;T.open=function(n,e){if(this.readyState!=Kd)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,mo(this)};T.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||U).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};T.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Co(this)),this.readyState=Kd};T.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,mo(this)),this.g&&(this.readyState=3,mo(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof U.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;dw(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function dw(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}T.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Co(this):mo(this),this.readyState==3&&dw(this)}};T.Za=function(n){this.g&&(this.response=this.responseText=n,Co(this))};T.Ya=function(n){this.g&&(this.response=n,Co(this))};T.ka=function(){this.g&&Co(this)};function Co(n){n.readyState=4,n.l=null,n.j=null,n.A=null,mo(n)}T.setRequestHeader=function(n,e){this.v.append(n,e)};T.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};T.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function mo(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(zc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var Ab=U.JSON.parse;function ve(n){Fe.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=fw,this.L=this.M=!1}Le(ve,Fe);var fw="",Sb=/^https?$/i,bb=["POST","PUT"];T=ve.prototype;T.Oa=function(n){this.M=n};T.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Cd.g(),this.C=this.u?E_(this.u):E_(Cd),this.g.onreadystatechange=ze(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){C_(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=U.FormData&&n instanceof U.FormData,!(0<=D_(bb,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{mw(this),0<this.B&&((this.L=Rb(this.g))?(this.g.timeout=this.B,this.g.ontimeout=ze(this.ua,this)):this.A=Bd(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){C_(this,s)}};function Rb(n){return Ti&&typeof n.timeout=="number"&&n.ontimeout!==void 0}T.ua=function(){typeof xd<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Be(this,"timeout"),this.abort(8))};function C_(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,pw(n),Gc(n)}function pw(n){n.F||(n.F=!0,Be(n,"complete"),Be(n,"error"))}T.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Be(this,"complete"),Be(this,"abort"),Gc(this))};T.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Gc(this,!0)),ve.$.N.call(this)};T.La=function(){this.s||(this.G||this.v||this.l?gw(this):this.kb())};T.kb=function(){gw(this)};function gw(n){if(n.h&&typeof xd<"u"&&(!n.C[1]||Ht(n)!=4||n.da()!=2)){if(n.v&&Ht(n)==4)Bd(n.La,0,n);else if(Be(n,"readystatechange"),Ht(n)==4){n.h=!1;try{let o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=o===0){var i=String(n.I).match(rw)[1]||null;!i&&U.self&&U.self.location&&(i=U.self.location.protocol.slice(0,-1)),r=!Sb.test(i?i.toLowerCase():"")}t=r}if(t)Be(n,"complete"),Be(n,"success");else{n.m=6;try{var s=2<Ht(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",pw(n)}}finally{Gc(n)}}}}function Gc(n,e){if(n.g){mw(n);let t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Be(n,"ready");try{t.onreadystatechange=r}catch{}}}function mw(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(U.clearTimeout(n.A),n.A=null)}T.isActive=function(){return!!this.g};function Ht(n){return n.g?n.g.readyState:0}T.da=function(){try{return 2<Ht(this)?this.g.status:-1}catch{return-1}};T.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};T.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),Ab(e)}};function A_(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case fw:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Db(n){let e={};n=(n.g&&2<=Ht(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(co(n[r]))continue;var t=tb(n[r]);let i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();let s=e[i]||[];e[i]=s,s.push(t)}XS(e,function(r){return r.join(", ")})}T.Ia=function(){return this.m};T.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function yw(n){let e="";return kd(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function Hd(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=yw(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):ae(n,e,t))}function ro(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function vw(n){this.Ga=0,this.j=[],this.l=new Lc,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=ro("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=ro("baseRetryDelayMs",5e3,n),this.hb=ro("retryDelaySeedMs",1e4,n),this.eb=ro("forwardChannelMaxRetries",2,n),this.xa=ro("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new aw(n&&n.concurrentRequestLimit),this.Ja=new Ib,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}T=vw.prototype;T.ra=8;T.H=1;function Qd(n){if(_w(n),n.H==3){var e=n.W++,t=fn(n.I);if(ae(t,"SID",n.K),ae(t,"RID",e),ae(t,"TYPE","terminate"),Ao(n,t),e=new Eo(n,n.l,e),e.L=2,e.A=qc(fn(t)),t=!1,U.navigator&&U.navigator.sendBeacon)try{t=U.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&U.Image&&(new Image().src=e.A,t=!0),t||(e.g=bw(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Io(e)}Aw(n)}function Wc(n){n.g&&(Xd(n),n.g.cancel(),n.g=null)}function _w(n){Wc(n),n.u&&(U.clearTimeout(n.u),n.u=null),Dc(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&U.clearTimeout(n.m),n.m=null)}function Kc(n){if(!cw(n.i)&&!n.m){n.m=!0;var e=n.Na;lo||$_(),ho||(lo(),ho=!0),jd.add(e,n),n.C=0}}function Pb(n,e){return uw(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=_o(ze(n.Na,n,e),Cw(n,n.C)),n.C++,!0)}T.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new Eo(this,this.l,n),s=this.s;if(this.U&&(s?(s=V_(s),k_(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=ww(this,i,e),t=fn(this.I),ae(t,"RID",n),ae(t,"CVER",22),this.F&&ae(t,"X-HTTP-Session-Id",this.F),Ao(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(yw(s)))+"&"+e:this.o&&Hd(t,this.o,s)),Wd(this.i,i),this.bb&&ae(t,"TYPE","init"),this.P?(ae(t,"$req",e),ae(t,"SID","null"),i.aa=!0,Sd(i,t,null)):Sd(i,t,e),this.H=2}}else this.H==3&&(n?S_(this,n):this.j.length==0||cw(this.i)||S_(this))};function S_(n,e){var t;e?t=e.m:t=n.W++;let r=fn(n.I);ae(r,"SID",n.K),ae(r,"RID",t),ae(r,"AID",n.V),Ao(n,r),n.o&&n.s&&Hd(r,n.o,n.s),t=new Eo(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=ww(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Wd(n.i,t),Sd(t,r,e)}function Ao(n,e){n.na&&kd(n.na,function(t,r){ae(e,r,t)}),n.h&&nw({},function(t,r){ae(e,r,t)})}function ww(n,e,t){t=Math.min(n.j.length,t);var r=n.h?ze(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){let o=["count="+t];s==-1?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let c=0;c<t;c++){let u=i[c].g,l=i[c].map;if(u-=s,0>u)s=Math.max(0,i[c].g-100),a=!1;else try{Tb(l,o,"req"+u+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function Ew(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;lo||$_(),ho||(lo(),ho=!0),jd.add(e,n),n.A=0}}function Yd(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=_o(ze(n.Ma,n),Cw(n,n.A)),n.A++,!0)}T.Ma=function(){if(this.u=null,Iw(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=_o(ze(this.jb,this),n)}};T.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Je(10),Wc(this),Iw(this))};function Xd(n){n.B!=null&&(U.clearTimeout(n.B),n.B=null)}function Iw(n){n.g=new Eo(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=fn(n.wa);ae(e,"RID","rpc"),ae(e,"SID",n.K),ae(e,"AID",n.V),ae(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&ae(e,"TO",n.qa),ae(e,"TYPE","xmlhttp"),Ao(n,e),n.o&&n.s&&Hd(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=qc(fn(e)),t.u=null,t.S=!0,J_(t,n)}T.ib=function(){this.v!=null&&(this.v=null,Wc(this),Yd(this),Je(19))};function Dc(n){n.v!=null&&(U.clearTimeout(n.v),n.v=null)}function Tw(n,e){var t=null;if(n.g==e){Dc(n),Xd(n),n.g=null;var r=2}else if(Rd(n.i,e))t=e.F,lw(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=Uc(),Be(r,new K_(r,t)),Kc(n)}else Ew(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&Pb(n,e)||r==2&&Yd(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:vr(n,5);break;case 4:vr(n,10);break;case 3:vr(n,6);break;default:vr(n,2)}}}function Cw(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function vr(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=ze(n.pb,n);t||(t=new _r("//www.google.com/images/cleardot.gif"),U.location&&U.location.protocol=="http"||bc(t,"https"),qc(t)),Cb(t.toString(),r)}else Je(2);n.H=0,n.h&&n.h.za(e),Aw(n),_w(n)}T.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Je(2)):(this.l.info("Failed to ping google.com"),Je(1))};function Aw(n){if(n.H=0,n.ma=[],n.h){let e=hw(n.i);(e.length!=0||n.j.length!=0)&&(y_(n.ma,e),y_(n.ma,n.j),n.i.i.length=0,Md(n.j),n.j.length=0),n.h.ya()}}function Sw(n,e,t){var r=t instanceof _r?fn(t):new _r(t);if(r.g!="")e&&(r.g=e+"."+r.g),Rc(r,r.m);else{var i=U.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new _r(null);r&&bc(s,r),e&&(s.g=e),i&&Rc(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&ae(r,t,e),ae(r,"VER",n.ra),Ao(n,r),r}function bw(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new ve(new To({ob:t})):new ve(n.va),e.Oa(n.J),e}T.isActive=function(){return!!this.h&&this.h.isActive(this)};function Rw(){}T=Rw.prototype;T.Ba=function(){};T.Aa=function(){};T.za=function(){};T.ya=function(){};T.isActive=function(){return!0};T.Va=function(){};function Pc(){if(Ti&&!(10<=Number(KS)))throw Error("Environmental error: no available transport.")}Pc.prototype.g=function(n,e){return new ht(n,e)};function ht(n,e){Fe.call(this),this.g=new vw(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!co(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!co(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new Ai(this)}Le(ht,Fe);ht.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Je(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=Sw(n,null,n.Y),Kc(n)};ht.prototype.close=function(){Qd(this.g)};ht.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=Ud(n),n=t);e.j.push(new _b(e.fb++,n)),e.H==3&&Kc(e)};ht.prototype.N=function(){this.g.h=null,delete this.j,Qd(this.g),delete this.g,ht.$.N.call(this)};function Dw(n){zd.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(let t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}Le(Dw,zd);function Pw(){Gd.call(this),this.status=1}Le(Pw,Gd);function Ai(n){this.g=n}Le(Ai,Rw);Ai.prototype.Ba=function(){Be(this.g,"a")};Ai.prototype.Aa=function(n){Be(this.g,new Dw(n))};Ai.prototype.za=function(n){Be(this.g,new Pw)};Ai.prototype.ya=function(){Be(this.g,"b")};function xb(){this.blockSize=-1}function xt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}Le(xt,xb);xt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function pd(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],o=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}xt.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)pd(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){pd(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){pd(this,r),i=0;break}}this.h=i,this.i+=e};xt.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function te(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var Mb={};function Jd(n){return-128<=n&&128>n?zS(n,function(e){return new te([e|0],0>e?-1:0)}):new te([n|0],0>n?-1:0)}function Qt(n){if(isNaN(n)||!isFinite(n))return Ii;if(0>n)return $e(Qt(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=Dd;return new te(e,0)}function xw(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return $e(xw(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Qt(Math.pow(e,8)),r=Ii,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=Qt(Math.pow(e,s)),r=r.R(s).add(Qt(o))):(r=r.R(t),r=r.add(Qt(o)))}return r}var Dd=4294967296,Ii=Jd(0),Pd=Jd(1),b_=Jd(16777216);T=te.prototype;T.ea=function(){if(_t(this))return-$e(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:Dd+r)*e,e*=Dd}return n};T.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(dn(this))return"0";if(_t(this))return"-"+$e(this).toString(n);for(var e=Qt(Math.pow(n,6)),t=this,r="";;){var i=Mc(t,e).g;t=xc(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,dn(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};T.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function dn(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function _t(n){return n.h==-1}T.X=function(n){return n=xc(this,n),_t(n)?-1:dn(n)?0:1};function $e(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new te(t,~n.h).add(Pd)}T.abs=function(){return _t(this)?$e(this):this};T.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,t[i]=o<<16|s}return new te(t,t[t.length-1]&-2147483648?-1:0)};function xc(n,e){return n.add($e(e))}T.R=function(n){if(dn(this)||dn(n))return Ii;if(_t(this))return _t(n)?$e(this).R($e(n)):$e($e(this).R(n));if(_t(n))return $e(this.R($e(n)));if(0>this.X(b_)&&0>n.X(b_))return Qt(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,c=n.D(i)&65535;t[2*r+2*i]+=o*c,Sc(t,2*r+2*i),t[2*r+2*i+1]+=s*c,Sc(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,Sc(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,Sc(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new te(t,0)};function Sc(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function io(n,e){this.g=n,this.h=e}function Mc(n,e){if(dn(e))throw Error("division by zero");if(dn(n))return new io(Ii,Ii);if(_t(n))return e=Mc($e(n),e),new io($e(e.g),$e(e.h));if(_t(e))return e=Mc(n,$e(e)),new io($e(e.g),e.h);if(30<n.g.length){if(_t(n)||_t(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Pd,r=e;0>=r.X(n);)t=R_(t),r=R_(r);var i=wi(t,1),s=wi(r,1);for(r=wi(r,2),t=wi(t,2);!dn(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=wi(r,1),t=wi(t,1)}return e=xc(n,i.R(e)),new io(i,e)}for(i=Ii;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=Qt(t),o=s.R(e);_t(o)||0<o.X(n);)t-=r,s=Qt(t),o=s.R(e);dn(s)&&(s=Pd),i=i.add(s),n=xc(n,o)}return new io(i,n)}T.gb=function(n){return Mc(this,n).h};T.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new te(t,this.h&n.h)};T.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new te(t,this.h|n.h)};T.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new te(t,this.h^n.h)};function R_(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new te(t,n.h)}function wi(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new te(i,n.h)}Pc.prototype.createWebChannel=Pc.prototype.g;ht.prototype.send=ht.prototype.u;ht.prototype.open=ht.prototype.m;ht.prototype.close=ht.prototype.close;jc.NO_ERROR=0;jc.TIMEOUT=8;jc.HTTP_ERROR=6;H_.COMPLETE="complete";Q_.EventType=wo;wo.OPEN="a";wo.CLOSE="b";wo.ERROR="c";wo.MESSAGE="d";Fe.prototype.listen=Fe.prototype.O;ve.prototype.listenOnce=ve.prototype.P;ve.prototype.getLastError=ve.prototype.Sa;ve.prototype.getLastErrorCode=ve.prototype.Ia;ve.prototype.getStatus=ve.prototype.da;ve.prototype.getResponseJson=ve.prototype.Wa;ve.prototype.getResponseText=ve.prototype.ja;ve.prototype.send=ve.prototype.ha;ve.prototype.setWithCredentials=ve.prototype.Oa;xt.prototype.digest=xt.prototype.l;xt.prototype.reset=xt.prototype.reset;xt.prototype.update=xt.prototype.j;te.prototype.add=te.prototype.add;te.prototype.multiply=te.prototype.R;te.prototype.modulo=te.prototype.gb;te.prototype.compare=te.prototype.X;te.prototype.toNumber=te.prototype.ea;te.prototype.toString=te.prototype.toString;te.prototype.getBits=te.prototype.D;te.fromNumber=Qt;te.fromString=xw;var Mw=Mt.createWebChannelTransport=function(){return new Pc},Vw=Mt.getStatEventTarget=function(){return Uc()},Hc=Mt.ErrorCode=jc,kw=Mt.EventType=H_,Nw=Mt.Event=wr,Zd=Mt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},bM=Mt.FetchXmlHttpFactory=To,So=Mt.WebChannel=Q_,Ow=Mt.XhrIo=ve,Fw=Mt.Md5=xt,Er=Mt.Integer=te;var Lw="@firebase/firestore";var Pe=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Pe.UNAUTHENTICATED=new Pe(null),Pe.GOOGLE_CREDENTIALS=new Pe("google-credentials-uid"),Pe.FIRST_PARTY=new Pe("first-party-uid"),Pe.MOCK_USER=new Pe("mock-user");var ts="10.8.0";var Kn=new ka("@firebase/firestore");function Pi(){return Kn.logLevel}function ng(n){Kn.setLogLevel(n)}function v(n,...e){if(Kn.logLevel<=Bt.DEBUG){let t=e.map(rg);Kn.debug(`Firestore (${ts}): ${n}`,...t)}}function Ie(n,...e){if(Kn.logLevel<=Bt.ERROR){let t=e.map(rg);Kn.error(`Firestore (${ts}): ${n}`,...t)}}function Et(n,...e){if(Kn.logLevel<=Bt.WARN){let t=e.map(rg);Kn.warn(`Firestore (${ts}): ${n}`,...t)}}function rg(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function S(n="Unexpected state"){let e=`FIRESTORE (${ts}) INTERNAL ASSERTION FAILED: `+n;throw Ie(e),new Error(e)}function x(n,e){n||S()}function F0(n,e){n||S()}function C(n,e){return n}var g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},y=class extends Sy{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var xe=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var su=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},sf=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Pe.UNAUTHENTICATED))}shutdown(){}},of=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},af=class{constructor(e){this.t=e,this.currentUser=Pe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i,i=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve(),s=new xe;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new xe,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let c=s;e.enqueueRetryable(()=>m(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},a=c=>{v("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(v("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new xe)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(v("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(x(typeof r.accessToken=="string"),new su(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return x(e===null||typeof e=="string"),new Pe(e)}},cf=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Pe.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},uf=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new cf(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Pe.FIRST_PARTY))}shutdown(){}invalidateToken(){}},lf=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},hf=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let r=s=>{s.error!=null&&v("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,v("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{v("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):v("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(x(typeof t.token=="string"),this.R=t.token,new lf(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function Vb(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var ou=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=Vb(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function B(n,e){return n<e?-1:n>e?1:0}function Ui(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function L0(n){return n+"\0"}var ge=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new y(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new y(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new y(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new y(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?B(this.nanoseconds,e.nanoseconds):B(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var V=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new ge(0,0))}static max(){return new n(new ge(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var au=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&S(),r===void 0?r=e.length-t:r>e.length-t&&S(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},X=class n extends au{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new y(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},kb=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Te=class n extends au{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return kb.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new y(g.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new y(g.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new y(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new y(g.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var I=class n{constructor(e){this.path=e}static fromPath(e){return new n(X.fromString(e))}static fromName(e){return new n(X.fromString(e).popFirst(5))}static empty(){return new n(X.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&X.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return X.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new X(e.slice()))}};var ji=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function df(n){return n.fields.find(e=>e.kind===2)}function Tr(n){return n.fields.filter(e=>e.kind!==2)}ji.UNKNOWN_ID=-1;var Oi=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Lo=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,It.min())}};function U0(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=V.fromTimestamp(r===1e9?new ge(t+1,0):new ge(t,r));return new It(i,I.empty(),e)}function j0(n){return new It(n.readTime,n.key,-1)}var It=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(V.min(),I.empty(),-1)}static max(){return new n(V.max(),I.empty(),-1)}};function ig(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=I.comparator(n.documentKey,e.documentKey),t!==0?t:B(n.largestBatchId,e.largestBatchId))}var $0="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",cu=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function rr(n){return m(this,null,function*(){if(n.code!==g.FAILED_PRECONDITION||n.message!==$0)throw n;v("LocalStore","Unexpectedly lost primary lease")})}var p=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&S(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},c=>r(c))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let u=c;t(e[u]).next(l=>{o[u]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var uu=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new xe,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Dr(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=sg(r.target.error);this.V.reject(new Dr(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Dr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(v("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new pf(t)}},mn=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S(Cs())===12.2&&Ie("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return v("SimpleDb","Removing database:",e),Cr(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Va())return!1;if(n.C())return!0;let e=Cs(),t=n.S(e),r=0<t&&t<10,i=n.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.F)==="YES"}static M(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){let t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(e){return m(this,null,function*(){return this.db||(v("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Dr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new y(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new y(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Dr(e,o))},i.onupgradeneeded=s=>{v("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.N(o,i.transaction,s.oldVersion,this.version).next(()=>{v("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=t=>this.B(t)),this.db})}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return m(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.O(e);let a=uu.open(this.db,e,s?"readonly":"readwrite",r),c=i(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),p.reject(u))).toPromise();return c.catch(()=>{}),yield a.m,c}catch(a){let c=a,u=c.name!=="FirebaseError"&&o<3;if(v("SimpleDb","Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}},ff=class{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return Cr(this.k.delete())}},Dr=class extends y{constructor(e,t){super(g.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function ir(n){return n.name==="IndexedDbTransactionError"}var pf=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(v("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(v("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Cr(r)}add(e){return v("SimpleDb","ADD",this.store.name,e,e),Cr(this.store.add(e))}get(e){return Cr(this.store.get(e)).next(t=>(t===void 0&&(t=null),v("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return v("SimpleDb","DELETE",this.store.name,e),Cr(this.store.delete(e))}count(){return v("SimpleDb","COUNT",this.store.name),Cr(this.store.count())}W(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new p((o,a)=>{s.onerror=c=>{a(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(r),o=[];return this.G(s,(a,c)=>{o.push(c)}).next(()=>o)}}j(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new p((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(e,t){v("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.J=!1;let i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.G(i,t)}Z(e){let t=this.cursor({});return new p((r,i)=>{t.onerror=s=>{let o=sg(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(e,t){let r=[];return new p((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let c=new ff(a),u=t(a.primaryKey,a.value,c);if(u instanceof p){let l=u.catch(h=>(c.done(),p.reject(h)));r.push(l)}c.isDone?i():c.$===null?a.continue():a.continue(c.$)}}).next(()=>p.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function Cr(n){return new p((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=sg(r.target.error);t(i)}})}var Uw=!1;function sg(n){let e=mn.S(Cs());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Uw||(Uw=!0,setTimeout(()=>{throw r},0)),r}}return n}var gf=class{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ee(e){v("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>m(this,null,function*(){this.task=null;try{v("IndexBackfiller",`Documents written: ${yield this.X.te()}`)}catch(t){ir(t)?v("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield rr(t)}yield this.ee(6e4)}))}},mf=class{constructor(e,t){this.localStore=e,this.persistence=t}te(e=50){return m(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ne(t,e))})}ne(e,t){let r=new Set,i=t,s=!0;return p.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return v("IndexBackfiller",`Processing collection: ${o}`),this.re(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}re(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ie(i,s)).next(a=>(v("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}ie(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=j0(s);ig(o,r)>0&&(r=o)}),new It(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var dt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.oe&&this.oe(t),t}}return n._e=-1,n})();function aa(n){return n==null}function Uo(n){return n===0&&1/n==-1/0}function B0(n){return typeof n=="number"&&Number.isInteger(n)&&!Uo(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Ze(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=jw(e)),e=Nb(n.get(t),e);return jw(e)}function Nb(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function jw(n){return n+""}function Yt(n){let e=n.length;if(x(e>=2),e===2)return x(n.charAt(0)===""&&n.charAt(1)===""),X.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&S(),n.charAt(o+1)){case"":let a=n.substring(s,o),c;i.length===0?c=a:(i+=a,c=i,i=""),r.push(c);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:S()}s=o+2}return new X(r)}var $w=["userId","batchId"];function Zc(n,e){return[n,Ze(e)]}function q0(n,e,t){return[n,Ze(e),t]}var Ob={},Fb=["prefixPath","collectionGroup","readTime","documentId"],Lb=["prefixPath","collectionGroup","documentId"],Ub=["collectionGroup","readTime","prefixPath","documentId"],jb=["canonicalId","targetId"],$b=["targetId","path"],Bb=["path","targetId"],qb=["collectionId","parent"],zb=["indexId","uid"],Gb=["uid","sequenceNumber"],Wb=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Kb=["indexId","uid","orderedDocumentKey"],Hb=["userId","collectionPath","documentId"],Qb=["userId","collectionPath","largestBatchId"],Yb=["userId","collectionGroup","largestBatchId"],z0=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Xb=[...z0,"documentOverlays"],G0=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],W0=G0,Jb=[...W0,"indexConfiguration","indexState","indexEntries"];var jo=class extends cu{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}};function je(n,e){let t=C(n);return mn.M(t.ae,e)}function Bw(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function $r(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function K0(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ce=class n{constructor(e,t){this.comparator=e,this.root=t||Jt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Jt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Jt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ni(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ni(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ni(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ni(this.root,e,this.comparator,!0)}},Ni=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Jt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw S();let e=this.left.check();if(e!==this.right.check())throw S();return e+(this.isRed()?0:1)}};Jt.EMPTY=null,Jt.RED=!0,Jt.BLACK=!1;Jt.EMPTY=new class{constructor(){this.size=0}get key(){throw S()}get value(){throw S()}get color(){throw S()}get left(){throw S()}get right(){throw S()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Jt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var ie=class n{constructor(e){this.comparator=e,this.data=new ce(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new lu(this.data.getIterator())}getIteratorFrom(e){return new lu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},lu=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Si(n){return n.hasNext()?n.getNext():void 0}var ft=class n{constructor(e){this.fields=e,e.sort(Te.comparator)}static empty(){return new n([])}unionWith(e){let t=new ie(Te.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ui(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var hu=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function H0(){return typeof atob<"u"}var Ue=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new hu("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return B(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ue.EMPTY_BYTE_STRING=new Ue("");var Zb=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Hn(n){if(x(!!n),typeof n=="string"){let e=0,t=Zb.exec(n);if(x(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:_e(n.seconds),nanos:_e(n.nanos)}}function _e(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Qn(n){return typeof n=="string"?Ue.fromBase64String(n):Ue.fromUint8Array(n)}function tl(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function og(n){let e=n.mapValue.fields.__previous_value__;return tl(e)?og(e):e}function $o(n){let e=Hn(n.mapValue.fields.__local_write_time__.timestampValue);return new ge(e.seconds,e.nanos)}var yf=class{constructor(e,t,r,i,s,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}},Yn=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Gn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},eu={nullValue:"NULL_VALUE"};function Pr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?tl(n)?4:Q0(n)?9007199254740991:10:S()}function tn(n,e){if(n===e)return!0;let t=Pr(n);if(t!==Pr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return $o(n).isEqual($o(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=Hn(i.timestampValue),a=Hn(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Qn(i.bytesValue).isEqual(Qn(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return _e(i.geoPointValue.latitude)===_e(s.geoPointValue.latitude)&&_e(i.geoPointValue.longitude)===_e(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return _e(i.integerValue)===_e(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=_e(i.doubleValue),a=_e(s.doubleValue);return o===a?Uo(o)===Uo(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Ui(n.arrayValue.values||[],e.arrayValue.values||[],tn);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(Bw(o)!==Bw(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!tn(o[c],a[c])))return!1;return!0}(n,e);default:return S()}}function Bo(n,e){return(n.values||[]).find(t=>tn(t,e))!==void 0}function Xn(n,e){if(n===e)return 0;let t=Pr(n),r=Pr(e);if(t!==r)return B(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return B(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=_e(s.integerValue||s.doubleValue),c=_e(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return qw(n.timestampValue,e.timestampValue);case 4:return qw($o(n),$o(e));case 5:return B(n.stringValue,e.stringValue);case 6:return function(s,o){let a=Qn(s),c=Qn(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){let l=B(a[u],c[u]);if(l!==0)return l}return B(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=B(_e(s.latitude),_e(o.latitude));return a!==0?a:B(_e(s.longitude),_e(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){let a=s.values||[],c=o.values||[];for(let u=0;u<a.length&&u<c.length;++u){let l=Xn(a[u],c[u]);if(l)return l}return B(a.length,c.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===Gn.mapValue&&o===Gn.mapValue)return 0;if(s===Gn.mapValue)return 1;if(o===Gn.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),u=o.fields||{},l=Object.keys(u);c.sort(),l.sort();for(let h=0;h<c.length&&h<l.length;++h){let d=B(c[h],l[h]);if(d!==0)return d;let f=Xn(a[c[h]],u[l[h]]);if(f!==0)return f}return B(c.length,l.length)}(n.mapValue,e.mapValue);default:throw S()}}function qw(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return B(n,e);let t=Hn(n),r=Hn(e),i=B(t.seconds,r.seconds);return i!==0?i:B(t.nanos,r.nanos)}function $i(n){return vf(n)}function vf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=Hn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Qn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return I.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=vf(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${vf(t.fields[o])}`;return i+"}"}(n.mapValue):S()}function xr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function _f(n){return!!n&&"integerValue"in n}function qo(n){return!!n&&"arrayValue"in n}function zw(n){return!!n&&"nullValue"in n}function Gw(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function tu(n){return!!n&&"mapValue"in n}function Vo(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return $r(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Vo(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Vo(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Q0(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function eR(n){return"nullValue"in n?eu:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?xr(Yn.empty(),I.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:S()}function tR(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?xr(Yn.empty(),I.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Gn:S()}function Ww(n,e){let t=Xn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Kw(n,e){let t=Xn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Ke=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!tu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Vo(t)}setAll(e){let t=Te.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let c=this.getFieldsMap(t);this.applyChanges(c,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Vo(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());tu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return tn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];tu(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){$r(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Vo(this.value))}};function Y0(n){let e=[];return $r(n.fields,(t,r)=>{let i=new Te([t]);if(tu(r)){let s=Y0(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new ft(e)}var Me=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,V.min(),V.min(),V.min(),Ke.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,V.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,V.min(),V.min(),Ke.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,V.min(),V.min(),Ke.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(V.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ke.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ke.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=V.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var nn=class{constructor(e,t){this.position=e,this.inclusive=t}};function Hw(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=I.comparator(I.fromName(o.referenceValue),t.key):r=Xn(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Qw(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!tn(n.position[t],e.position[t]))return!1;return!0}var Mr=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function nR(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var du=class{},Q=class n extends du{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new If(e,t,r):t==="array-contains"?new Af(e,r):t==="in"?new fu(e,r):t==="not-in"?new Sf(e,r):t==="array-contains-any"?new bf(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Tf(e,r):new Cf(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Xn(t,this.value)):t!==null&&Pr(this.value)===Pr(t)&&this.matchesComparison(Xn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return S()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ne=class n extends du{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new n(e,t)}matches(e){return Bi(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function Bi(n){return n.op==="and"}function wf(n){return n.op==="or"}function ag(n){return X0(n)&&Bi(n)}function X0(n){for(let e of n.filters)if(e instanceof ne)return!1;return!0}function Ef(n){if(n instanceof Q)return n.field.canonicalString()+n.op.toString()+$i(n.value);if(ag(n))return n.filters.map(e=>Ef(e)).join(",");{let e=n.filters.map(t=>Ef(t)).join(",");return`${n.op}(${e})`}}function J0(n,e){return n instanceof Q?function(r,i){return i instanceof Q&&r.op===i.op&&r.field.isEqual(i.field)&&tn(r.value,i.value)}(n,e):n instanceof ne?function(r,i){return i instanceof ne&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&J0(o,i.filters[a]),!0):!1}(n,e):void S()}function Z0(n,e){let t=n.filters.concat(e);return ne.create(t,n.op)}function eE(n){return n instanceof Q?function(t){return`${t.field.canonicalString()} ${t.op} ${$i(t.value)}`}(n):n instanceof ne?function(t){return t.op.toString()+" {"+t.getFilters().map(eE).join(" ,")+"}"}(n):"Filter"}var If=class extends Q{constructor(e,t,r){super(e,t,r),this.key=I.fromName(r.referenceValue)}matches(e){let t=I.comparator(e.key,this.key);return this.matchesComparison(t)}},Tf=class extends Q{constructor(e,t){super(e,"in",t),this.keys=tE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Cf=class extends Q{constructor(e,t){super(e,"not-in",t),this.keys=tE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function tE(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>I.fromName(r.referenceValue))}var Af=class extends Q{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return qo(t)&&Bo(t.arrayValue,this.value)}},fu=class extends Q{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Bo(this.value.arrayValue,t)}},Sf=class extends Q{constructor(e,t){super(e,"not-in",t)}matches(e){if(Bo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Bo(this.value.arrayValue,t)}},bf=class extends Q{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!qo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Bo(this.value.arrayValue,r))}};var Rf=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}};function Df(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Rf(n,e,t,r,i,s,o)}function Vr(n){let e=C(n);if(e.ce===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Ef(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),aa(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>$i(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>$i(r)).join(",")),e.ce=t}return e.ce}function ca(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!nR(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!J0(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Qw(n.startAt,e.startAt)&&Qw(n.endAt,e.endAt)}function pu(n){return I.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function gu(n,e){return n.filters.filter(t=>t instanceof Q&&t.field.isEqual(e))}function Yw(n,e,t){let r=eu,i=!0;for(let s of gu(n,e)){let o=eu,a=!0;switch(s.op){case"<":case"<=":o=eR(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=eu}Ww({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];Ww({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function Xw(n,e,t){let r=Gn,i=!0;for(let s of gu(n,e)){let o=Gn,a=!0;switch(s.op){case">=":case">":o=tR(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Gn}Kw({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];Kw({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var Vt=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function nE(n,e,t,r,i,s,o,a){return new Vt(n,e,t,r,i,s,o,a)}function ns(n){return new Vt(n)}function Jw(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function cg(n){return n.collectionGroup!==null}function Fi(n){let e=C(n);if(e.le===null){e.le=[];let t=new Set;for(let s of e.explicitOrderBy)e.le.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ie(Te.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.le.push(new Mr(s,r))}),t.has(Te.keyField().canonicalString())||e.le.push(new Mr(Te.keyField(),r))}return e.le}function et(n){let e=C(n);return e.he||(e.he=rR(e,Fi(n))),e.he}function rR(n,e){if(n.limitType==="F")return Df(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Mr(i.field,s)});let t=n.endAt?new nn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new nn(n.startAt.position,n.startAt.inclusive):null;return Df(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Pf(n,e){let t=n.filters.concat([e]);return new Vt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function mu(n,e,t){return new Vt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ua(n,e){return ca(et(n),et(e))&&n.limitType===e.limitType}function rE(n){return`${Vr(et(n))}|lt:${n.limitType}`}function xi(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>eE(i)).join(", ")}]`),aa(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>$i(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>$i(i)).join(",")),`Target(${r})`}(et(n))}; limitType=${n.limitType})`}function la(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):I.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of Fi(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,c){let u=Hw(o,a,c);return o.inclusive?u<=0:u<0}(r.startAt,Fi(r),i)||r.endAt&&!function(o,a,c){let u=Hw(o,a,c);return o.inclusive?u>=0:u>0}(r.endAt,Fi(r),i))}(n,e)}function iE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function sE(n){return(e,t)=>{let r=!1;for(let i of Fi(n)){let s=iR(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function iR(n,e,t){let r=n.field.isKeyField()?I.comparator(e.key,t.key):function(s,o,a){let c=o.data.field(s),u=a.data.field(s);return c!==null&&u!==null?Xn(c,u):S()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return S()}}var rn=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){$r(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return K0(this.inner)}size(){return this.innerSize}};var sR=new ce(I.comparator);function ot(){return sR}var oE=new ce(I.comparator);function xo(...n){let e=oE;for(let t of n)e=e.insert(t.key,t);return e}function aE(n){let e=oE;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Xt(){return ko()}function cE(){return ko()}function ko(){return new rn(n=>n.toString(),(n,e)=>n.isEqual(e))}var oR=new ce(I.comparator),aR=new ie(I.comparator);function q(...n){let e=aR;for(let t of n)e=e.add(t);return e}var cR=new ie(B);function ug(){return cR}function uE(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Uo(e)?"-0":e}}function lE(n){return{integerValue:""+n}}function hE(n,e){return B0(e)?lE(e):uE(n,e)}var qi=class{constructor(){this._=void 0}};function uR(n,e,t){return n instanceof Jn?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&tl(s)&&(s=og(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof yn?fE(n,e):n instanceof vn?pE(n,e):function(i,s){let o=dE(i,s),a=Zw(o)+Zw(i.Ie);return _f(o)&&_f(i.Ie)?lE(a):uE(i.serializer,a)}(n,e)}function lR(n,e,t){return n instanceof yn?fE(n,e):n instanceof vn?pE(n,e):t}function dE(n,e){return n instanceof Zn?function(r){return _f(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Jn=class extends qi{},yn=class extends qi{constructor(e){super(),this.elements=e}};function fE(n,e){let t=gE(e);for(let r of n.elements)t.some(i=>tn(i,r))||t.push(r);return{arrayValue:{values:t}}}var vn=class extends qi{constructor(e){super(),this.elements=e}};function pE(n,e){let t=gE(e);for(let r of n.elements)t=t.filter(i=>!tn(i,r));return{arrayValue:{values:t}}}var Zn=class extends qi{constructor(e,t){super(),this.serializer=e,this.Ie=t}};function Zw(n){return _e(n.integerValue||n.doubleValue)}function gE(n){return qo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var kr=class{constructor(e,t){this.field=e,this.transform=t}};function hR(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof yn&&i instanceof yn||r instanceof vn&&i instanceof vn?Ui(r.elements,i.elements,tn):r instanceof Zn&&i instanceof Zn?tn(r.Ie,i.Ie):r instanceof Jn&&i instanceof Jn}(n.transform,e.transform)}var xf=class{constructor(e,t){this.version=e,this.transformResults=t}},we=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function nu(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var zi=class{};function mE(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new tr(n.key,we.none()):new er(n.key,n.data,we.none());{let t=n.data,r=Ke.empty(),i=new ie(Te.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new kt(n.key,r,new ft(i.toArray()),we.none())}}function dR(n,e,t){n instanceof er?function(i,s,o){let a=i.value.clone(),c=t0(i.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof kt?function(i,s,o){if(!nu(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=t0(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(yE(i)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function No(n,e,t,r){return n instanceof er?function(s,o,a,c){if(!nu(s.precondition,o))return a;let u=s.value.clone(),l=n0(s.fieldTransforms,c,o);return u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof kt?function(s,o,a,c){if(!nu(s.precondition,o))return a;let u=n0(s.fieldTransforms,c,o),l=o.data;return l.setAll(yE(s)),l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,r):function(s,o,a){return nu(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function fR(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=dE(r.transform,i||null);s!=null&&(t===null&&(t=Ke.empty()),t.set(r.field,s))}return t||null}function e0(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Ui(r,i,(s,o)=>hR(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var er=class extends zi{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},kt=class extends zi{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function yE(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function t0(n,e,t){let r=new Map;x(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,lR(o,a,t[i]))}return r}function n0(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,uR(s,o,e))}return r}var tr=class extends zi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},zo=class extends zi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Go=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&dR(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=No(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=No(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=cE();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let c=mE(o,a);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(V.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),q())}isEqual(e){return this.batchId===e.batchId&&Ui(this.mutations,e.mutations,(t,r)=>e0(t,r))&&Ui(this.baseMutations,e.baseMutations,(t,r)=>e0(t,r))}},Mf=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){x(e.mutations.length===r.length);let i=function(){return oR}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Wo=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Vf=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Re,Y;function vE(n){switch(n){default:return S();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function _E(n){if(n===void 0)return Ie("GRPC error has no .code"),g.UNKNOWN;switch(n){case Re.OK:return g.OK;case Re.CANCELLED:return g.CANCELLED;case Re.UNKNOWN:return g.UNKNOWN;case Re.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case Re.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case Re.INTERNAL:return g.INTERNAL;case Re.UNAVAILABLE:return g.UNAVAILABLE;case Re.UNAUTHENTICATED:return g.UNAUTHENTICATED;case Re.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case Re.NOT_FOUND:return g.NOT_FOUND;case Re.ALREADY_EXISTS:return g.ALREADY_EXISTS;case Re.PERMISSION_DENIED:return g.PERMISSION_DENIED;case Re.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case Re.ABORTED:return g.ABORTED;case Re.OUT_OF_RANGE:return g.OUT_OF_RANGE;case Re.UNIMPLEMENTED:return g.UNIMPLEMENTED;case Re.DATA_LOSS:return g.DATA_LOSS;default:return S()}}(Y=Re||(Re={}))[Y.OK=0]="OK",Y[Y.CANCELLED=1]="CANCELLED",Y[Y.UNKNOWN=2]="UNKNOWN",Y[Y.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Y[Y.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Y[Y.NOT_FOUND=5]="NOT_FOUND",Y[Y.ALREADY_EXISTS=6]="ALREADY_EXISTS",Y[Y.PERMISSION_DENIED=7]="PERMISSION_DENIED",Y[Y.UNAUTHENTICATED=16]="UNAUTHENTICATED",Y[Y.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Y[Y.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Y[Y.ABORTED=10]="ABORTED",Y[Y.OUT_OF_RANGE=11]="OUT_OF_RANGE",Y[Y.UNIMPLEMENTED=12]="UNIMPLEMENTED",Y[Y.INTERNAL=13]="INTERNAL",Y[Y.UNAVAILABLE=14]="UNAVAILABLE",Y[Y.DATA_LOSS=15]="DATA_LOSS";var r0=null;function wE(){return new TextEncoder}var pR=new Er([4294967295,4294967295],0);function i0(n){let e=wE().encode(n),t=new Fw;return t.update(e),new Uint8Array(t.digest())}function s0(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Er([t,r],0),new Er([i,s],0)]}var kf=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Rr(`Invalid padding: ${t}`);if(r<0)throw new Rr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Rr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Rr(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=Er.fromNumber(this.Te)}de(e,t,r){let i=e.add(t.multiply(Er.fromNumber(r)));return i.compare(pR)===1&&(i=new Er([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;let t=i0(e),[r,i]=s0(t);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Te===0)return;let t=i0(e),[r,i]=s0(t);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);this.Re(o)}}Re(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Rr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Ko=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Ho.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(V.min(),i,new ce(B),ot(),q())}},Ho=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,q(),q(),q())}};var Li=class{constructor(e,t,r,i){this.Ve=e,this.removedTargetIds=t,this.key=r,this.me=i}},yu=class{constructor(e,t){this.targetId=e,this.fe=t}},vu=class{constructor(e,t,r=Ue.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},_u=class{constructor(){this.ge=0,this.pe=a0(),this.ye=Ue.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=q(),t=q(),r=q();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:S()}}),new Ho(this.ye,this.we,e,t,r)}Fe(){this.Se=!1,this.pe=a0()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,x(this.ge>=0)}Be(){this.Se=!0,this.we=!0}},Nf=class{constructor(e){this.Le=e,this.ke=new Map,this.qe=ot(),this.Qe=o0(),this.Ke=new ce(B)}$e(e){for(let t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(let t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{let r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(t);break;case 3:this.je(t)&&(r.Be(),r.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.Ce(e.resumeToken));break;default:S()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((r,i)=>{this.je(i)&&t(i)})}Je(e){let t=e.targetId,r=e.fe.count,i=this.Ye(t);if(i){let s=i.target;if(pu(s))if(r===0){let o=new I(s.path);this.We(t,o,Me.newNoDocument(o,V.min()))}else x(r===1);else{let o=this.Ze(t);if(o!==r){let a=this.Xe(e),c=a?this.et(a,e,o):1;if(c!==0){this.He(t);let u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,u)}r0?.tt(function(l,h,d,f,E){var w,_,M,$,D,W;let K={localCacheCount:l,existenceFilterCount:h.count,databaseId:d.database,projectId:d.projectId},Z=h.unchangedNames;return Z&&(K.bloomFilter={applied:E===0,hashCount:(w=Z?.hashCount)!==null&&w!==void 0?w:0,bitmapLength:($=(M=(_=Z?.bits)===null||_===void 0?void 0:_.bitmap)===null||M===void 0?void 0:M.length)!==null&&$!==void 0?$:0,padding:(W=(D=Z?.bits)===null||D===void 0?void 0:D.padding)!==null&&W!==void 0?W:0,mightContain:Ae=>{var Ft;return(Ft=f?.mightContain(Ae))!==null&&Ft!==void 0&&Ft}}),K}(o,e.fe,this.Le.nt(),a,c))}}}}Xe(e){let t=e.fe.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=Qn(r).toUint8Array()}catch(c){if(c instanceof hu)return Et("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new kf(o,i,s)}catch(c){return Et(c instanceof Rr?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Te===0?null:a}et(e,t,r){return t.fe.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.We(t,s,null),i++)}),i}it(e){let t=new Map;this.ke.forEach((s,o)=>{let a=this.Ye(o);if(a){if(s.current&&pu(a.target)){let c=new I(a.target.path);this.qe.get(c)!==null||this.st(o,c)||this.We(o,c,Me.newNoDocument(c,e))}s.De&&(t.set(o,s.ve()),s.Fe())}});let r=q();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let u=this.Ye(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(e));let i=new Ko(e,t,this.Ke,this.qe,r);return this.qe=ot(),this.Qe=o0(),this.Ke=new ce(B),i}Ue(e,t){if(!this.je(e))return;let r=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,r),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,r){if(!this.je(e))return;let i=this.ze(e);this.st(e,t)?i.Me(t,1):i.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),r&&(this.qe=this.qe.insert(t,r))}removeTarget(e){this.ke.delete(e)}Ze(e){let t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new _u,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new ie(B),this.Qe=this.Qe.insert(e,t)),t}je(e){let t=this.Ye(e)!==null;return t||v("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){let t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new _u),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function o0(){return new ce(I.comparator)}function a0(){return new ce(I.comparator)}var gR={asc:"ASCENDING",desc:"DESCENDING"},mR={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},yR={and:"AND",or:"OR"},Of=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Ff(n,e){return n.useProto3Json||aa(e)?e:{value:e}}function Gi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function EE(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function vR(n,e){return Gi(n,e.toTimestamp())}function Ce(n){return x(!!n),V.fromTimestamp(function(t){let r=Hn(t);return new ge(r.seconds,r.nanos)}(n))}function lg(n,e){return Lf(n,e).canonicalString()}function Lf(n,e){let t=function(i){return new X(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function IE(n){let e=X.fromString(n);return x(ME(e)),e}function Qo(n,e){return lg(n.databaseId,e.path)}function Zt(n,e){let t=IE(e);if(t.get(1)!==n.databaseId.projectId)throw new y(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new y(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new I(AE(t))}function TE(n,e){return lg(n.databaseId,e)}function CE(n){let e=IE(n);return e.length===4?X.emptyPath():AE(e)}function Uf(n){return new X(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function AE(n){return x(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function c0(n,e,t){return{name:Qo(n,e),fields:t.value.mapValue.fields}}function SE(n,e,t){let r=Zt(n,e.name),i=Ce(e.updateTime),s=e.createTime?Ce(e.createTime):V.min(),o=new Ke({mapValue:{fields:e.fields}}),a=Me.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function _R(n,e){return"found"in e?function(r,i){x(!!i.found),i.found.name,i.found.updateTime;let s=Zt(r,i.found.name),o=Ce(i.found.updateTime),a=i.found.createTime?Ce(i.found.createTime):V.min(),c=new Ke({mapValue:{fields:i.found.fields}});return Me.newFoundDocument(s,o,a,c)}(n,e):"missing"in e?function(r,i){x(!!i.missing),x(!!i.readTime);let s=Zt(r,i.missing),o=Ce(i.readTime);return Me.newNoDocument(s,o)}(n,e):S()}function wR(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:S()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(u,l){return u.useProto3Json?(x(l===void 0||typeof l=="string"),Ue.fromBase64String(l||"")):(x(l===void 0||l instanceof Uint8Array),Ue.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){let l=u.code===void 0?g.UNKNOWN:_E(u.code);return new y(l,u.message||"")}(o);t=new vu(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Zt(n,r.document.name),s=Ce(r.document.updateTime),o=r.document.createTime?Ce(r.document.createTime):V.min(),a=new Ke({mapValue:{fields:r.document.fields}}),c=Me.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];t=new Li(u,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Zt(n,r.document),s=r.readTime?Ce(r.readTime):V.min(),o=Me.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Li([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Zt(n,r.document),s=r.removedTargetIds||[];t=new Li([],s,i,null)}else{if(!("filter"in e))return S();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Vf(i,s),a=r.targetId;t=new yu(a,o)}}return t}function Yo(n,e){let t;if(e instanceof er)t={update:c0(n,e.key,e.value)};else if(e instanceof tr)t={delete:Qo(n,e.key)};else if(e instanceof kt)t={update:c0(n,e.key,e.data),updateMask:SR(e.fieldMask)};else{if(!(e instanceof zo))return S();t={verify:Qo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof Jn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof yn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof vn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Zn)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw S()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:vR(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:S()}(n,e.precondition)),t}function jf(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?we.updateTime(Ce(s.updateTime)):s.exists!==void 0?we.exists(s.exists):we.none()}(e.currentDocument):we.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let c=null;if("setToServerValue"in a)x(a.setToServerValue==="REQUEST_TIME"),c=new Jn;else if("appendMissingElements"in a){let l=a.appendMissingElements.values||[];c=new yn(l)}else if("removeAllFromArray"in a){let l=a.removeAllFromArray.values||[];c=new vn(l)}else"increment"in a?c=new Zn(o,a.increment):S();let u=Te.fromServerFormat(a.fieldPath);return new kr(u,c)}(n,i)):[];if(e.update){e.update.name;let i=Zt(n,e.update.name),s=new Ke({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(c){let u=c.fieldPaths||[];return new ft(u.map(l=>Te.fromServerFormat(l)))}(e.updateMask);return new kt(i,s,o,t,r)}return new er(i,s,t,r)}if(e.delete){let i=Zt(n,e.delete);return new tr(i,t)}if(e.verify){let i=Zt(n,e.verify);return new zo(i,t)}return S()}function ER(n,e){return n&&n.length>0?(x(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?Ce(i.updateTime):Ce(s);return o.isEqual(V.min())&&(o=Ce(s)),new xf(o,i.transformResults||[])}(t,e))):[]}function bE(n,e){return{documents:[TE(n,e.path)]}}function RE(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=TE(n,i);let s=function(u){if(u.length!==0)return xE(ne.create(u,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(u){if(u.length!==0)return u.map(l=>function(d){return{field:Mi(d.field),direction:TR(d.dir)}}(l))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Ff(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ut:t,parent:i}}function DE(n){let e=CE(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){x(r===1);let l=t.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];t.where&&(s=function(h){let d=PE(h);return d instanceof ne&&ag(d)?d.getFilters():[d]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(d=>function(E){return new Mr(Vi(E.field),function(_){switch(_){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction))}(d))}(t.orderBy));let a=null;t.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,aa(d)?null:d}(t.limit));let c=null;t.startAt&&(c=function(h){let d=!!h.before,f=h.values||[];return new nn(f,d)}(t.startAt));let u=null;return t.endAt&&(u=function(h){let d=!h.before,f=h.values||[];return new nn(f,d)}(t.endAt)),nE(e,i,o,s,a,"F",c,u)}function IR(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return S()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function PE(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Vi(t.unaryFilter.field);return Q.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Vi(t.unaryFilter.field);return Q.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Vi(t.unaryFilter.field);return Q.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Vi(t.unaryFilter.field);return Q.create(o,"!=",{nullValue:"NULL_VALUE"});default:return S()}}(n):n.fieldFilter!==void 0?function(t){return Q.create(Vi(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return S()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ne.create(t.compositeFilter.filters.map(r=>PE(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return S()}}(t.compositeFilter.op))}(n):S()}function TR(n){return gR[n]}function CR(n){return mR[n]}function AR(n){return yR[n]}function Mi(n){return{fieldPath:n.canonicalString()}}function Vi(n){return Te.fromServerFormat(n.fieldPath)}function xE(n){return n instanceof Q?function(t){if(t.op==="=="){if(Gw(t.value))return{unaryFilter:{field:Mi(t.field),op:"IS_NAN"}};if(zw(t.value))return{unaryFilter:{field:Mi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Gw(t.value))return{unaryFilter:{field:Mi(t.field),op:"IS_NOT_NAN"}};if(zw(t.value))return{unaryFilter:{field:Mi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Mi(t.field),op:CR(t.op),value:t.value}}}(n):n instanceof ne?function(t){let r=t.getFilters().map(i=>xE(i));return r.length===1?r[0]:{compositeFilter:{op:AR(t.op),filters:r}}}(n):S()}function SR(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function ME(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Wi=class n{constructor(e,t,r,i,s=V.min(),o=V.min(),a=Ue.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var wu=class{constructor(e){this.ct=e}};function bR(n,e){let t;if(e.document)t=SE(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=I.fromSegments(e.noDocument.path),i=Or(e.noDocument.readTime);t=Me.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return S();{let r=I.fromSegments(e.unknownDocument.path),i=Or(e.unknownDocument.version);t=Me.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new ge(i[0],i[1]);return V.fromTimestamp(s)}(e.readTime)),t}function u0(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Eu(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:Qo(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Gi(s,o.version.toTimestamp()),createTime:Gi(s,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Nr(e.version)};else{if(!e.isUnknownDocument())return S();r.unknownDocument={path:t.path.toArray(),version:Nr(e.version)}}return r}function Eu(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Nr(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Or(n){let e=new ge(n.seconds,n.nanoseconds);return V.fromTimestamp(e)}function Ar(n,e){let t=(e.baseMutations||[]).map(s=>jf(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>jf(n.ct,s)),i=ge.fromMillis(e.localWriteTimeMs);return new Go(e.batchId,i,t,r)}function Mo(n){let e=Or(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Or(n.lastLimboFreeSnapshotVersion):V.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return x(s.documents.length===1),et(ns(CE(s.documents[0])))}(n.query):function(s){return et(DE(s))}(n.query),new Wi(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ue.fromBase64String(n.resumeToken))}function VE(n,e){let t=Nr(e.snapshotVersion),r=Nr(e.lastLimboFreeSnapshotVersion),i;i=pu(e.target)?bE(n.ct,e.target):RE(n.ct,e.target).ut;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Vr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function hg(n){let e=DE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?mu(e,e.limit,"L"):e}function ef(n,e){return new Wo(e.largestBatchId,jf(n.ct,e.overlayMutation))}function l0(n,e){let t=e.path.lastSegment();return[n,Ze(e.path.popLast()),t]}function h0(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Nr(r.readTime),documentKey:Ze(r.documentKey.path),largestBatchId:r.largestBatchId}}var $f=class{getBundleMetadata(e,t){return d0(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:Or(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return d0(e).put(function(i){return{bundleId:i.id,createTime:Nr(Ce(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return f0(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:hg(s.bundledQuery),readTime:Or(s.readTime)}}(r)})}saveNamedQuery(e,t){return f0(e).put(function(i){return{name:i.name,readTime:Nr(Ce(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function d0(n){return je(n,"bundles")}function f0(n){return je(n,"namedQueries")}var Iu=class n{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return bo(e).get(l0(this.userId,t)).next(r=>r?ef(this.serializer,r):null)}getOverlays(e,t){let r=Xt();return p.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Wo(t,o);i.push(this.ht(e,a))}),p.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Ze(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(bo(e).H("collectionPathOverlayIndex",a))}),p.waitFor(s)}getOverlaysForCollection(e,t,r){let i=Xt(),s=Ze(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return bo(e).W("collectionPathOverlayIndex",o).next(a=>{for(let c of a){let u=ef(this.serializer,c);i.set(u.getKey(),u)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=Xt(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return bo(e).Y({index:"collectionGroupOverlayIndex",range:a},(c,u,l)=>{let h=ef(this.serializer,u);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}ht(e,t){return bo(e).put(function(i,s,o){let[a,c,u]=l0(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Yo(i.ct,o.mutation)}}(this.serializer,this.userId,t))}};function bo(n){return je(n,"documentOverlays")}var pn=class{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(_e(e.integerValue));else if("doubleValue"in e){let r=_e(e.doubleValue);isNaN(r)?this.Et(t,13):(this.Et(t,15),Uo(r)?t.dt(0):t.dt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Et(t,20),typeof r=="string"?t.At(r):(t.At(`${r.seconds||""}`),t.dt(r.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(Qn(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Et(t,45),t.dt(r.latitude||0),t.dt(r.longitude||0)}else"mapValue"in e?Q0(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):S()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){let r=e.fields||{};this.Et(t,55);for(let i of Object.keys(r))this.Rt(i,t),this.It(r[i],t)}wt(e,t){let r=e.values||[];this.Et(t,50);for(let i of r)this.It(i,t)}gt(e,t){this.Et(t,37),I.fromName(e).path.forEach(r=>{this.Et(t,60),this.St(r,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}};pn.bt=new pn;function RR(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function p0(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=RR(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var Bf=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ct(r.value),r=t.next();this.vt()}Ft(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Mt(r.value),r=t.next();this.xt()}Ot(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ct(r);else if(r<2048)this.Ct(960|r>>>6),this.Ct(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ct(480|r>>>12),this.Ct(128|63&r>>>6),this.Ct(128|63&r);else{let i=t.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Mt(r);else if(r<2048)this.Mt(960|r>>>6),this.Mt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Mt(480|r>>>12),this.Mt(128|63&r>>>6),this.Mt(128|63&r);else{let i=t.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Bt(e){let t=this.Lt(e),r=p0(t);this.kt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}qt(e){let t=this.Lt(e),r=p0(t);this.kt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Lt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ct(e){let t=255&e;t===0?(this.Kt(0),this.Kt(255)):t===255?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},qf=class{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Bt(e)}Tt(){this.Gt.Qt()}},zf=class{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}},Sr=class{constructor(){this.Gt=new Bf,this.zt=new qf(this.Gt),this.jt=new zf(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return e===0?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}};var br=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Jt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function $n(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=g0(n.arrayValue,e.arrayValue),t!==0?t:(t=g0(n.directionalValue,e.directionalValue),t!==0?t:I.comparator(n.documentKey,e.documentKey)))}function g0(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Tu=class{constructor(e){this.Yt=new ie((t,r)=>Te.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(let t of e.filters){let r=t;r.isInequality()?this.Yt=this.Yt.add(r):this.Xt.push(r)}}get en(){return this.Yt.size>1}tn(e){if(x(e.collectionGroup===this.collectionId),this.en)return!1;let t=df(e);if(t!==void 0&&!this.nn(t))return!1;let r=Tr(e),i=new Set,s=0,o=0;for(;s<r.length&&this.nn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Yt.size>0){let a=this.Yt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let c=r[s];if(!this.rn(a,c)||!this.sn(this.Zt[o++],c))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.Zt.length||!this.sn(this.Zt[o++],a))return!1}return!0}on(){if(this.en)return null;let e=new ie(Te.comparator),t=[];for(let r of this.Xt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Oi(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Oi(r.field,0))}for(let r of this.Zt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Oi(r.field,r.dir==="asc"?0:1)));return new ji(ji.UNKNOWN_ID,this.collectionId,t,Lo.empty())}nn(e){for(let t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function kE(n){var e,t;if(x(n instanceof Q||n instanceof ne),n instanceof Q){if(n instanceof fu){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>Q.create(n.field,"==",s)))||[];return ne.create(i,"or")}return n}let r=n.filters.map(i=>kE(i));return ne.create(r,n.op)}function DR(n){if(n.getFilters().length===0)return[];let e=Kf(kE(n));return x(NE(e)),Gf(e)||Wf(e)?[e]:e.getFilters()}function Gf(n){return n instanceof Q}function Wf(n){return n instanceof ne&&ag(n)}function NE(n){return Gf(n)||Wf(n)||function(t){if(t instanceof ne&&wf(t)){for(let r of t.getFilters())if(!Gf(r)&&!Wf(r))return!1;return!0}return!1}(n)}function Kf(n){if(x(n instanceof Q||n instanceof ne),n instanceof Q)return n;if(n.filters.length===1)return Kf(n.filters[0]);let e=n.filters.map(r=>Kf(r)),t=ne.create(e,n.op);return t=Cu(t),NE(t)?t:(x(t instanceof ne),x(Bi(t)),x(t.filters.length>1),t.filters.reduce((r,i)=>dg(r,i)))}function dg(n,e){let t;return x(n instanceof Q||n instanceof ne),x(e instanceof Q||e instanceof ne),t=n instanceof Q?e instanceof Q?function(i,s){return ne.create([i,s],"and")}(n,e):m0(n,e):e instanceof Q?m0(e,n):function(i,s){if(x(i.filters.length>0&&s.filters.length>0),Bi(i)&&Bi(s))return Z0(i,s.getFilters());let o=wf(i)?i:s,a=wf(i)?s:i,c=o.filters.map(u=>dg(u,a));return ne.create(c,"or")}(n,e),Cu(t)}function m0(n,e){if(Bi(e))return Z0(e,n.getFilters());{let t=e.filters.map(r=>dg(n,r));return ne.create(t,"or")}}function Cu(n){if(x(n instanceof Q||n instanceof ne),n instanceof Q)return n;let e=n.getFilters();if(e.length===1)return Cu(e[0]);if(X0(n))return n;let t=e.map(i=>Cu(i)),r=[];return t.forEach(i=>{i instanceof Q?r.push(i):i instanceof ne&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:ne.create(r,n.op)}var Hf=class{constructor(){this._n=new Xo}addToCollectionParentIndex(e,t){return this._n.add(t),p.resolve()}getCollectionParents(e,t){return p.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return p.resolve()}deleteFieldIndex(e,t){return p.resolve()}deleteAllFieldIndexes(e){return p.resolve()}createTargetIndexes(e,t){return p.resolve()}getDocumentsMatchingTarget(e,t){return p.resolve(null)}getIndexType(e,t){return p.resolve(0)}getFieldIndexes(e,t){return p.resolve([])}getNextCollectionGroupToUpdate(e){return p.resolve(null)}getMinOffset(e,t){return p.resolve(It.min())}getMinOffsetFromCollectionGroup(e,t){return p.resolve(It.min())}updateCollectionGroup(e,t,r){return p.resolve()}updateIndexEntries(e,t){return p.resolve()}},Xo=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ie(X.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ie(X.comparator)).toArray()}};var Qc=new Uint8Array(0),Qf=class{constructor(e,t){this.databaseId=t,this.an=new Xo,this.un=new rn(r=>Vr(r),(r,i)=>ca(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});let s={collectionId:r,parent:Ze(i)};return y0(e).put(s)}return p.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[L0(t),""],!1,!0);return y0(e).W(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(Yt(o.parent))}return r})}addFieldIndex(e,t){let r=Ro(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Ri(e);return s.next(a=>{o.put(h0(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=Ro(e),i=Ri(e),s=bi(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Ro(e),r=bi(e),i=Ri(e);return t.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(e,t){return p.forEach(this.cn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new Tu(r).on();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=bi(e),i=!0,s=new Map;return p.forEach(this.cn(t),o=>this.ln(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=q(),a=[];return p.forEach(s,(c,u)=>{v("IndexedDbIndexManager",`Using index ${function(D){return`id=${D.indexId}|cg=${D.collectionGroup}|f=${D.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`}(c)} to execute ${Vr(t)}`);let l=function(D,W){let K=df(W);if(K===void 0)return null;for(let Z of gu(D,K.fieldPath))switch(Z.op){case"array-contains-any":return Z.value.arrayValue.values||[];case"array-contains":return[Z.value]}return null}(u,c),h=function(D,W){let K=new Map;for(let Z of Tr(W))for(let Ae of gu(D,Z.fieldPath))switch(Ae.op){case"==":case"in":K.set(Z.fieldPath.canonicalString(),Ae.value);break;case"not-in":case"!=":return K.set(Z.fieldPath.canonicalString(),Ae.value),Array.from(K.values())}return null}(u,c),d=function(D,W){let K=[],Z=!0;for(let Ae of Tr(W)){let Ft=Ae.kind===0?Yw(D,Ae.fieldPath,D.startAt):Xw(D,Ae.fieldPath,D.startAt);K.push(Ft.value),Z&&(Z=Ft.inclusive)}return new nn(K,Z)}(u,c),f=function(D,W){let K=[],Z=!0;for(let Ae of Tr(W)){let Ft=Ae.kind===0?Xw(D,Ae.fieldPath,D.endAt):Yw(D,Ae.fieldPath,D.endAt);K.push(Ft.value),Z&&(Z=Ft.inclusive)}return new nn(K,Z)}(u,c),E=this.hn(c,u,d),w=this.hn(c,u,f),_=this.Pn(c,u,h),M=this.In(c.indexId,l,E,d.inclusive,w,f.inclusive,_);return p.forEach(M,$=>r.j($,t.limit).next(D=>{D.forEach(W=>{let K=I.fromSegments(W.documentKey);o.has(K)||(o=o.add(K),a.push(K))})}))}).next(()=>a)}return p.resolve(null)})}cn(e){let t=this.un.get(e);return t||(e.filters.length===0?t=[e]:t=DR(ne.create(e.filters,"and")).map(r=>Df(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}In(e,t,r,i,s,o,a){let c=(t!=null?t.length:1)*Math.max(r.length,s.length),u=c/(t!=null?t.length:1),l=[];for(let h=0;h<c;++h){let d=t?this.Tn(t[h/u]):Qc,f=this.En(e,d,r[h%u],i),E=this.dn(e,d,s[h%u],o),w=a.map(_=>this.En(e,d,_,!0));l.push(...this.createRange(f,E,w))}return l}En(e,t,r,i){let s=new br(e,I.empty(),t,r);return i?s:s.Jt()}dn(e,t,r,i){let s=new br(e,I.empty(),t,r);return i?s.Jt():s}ln(e,t){let r=new Tu(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.tn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.cn(t);return p.forEach(i,s=>this.ln(e,s).next(o=>{o?r!==0&&o.fields.length<function(c){let u=new ie(Te.comparator),l=!1;for(let h of c.filters)for(let d of h.getFlattenedFilters())d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?l=!0:u=u.add(d.field));for(let h of c.orderBy)h.field.isKeyField()||(u=u.add(h.field));return u.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}An(e,t){let r=new Sr;for(let i of Tr(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.Ht(i.kind);pn.bt.Pt(s,o)}return r.Wt()}Tn(e){let t=new Sr;return pn.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){let r=new Sr;return pn.bt.Pt(xr(this.databaseId,t),r.Ht(function(s){let o=Tr(s);return o.length===0?0:o[o.length-1].kind}(e))),r.Wt()}Pn(e,t,r){if(r===null)return[];let i=[];i.push(new Sr);let s=0;for(let o of Tr(e)){let a=r[s++];for(let c of i)if(this.Vn(t,o.fieldPath)&&qo(a))i=this.mn(i,o,a);else{let u=c.Ht(o.kind);pn.bt.Pt(a,u)}}return this.fn(i)}hn(e,t,r){return this.Pn(e,t,r.position)}fn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Wt();return t}mn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let c=new Sr;c.seed(a.Wt()),pn.bt.Pt(o,c.Ht(t.kind)),s.push(c)}return s}Vn(e,t){return!!e.filters.find(r=>r instanceof Q&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Ro(e),i=Ri(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(s=>{let o=[];return p.forEach(s,a=>i.get([a.indexId,this.uid]).next(c=>{o.push(function(l,h){let d=h?new Lo(h.sequenceNumber,new It(Or(h.readTime),new I(Yt(h.documentKey)),h.largestBatchId)):Lo.empty(),f=l.fields.map(([E,w])=>new Oi(Te.fromServerFormat(E),w));return new ji(l.indexId,l.collectionGroup,f,d)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:B(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Ro(e),s=Ri(e);return this.gn(e).next(o=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>p.forEach(a,c=>s.put(h0(c.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return p.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?p.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),p.forEach(a,c=>this.pn(e,i,c).next(u=>{let l=this.yn(s,c);return u.isEqual(l)?p.resolve():this.wn(e,s,c,u,l)}))))})}Sn(e,t,r,i){return bi(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(r,t.key),documentKey:t.key.path.toArray()})}bn(e,t,r,i){return bi(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(r,t.key),t.key.path.toArray()])}pn(e,t,r){let i=bi(e),s=new ie($n);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.Rn(r,t)])},(o,a)=>{s=s.add(new br(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}yn(e,t){let r=new ie($n),i=this.An(t,e);if(i==null)return r;let s=df(t);if(s!=null){let o=e.data.field(s.fieldPath);if(qo(o))for(let a of o.arrayValue.values||[])r=r.add(new br(t.indexId,e.key,this.Tn(a),i))}else r=r.add(new br(t.indexId,e.key,Qc,i));return r}wn(e,t,r,i,s){v("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(c,u,l,h,d){let f=c.getIterator(),E=u.getIterator(),w=Si(f),_=Si(E);for(;w||_;){let M=!1,$=!1;if(w&&_){let D=l(w,_);D<0?$=!0:D>0&&(M=!0)}else w!=null?$=!0:M=!0;M?(h(_),_=Si(E)):$?(d(w),w=Si(f)):(w=Si(f),_=Si(E))}}(i,s,$n,a=>{o.push(this.Sn(e,t,r,a))},a=>{o.push(this.bn(e,t,r,a))}),p.waitFor(o)}gn(e){let t=1;return Ri(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>$n(o,a)).filter((o,a,c)=>!a||$n(o,c[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=$n(o,e),c=$n(o,t);if(a===0)i[0]=e.Jt();else if(a>0&&c<0)i.push(o),i.push(o.Jt());else if(c>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Dn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Qc,[]],c=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Qc,[]];s.push(IDBKeyRange.bound(a,c))}return s}Dn(e,t){return $n(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(v0)}getMinOffset(e,t){return p.mapArray(this.cn(t),r=>this.ln(e,r).next(i=>i||S())).next(v0)}};function y0(n){return je(n,"collectionParents")}function bi(n){return je(n,"indexEntries")}function Ro(n){return je(n,"indexConfiguration")}function Ri(n){return je(n,"indexState")}function v0(n){x(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;ig(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new It(e.readTime,e.documentKey,t)}var _0={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},wt=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function OE(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,c=r.Y({range:o},(l,h,d)=>(a++,d.delete()));s.push(c.next(()=>{x(a===1)}));let u=[];for(let l of t.mutations){let h=q0(e,l.key.path,t.batchId);s.push(i.delete(h)),u.push(l.key)}return p.waitFor(s).next(()=>u)}function Au(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw S();e=n.noDocument}return JSON.stringify(e).length}wt.DEFAULT_COLLECTION_PERCENTILE=10,wt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,wt.DEFAULT=new wt(41943040,wt.DEFAULT_COLLECTION_PERCENTILE,wt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),wt.DISABLED=new wt(-1,0,0);var Su=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Cn={}}static lt(e,t,r,i){x(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Bn(e).Y({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=ki(e),o=Bn(e);return o.add({}).next(a=>{x(typeof a=="number");let c=new Go(a,t,r,i),u=function(f,E,w){let _=w.baseMutations.map($=>Yo(f.ct,$)),M=w.mutations.map($=>Yo(f.ct,$));return{userId:E,batchId:w.batchId,localWriteTimeMs:w.localWriteTime.toMillis(),baseMutations:_,mutations:M}}(this.serializer,this.userId,c),l=[],h=new ie((d,f)=>B(d.canonicalString(),f.canonicalString()));for(let d of i){let f=q0(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(u)),l.push(s.put(f,Ob))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.Cn[a]=c.keys()}),p.waitFor(l).next(()=>c)})}lookupMutationBatch(e,t){return Bn(e).get(t).next(r=>r?(x(r.userId===this.userId),Ar(this.serializer,r)):null)}vn(e,t){return this.Cn[t]?p.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Cn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Bn(e).Y({index:"userMutationsIndex",range:i},(o,a,c)=>{a.userId===this.userId&&(x(a.batchId>=r),s=Ar(this.serializer,a)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Bn(e).Y({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Bn(e).W("userMutationsIndex",t).next(r=>r.map(i=>Ar(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Zc(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return ki(e).Y({range:i},(o,a,c)=>{let[u,l,h]=o,d=Yt(l);if(u===this.userId&&t.path.isEqual(d))return Bn(e).get(h).next(f=>{if(!f)throw S();x(f.userId===this.userId),s.push(Ar(this.serializer,f))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ie(B),i=[];return t.forEach(s=>{let o=Zc(this.userId,s.path),a=IDBKeyRange.lowerBound(o),c=ki(e).Y({range:a},(u,l,h)=>{let[d,f,E]=u,w=Yt(f);d===this.userId&&s.path.isEqual(w)?r=r.add(E):h.done()});i.push(c)}),p.waitFor(i).next(()=>this.Fn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Zc(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new ie(B);return ki(e).Y({range:o},(c,u,l)=>{let[h,d,f]=c,E=Yt(d);h===this.userId&&r.isPrefixOf(E)?E.length===i&&(a=a.add(f)):l.done()}).next(()=>this.Fn(e,a))}Fn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Bn(e).get(s).next(o=>{if(o===null)throw S();x(o.userId===this.userId),r.push(Ar(this.serializer,o))}))}),p.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return OE(e.ae,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),p.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return p.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return ki(e).Y({range:r},(s,o,a)=>{if(s[0]===this.userId){let c=Yt(s[1]);i.push(c)}else a.done()}).next(()=>{x(i.length===0)})})}containsKey(e,t){return FE(e,this.userId,t)}xn(e){return LE(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function FE(n,e,t){let r=Zc(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return ki(n).Y({range:s,J:!0},(a,c,u)=>{let[l,h,d]=a;l===e&&h===i&&(o=!0),u.done()}).next(()=>o)}function Bn(n){return je(n,"mutations")}function ki(n){return je(n,"documentMutations")}function LE(n){return je(n,"mutationQueues")}var Ki=class n{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new n(0)}static Bn(){return new n(-1)}};var Yf=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Ln(e).next(t=>{let r=new Ki(t.highestTargetId);return t.highestTargetId=r.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Ln(e).next(t=>V.fromTimestamp(new ge(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Ln(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Ln(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.kn(e,i)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Ln(e).next(r=>(r.targetCount+=1,this.Qn(t,r),this.kn(e,r))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Di(e).delete(t.targetId)).next(()=>this.Ln(e)).next(r=>(x(r.targetCount>0),r.targetCount-=1,this.kn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Di(e).Y((o,a)=>{let c=Mo(a);c.sequenceNumber<=t&&r.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>p.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Di(e).Y((r,i)=>{let s=Mo(i);t(s)})}Ln(e){return w0(e).get("targetGlobalKey").next(t=>(x(t!==null),t))}kn(e,t){return w0(e).put("targetGlobalKey",t)}qn(e,t){return Di(e).put(VE(this.serializer,t))}Qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Ln(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Vr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Di(e).Y({range:i,index:"queryTargetsIndex"},(o,a,c)=>{let u=Mo(a);ca(t,u.target)&&(s=u,c.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=qn(e);return t.forEach(o=>{let a=Ze(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),p.waitFor(i)}removeMatchingKeys(e,t,r){let i=qn(e);return p.forEach(t,s=>{let o=Ze(s.path);return p.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=qn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=qn(e),s=q();return i.Y({range:r,J:!0},(o,a,c)=>{let u=Yt(o[1]),l=new I(u);s=s.add(l)}).next(()=>s)}containsKey(e,t){let r=Ze(t.path),i=IDBKeyRange.bound([r],[L0(r)],!1,!0),s=0;return qn(e).Y({index:"documentTargetsIndex",J:!0,range:i},([o,a],c,u)=>{o!==0&&(s++,u.done())}).next(()=>s>0)}_t(e,t){return Di(e).get(t).next(r=>r?Mo(r):null)}};function Di(n){return je(n,"targets")}function w0(n){return je(n,"targetGlobal")}function qn(n){return je(n,"targetDocuments")}function E0([n,e],[t,r]){let i=B(n,t);return i===0?B(e,r):i}var Xf=class{constructor(e){this.Kn=e,this.buffer=new ie(E0),this.$n=0}Un(){return++this.$n}Wn(e){let t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();E0(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Jf=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Gn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return this.Gn!==null}zn(e){v("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>m(this,null,function*(){this.Gn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){ir(t)?v("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield rr(t)}yield this.zn(3e5)}))}},Zf=class{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return p.resolve(dt._e);let r=new Xf(t);return this.jn.forEachTarget(e,i=>r.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(e,i=>r.Wn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(v("LruGarbageCollector","Garbage collection skipped; disabled"),p.resolve(_0)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),_0):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let r,i,s,o,a,c,u,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(v("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(s=h,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(u=Date.now(),Pi()<=Bt.DEBUG&&v("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-l}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(c-a)+`ms
	Removed ${h} documents in `+(u-c)+`ms
Total Duration: ${u-l}ms`),p.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}};function PR(n,e){return new Zf(n,e)}var ep=class{constructor(e,t){this.db=e,this.garbageCollector=PR(this,t)}Hn(e){let t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Zn(e){let t=0;return this.Jn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(r,i)=>t(i))}addReference(e,t,r){return Yc(e,r)}removeReference(e,t,r){return Yc(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Yc(e,t)}er(e,t){return function(i,s){let o=!1;return LE(i).Z(a=>FE(i,a,s).next(c=>(c&&(o=!0),p.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Xn(e,(o,a)=>{if(a<=t){let c=this.er(e,o).next(u=>{if(!u)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,V.min()),qn(e).delete(function(h){return[0,Ze(h.path)]}(o))))});i.push(c)}}).next(()=>p.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Yc(e,t)}Xn(e,t){let r=qn(e),i,s=dt._e;return r.Y({index:"documentTargetsIndex"},([o,a],{path:c,sequenceNumber:u})=>{o===0?(s!==dt._e&&t(new I(Yt(i)),s),s=u,i=c):s=dt._e}).next(()=>{s!==dt._e&&t(new I(Yt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Yc(n,e){return qn(n).put(function(r,i){return{targetId:0,path:Ze(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var bu=class{constructor(){this.changes=new rn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Me.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?p.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var tp=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Ir(e).put(r)}removeEntry(e,t,r){return Ir(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Eu(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.tr(e,r)))}getEntry(e,t){let r=Me.newInvalidDocument(t);return Ir(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Do(t))},(i,s)=>{r=this.nr(t,s)}).next(()=>r)}rr(e,t){let r={size:0,document:Me.newInvalidDocument(t)};return Ir(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Do(t))},(i,s)=>{r={document:this.nr(t,s),size:Au(s)}}).next(()=>r)}getEntries(e,t){let r=ot();return this.ir(e,t,(i,s)=>{let o=this.nr(i,s);r=r.insert(i,o)}).next(()=>r)}sr(e,t){let r=ot(),i=new ce(I.comparator);return this.ir(e,t,(s,o)=>{let a=this.nr(s,o);r=r.insert(s,a),i=i.insert(s,Au(o))}).next(()=>({documents:r,_r:i}))}ir(e,t,r){if(t.isEmpty())return p.resolve();let i=new ie(C0);t.forEach(c=>i=i.add(c));let s=IDBKeyRange.bound(Do(i.first()),Do(i.last())),o=i.getIterator(),a=o.getNext();return Ir(e).Y({index:"documentKeyIndex",range:s},(c,u,l)=>{let h=I.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&C0(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?l.U(Do(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Eu(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ir(e).W(IDBKeyRange.bound(a,c,!0)).next(u=>{s?.incrementDocumentReadCount(u.length);let l=ot();for(let h of u){let d=this.nr(I.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(la(t,d)||i.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(e,t,r,i){let s=ot(),o=T0(t,r),a=T0(t,It.max());return Ir(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(c,u,l)=>{let h=this.nr(I.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(e){return new np(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return I0(e).get("remoteDocumentGlobalKey").next(t=>(x(!!t),t))}tr(e,t){return I0(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){let r=bR(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(V.min())))return r}return Me.newInvalidDocument(e)}};function UE(n){return new tp(n)}var np=class extends bu{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new rn(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new ie((s,o)=>B(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.ur.get(s);if(t.push(this.ar.removeEntry(e,s,a.readTime)),o.isValidDocument()){let c=u0(this.ar.serializer,o);i=i.add(s.path.popLast());let u=Au(c);r+=u-a.size,t.push(this.ar.addEntry(e,s,c))}else if(r-=a.size,this.trackRemovals){let c=u0(this.ar.serializer,o.convertToNoDocument(V.min()));t.push(this.ar.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ar.updateMetadata(e,r)),p.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(r=>(this.ur.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:r,_r:i})=>(i.forEach((s,o)=>{this.ur.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function I0(n){return je(n,"remoteDocumentGlobal")}function Ir(n){return je(n,"remoteDocumentsV14")}function Do(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function T0(n,e){let t=e.documentKey.path.toArray();return[n,Eu(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function C0(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=B(t[s],r[s]),i)return i;return i=B(t.length,r.length),i||(i=B(t[t.length-2],r[r.length-2]),i||B(t[t.length-1],r[r.length-1]))}var rp=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Ru=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&No(r.mutation,i,ft.empty(),ge.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,q()).next(()=>r))}getLocalViewOfDocuments(e,t,r=q()){let i=Xt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=xo();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Xt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,q()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=ot(),o=ko(),a=function(){return ko()}();return t.forEach((c,u)=>{let l=r.get(u.key);i.has(u.key)&&(l===void 0||l.mutation instanceof kt)?s=s.insert(u.key,u):l!==void 0?(o.set(u.key,l.mutation.getFieldMask()),No(l.mutation,u,l.mutation.getFieldMask(),ge.now())):o.set(u.key,ft.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((u,l)=>o.set(u,l)),t.forEach((u,l)=>{var h;return a.set(u,new rp(l,(h=o.get(u))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){let r=ko(),i=new ce((o,a)=>o-a),s=q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(c=>{let u=t.get(c);if(u===null)return;let l=r.get(c)||ft.empty();l=a.applyToLocalView(u,l),r.set(c,l);let h=(i.get(a.batchId)||q()).add(c);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),u=c.key,l=c.value,h=cE();l.forEach(d=>{if(!s.has(d)){let f=mE(t.get(d),r.get(d));f!==null&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,h))}return p.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return I.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):cg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):p.resolve(Xt()),a=-1,c=s;return o.next(u=>p.forEach(u,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?p.resolve():this.remoteDocumentCache.getEntry(e,l).next(d=>{c=c.insert(l,d)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,c,u,q())).next(l=>({batchId:a,changes:aE(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new I(t)).next(r=>{let i=xo();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=xo();return this.indexManager.getCollectionParents(e,s).next(a=>p.forEach(a,c=>{let u=function(h,d){return new Vt(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((c,u)=>{let l=u.getKey();o.get(l)===null&&(o=o.insert(l,Me.newInvalidDocument(l)))});let a=xo();return o.forEach((c,u)=>{let l=s.get(c);l!==void 0&&No(l.mutation,u,ft.empty(),ge.now()),la(t,u)&&(a=a.insert(c,u))}),a})}};var ip=class{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return p.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Ce(i.createTime)}}(t)),p.resolve()}getNamedQuery(e,t){return p.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(i){return{name:i.name,query:hg(i.bundledQuery),readTime:Ce(i.readTime)}}(t)),p.resolve()}};var sp=class{constructor(){this.overlays=new ce(I.comparator),this.hr=new Map}getOverlay(e,t){return p.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Xt();return p.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),p.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.hr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),p.resolve()}getOverlaysForCollection(e,t,r){let i=Xt(),s=t.length+1,o=new I(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return p.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ce((u,l)=>u-l),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let l=s.get(u.largestBatchId);l===null&&(l=Xt(),s=s.insert(u.largestBatchId,l)),l.set(u.getKey(),u)}}let a=Xt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,l)=>a.set(u,l)),!(a.size()>=i)););return p.resolve(a)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Wo(t,r));let s=this.hr.get(t);s===void 0&&(s=q(),this.hr.set(t,s)),this.hr.set(t,s.add(r.key))}};var Jo=class{constructor(){this.Pr=new ie(De.Ir),this.Tr=new ie(De.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){let r=new De(e,t);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Ar(new De(e,t))}Rr(e,t){e.forEach(r=>this.removeReference(r,t))}Vr(e){let t=new I(new X([])),r=new De(t,e),i=new De(t,e+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){let t=new I(new X([])),r=new De(t,e),i=new De(t,e+1),s=q();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new De(e,0),r=this.Pr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},De=class{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return I.comparator(e.key,t.key)||B(e.pr,t.pr)}static Er(e,t){return B(e.pr,t.pr)||I.comparator(e.key,t.key)}};var op=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new ie(De.Ir)}checkEmpty(e){return p.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Go(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.wr=this.wr.add(new De(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return p.resolve(o)}lookupMutationBatch(e,t){return p.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.br(r),s=i<0?0:i;return p.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return p.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(e){return p.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new De(t,0),i=new De(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{let a=this.Sr(o.pr);s.push(a)}),p.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ie(B);return t.forEach(i=>{let s=new De(i,0),o=new De(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),p.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;I.isDocumentKey(s)||(s=s.child(""));let o=new De(new I(s),0),a=new ie(B);return this.wr.forEachWhile(c=>{let u=c.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(a=a.add(c.pr)),!0)},o),p.resolve(this.Dr(a))}Dr(e){let t=[];return e.forEach(r=>{let i=this.Sr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){x(this.Cr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.wr;return p.forEach(t.mutations,i=>{let s=new De(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=r})}Mn(e){}containsKey(e,t){let r=new De(t,0),i=this.wr.firstAfterOrEqual(r);return p.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,p.resolve()}Cr(e,t){return this.br(e)}br(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Sr(e){let t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var ap=class{constructor(e){this.vr=e,this.docs=function(){return new ce(I.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return p.resolve(r?r.document.mutableCopy():Me.newInvalidDocument(t))}getEntries(e,t){let r=ot();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Me.newInvalidDocument(i))}),p.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=ot(),o=t.path,a=new I(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:u,value:{document:l}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||ig(j0(l),r)<=0||(i.has(l.key)||la(t,l))&&(s=s.insert(l.key,l.mutableCopy()))}return p.resolve(s)}getAllFromCollectionGroup(e,t,r,i){S()}Fr(e,t){return p.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new cp(this)}getSize(e){return p.resolve(this.size)}},cp=class extends bu{constructor(e){super(),this.ar=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(r)}),p.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}};var up=class{constructor(e){this.persistence=e,this.Mr=new rn(t=>Vr(t),ca),this.lastRemoteSnapshotVersion=V.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Jo,this.targetCount=0,this.Br=Ki.Nn()}forEachTarget(e,t){return this.Mr.forEach((r,i)=>t(i)),p.resolve()}getLastRemoteSnapshotVersion(e){return p.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return p.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),p.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Or&&(this.Or=t),p.resolve()}qn(e){this.Mr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Br=new Ki(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,p.resolve()}updateTargetData(e,t){return this.qn(t),p.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,p.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),p.waitFor(s).next(()=>i)}getTargetCount(e){return p.resolve(this.targetCount)}getTargetData(e,t){let r=this.Mr.get(t)||null;return p.resolve(r)}addMatchingKeys(e,t,r){return this.Nr.dr(t,r),p.resolve()}removeMatchingKeys(e,t,r){this.Nr.Rr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),p.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),p.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Nr.gr(t);return p.resolve(r)}containsKey(e,t){return p.resolve(this.Nr.containsKey(t))}};var Du=class{constructor(e,t){this.Lr={},this.overlays={},this.kr=new dt(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new up(this),this.indexManager=new Hf,this.remoteDocumentCache=function(i){return new ap(i)}(r=>this.referenceDelegate.Kr(r)),this.serializer=new wu(t),this.$r=new ip(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sp,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Lr[e.toKey()];return r||(r=new op(t,this.referenceDelegate),this.Lr[e.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,r){v("MemoryPersistence","Starting transaction:",e);let i=new lp(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,t){return p.or(Object.values(this.Lr).map(r=>()=>r.containsKey(e,t)))}},lp=class extends cu{constructor(e){super(),this.currentSequenceNumber=e}},Pu=class n{constructor(e){this.persistence=e,this.zr=new Jo,this.jr=null}static Hr(e){return new n(e)}get Jr(){if(this.jr)return this.jr;throw S()}addReference(e,t,r){return this.zr.addReference(r,t),this.Jr.delete(r.toString()),p.resolve()}removeReference(e,t,r){return this.zr.removeReference(r,t),this.Jr.add(r.toString()),p.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),p.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return p.forEach(this.Jr,r=>{let i=I.fromPath(r);return this.Yr(e,i).next(s=>{s||t.removeEntry(i,V.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(r=>{r?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return p.or([()=>p.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}};var hp=class{constructor(e){this.serializer=e}N(e,t,r,i){let s=new uu("createOrUpgrade",t);r<1&&i>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",$w,{unique:!0}),c.createObjectStore("documentMutations")}(e),A0(e),function(c){c.createObjectStore("remoteDocuments")}(e));let o=p.resolve();return r<3&&i>=3&&(r!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),A0(e)),o=o.next(()=>function(c){let u=c.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:V.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(c,u){return u.store("mutations").W().next(l=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",$w,{unique:!0});let h=u.store("mutations"),d=l.map(f=>h.put(f));return p.waitFor(d)})}(e,s))),o=o.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.Xr(s))),r<6&&i>=6&&(o=o.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ei(s)))),r<7&&i>=7&&(o=o.next(()=>this.ti(s))),r<8&&i>=8&&(o=o.next(()=>this.ni(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.ri(s))),r<11&&i>=11&&(o=o.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(c){let u=c.createObjectStore("documentOverlays",{keyPath:Hb});u.createIndex("collectionPathOverlayIndex",Qb,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",Yb,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(c){let u=c.createObjectStore("remoteDocumentsV14",{keyPath:Fb});u.createIndex("documentKeyIndex",Lb),u.createIndex("collectionGroupIndex",Ub)}(e)).next(()=>this.ii(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.si(e,s))),r<15&&i>=15&&(o=o.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:zb}).createIndex("sequenceNumberIndex",Gb,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:Wb}).createIndex("documentKeyIndex",Kb,{unique:!1})}(e))),o}ei(e){let t=0;return e.store("remoteDocuments").Y((r,i)=>{t+=Au(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Xr(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>p.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>p.forEach(a,c=>{x(c.userId===s.userId);let u=Ar(this.serializer,c);return OE(e,s.userId,u).next(()=>{})}))}))}ti(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.Y((o,a)=>{let c=new X(o),u=function(h){return[0,Ze(h)]}(c);s.push(t.get(u).next(l=>l?p.resolve():(h=>t.put({targetId:0,path:Ze(h),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>p.waitFor(s))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:qb});let r=t.store("collectionParents"),i=new Xo,s=o=>{if(i.add(o)){let a=o.lastSegment(),c=o.popLast();return r.put({collectionId:a,parent:Ze(c)})}};return t.store("remoteDocuments").Y({J:!0},(o,a)=>{let c=new X(o);return s(c.popLast())}).next(()=>t.store("documentMutations").Y({J:!0},([o,a,c],u)=>{let l=Yt(a);return s(l.popLast())}))}ri(e){let t=e.store("targets");return t.Y((r,i)=>{let s=Mo(i),o=VE(this.serializer,s);return t.put(o)})}ii(e,t){let r=t.store("remoteDocuments"),i=[];return r.Y((s,o)=>{let a=t.store("remoteDocumentsV14"),c=function(h){return h.document?new I(X.fromString(h.document.name).popFirst(5)):h.noDocument?I.fromSegments(h.noDocument.path):h.unknownDocument?I.fromSegments(h.unknownDocument.path):S()}(o).path.toArray(),u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(u))}).next(()=>p.waitFor(i))}si(e,t){let r=t.store("mutations"),i=UE(this.serializer),s=new Du(Pu.Hr,this.serializer.ct);return r.W().next(o=>{let a=new Map;return o.forEach(c=>{var u;let l=(u=a.get(c.userId))!==null&&u!==void 0?u:q();Ar(this.serializer,c).keys().forEach(h=>l=l.add(h)),a.set(c.userId,l)}),p.forEach(a,(c,u)=>{let l=new Pe(u),h=Iu.lt(this.serializer,l),d=s.getIndexManager(l),f=Su.lt(l,this.serializer,d,s.referenceDelegate);return new Ru(i,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new jo(t,dt._e),c).next()})})}};function A0(n){n.createObjectStore("targetDocuments",{keyPath:$b}).createIndex("documentTargetsIndex",Bb,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",jb,{unique:!0}),n.createObjectStore("targetGlobal")}var tf="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",dp=class n{constructor(e,t,r,i,s,o,a,c,u,l,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.oi=s,this.window=o,this.document=a,this._i=u,this.ai=l,this.ui=h,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=d=>Promise.resolve(),!n.D())throw new y(g.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ep(this,i),this.Ti=t+"main",this.serializer=new wu(c),this.Ei=new mn(this.Ti,this.ui,new hp(this.serializer)),this.Qr=new Yf(this.referenceDelegate,this.serializer),this.remoteDocumentCache=UE(this.serializer),this.$r=new $f,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,l===!1&&Ie("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new y(g.FAILED_PRECONDITION,tf);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new dt(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){return this.Ii=t=>m(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L(t=>m(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget(()=>m(this,null,function*(){this.started&&(yield this.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Xc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(t=>{t||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(ir(e))return v("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return v("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return Po(e).get("owner").next(t=>p.resolve(this.Si(t)))}bi(e){return Xc(e).delete(this.clientId)}Di(){return m(this,null,function*(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=je(t,"clientMetadata");return r.W().next(i=>{let s=this.vi(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return p.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.di)for(let t of e)this.di.removeItem(this.Fi(t.clientId))}})}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?p.resolve(!0):Po(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new y(g.FAILED_PRECONDITION,tf);return!1}}return!(!this.networkEnabled||!this.inForeground)||Xc(e).W().next(r=>this.vi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&v("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return m(this,null,function*(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),yield this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new jo(e,dt._e);return this.yi(t).next(()=>this.bi(t))}),this.Ei.close(),this.Bi()})}vi(e,t){return e.filter(r=>this.Ci(r.updateTimeMs,t)&&!this.Mi(r.clientId))}Li(){return this.runTransaction("getActiveClients","readonly",e=>Xc(e).W().next(t=>this.vi(t,18e5).map(r=>r.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return Su.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Qf(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Iu.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,r){v("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(c){return c===15?Jb:c===14?W0:c===13?G0:c===12?Xb:c===11?z0:void S()}(this.ui),o;return this.Ei.runTransaction(e,i,s,a=>(o=new jo(a,this.kr?this.kr.next():dt._e),t==="readwrite-primary"?this.gi(o).next(c=>!!c||this.pi(o)).next(c=>{if(!c)throw Ie(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new y(g.FAILED_PRECONDITION,$0);return r(o)}).next(c=>this.wi(o).next(()=>c)):this.ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}ki(e){return Po(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)&&!this.Si(t)&&!(this.ai||this.allowTabSynchronization&&t.allowTabSynchronization))throw new y(g.FAILED_PRECONDITION,tf)})}wi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Po(e).put("owner",t)}static D(){return mn.D()}yi(e){let t=Po(e);return t.get("owner").next(r=>this.Si(r)?(v("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):p.resolve())}Ci(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(Ie(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Ri(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground=this.document.visibilityState==="visible")}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.ci=()=>{this.xi();let t=/(?:Version|Mobile)\/1[456]/;Bl()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{let r=((t=this.di)===null||t===void 0?void 0:t.getItem(this.Fi(e)))!==null;return v("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ie("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){Ie("Failed to set zombie client id.",e)}}Bi(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Po(n){return je(n,"owner")}function Xc(n){return je(n,"clientMetadata")}function fg(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var fp=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.qi=r,this.Qi=i}static Ki(e,t){let r=q(),i=q();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var pp=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var xu=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return Bl()?8:mn.v(Cs())>0?6:4}()}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ji(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new pp;return this.Ji(e,t,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(e,t,o,a.size)})}).next(()=>s.result)}Yi(e,t,r,i){return r.documentReadCount<this.Wi?(Pi()<=Bt.DEBUG&&v("QueryEngine","SDK will not create cache indexes for query:",xi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),p.resolve()):(Pi()<=Bt.DEBUG&&v("QueryEngine","Query:",xi(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(Pi()<=Bt.DEBUG&&v("QueryEngine","The SDK decides to create cache indexes for query:",xi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,et(t))):p.resolve())}ji(e,t){if(Jw(t))return p.resolve(null);let r=et(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=mu(t,null,"F"),r=et(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=q(...s);return this.zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{let u=this.Zi(t,a);return this.Xi(t,u,o,c.readTime)?this.ji(e,mu(t,null,"F")):this.es(e,u,t,c)}))})))}Hi(e,t,r,i){return Jw(t)||i.isEqual(V.min())?p.resolve(null):this.zi.getDocuments(e,r).next(s=>{let o=this.Zi(t,s);return this.Xi(t,o,r,i)?p.resolve(null):(Pi()<=Bt.DEBUG&&v("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),xi(t)),this.es(e,o,t,U0(i,-1)).next(a=>a))})}Zi(e,t){let r=new ie(sE(e));return t.forEach((i,s)=>{la(e,s)&&(r=r.add(s))}),r}Xi(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,r){return Pi()<=Bt.DEBUG&&v("QueryEngine","Using full collection scan to execute query:",xi(t)),this.zi.getDocumentsMatchingQuery(e,t,It.min(),r)}es(e,t,r,i){return this.zi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var gp=class{constructor(e,t,r,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new ce(B),this.rs=new rn(s=>Vr(s),ca),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(r)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ru(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}};function jE(n,e,t,r){return new gp(n,e,t,r)}function $E(n,e){return m(this,null,function*(){let t=C(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t._s(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],c=q();for(let u of i){o.push(u.batchId);for(let l of u.mutations)c=c.add(l.key)}for(let u of s){a.push(u.batchId);for(let l of u.mutations)c=c.add(l.key)}return t.localDocuments.getDocuments(r,c).next(u=>({us:u,removedBatchIds:o,addedBatchIds:a}))})})})}function xR(n,e){let t=C(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.os.newChangeBuffer({trackRemovals:!0});return function(a,c,u,l){let h=u.batch,d=h.keys(),f=p.resolve();return d.forEach(E=>{f=f.next(()=>l.getEntry(c,E)).next(w=>{let _=u.docVersions.get(E);x(_!==null),w.version.compareTo(_)<0&&(h.applyToRemoteDocument(w,u),w.isValidDocument()&&(w.setReadTime(u.commitVersion),l.addEntry(w)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(c,h))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=q();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function BE(n){let e=C(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function MR(n,e){let t=C(n),r=e.snapshotVersion,i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;let a=[];e.targetChanges.forEach((l,h)=>{let d=i.get(h);if(!d)return;a.push(t.Qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>t.Qr.addMatchingKeys(s,l.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?f=f.withResumeToken(Ue.EMPTY_BYTE_STRING,V.min()).withLastLimboFreeSnapshotVersion(V.min()):l.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(l.resumeToken,r)),i=i.insert(h,f),function(w,_,M){return w.resumeToken.approximateByteSize()===0||_.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8?!0:M.addedDocuments.size+M.modifiedDocuments.size+M.removedDocuments.size>0}(d,f,l)&&a.push(t.Qr.updateTargetData(s,f))});let c=ot(),u=q();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(qE(s,o,e.documentUpdates).next(l=>{c=l.cs,u=l.ls})),!r.isEqual(V.min())){let l=t.Qr.getLastRemoteSnapshotVersion(s).next(h=>t.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return p.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,u)).next(()=>c)}).then(s=>(t.ns=i,s))}function qE(n,e,t){let r=q(),i=q();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=ot();return t.forEach((a,c)=>{let u=s.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(a)),c.isNoDocument()&&c.version.isEqual(V.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):v("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{cs:o,ls:i}})}function VR(n,e){let t=C(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Hi(n,e){let t=C(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Qr.getTargetData(r,e).next(s=>s?(i=s,p.resolve(i)):t.Qr.allocateTargetId(r).next(o=>(i=new Wi(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.ns.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(r.targetId,r),t.rs.set(e,r.targetId)),r})}function Qi(n,e,t){return m(this,null,function*(){let r=C(n),i=r.ns.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!ir(o))throw o;v("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)})}function Mu(n,e,t){let r=C(n),i=V.min(),s=q();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,l){let h=C(c),d=h.rs.get(l);return d!==void 0?p.resolve(h.ns.get(d)):h.Qr.getTargetData(u,l)}(r,o,et(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>r.ts.getDocumentsMatchingQuery(o,e,t?i:V.min(),t?s:q())).next(a=>(WE(r,iE(e),a),{documents:a,hs:s})))}function zE(n,e){let t=C(n),r=C(t.Qr),i=t.ns.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r._t(s,e).next(o=>o?o.target:null))}function GE(n,e){let t=C(n),r=t.ss.get(e)||V.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.os.getAllFromCollectionGroup(i,e,U0(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(WE(t,e,i),i))}function WE(n,e,t){let r=n.ss.get(e)||V.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.ss.set(e,r)}function kR(n,e,t,r){return m(this,null,function*(){let i=C(n),s=q(),o=ot();for(let u of t){let l=e.Ps(u.metadata.name);u.document&&(s=s.add(l));let h=e.Is(u);h.setReadTime(e.Ts(u.metadata.readTime)),o=o.insert(l,h)}let a=i.os.newChangeBuffer({trackRemovals:!0}),c=yield Hi(i,function(l){return et(ns(X.fromString(`__bundle__/docs/${l}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",u=>qE(u,a,o).next(l=>(a.apply(u),l)).next(l=>i.Qr.removeMatchingKeysForTargetId(u,c.targetId).next(()=>i.Qr.addMatchingKeys(u,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(u,l.cs,l.ls)).next(()=>l.cs)))})}function NR(r,i){return m(this,arguments,function*(n,e,t=q()){let s=yield Hi(n,et(hg(e.bundledQuery))),o=C(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let c=Ce(e.readTime);if(s.snapshotVersion.compareTo(c)>=0)return o.$r.saveNamedQuery(a,e);let u=s.withResumeToken(Ue.EMPTY_BYTE_STRING,c);return o.ns=o.ns.insert(u.targetId,u),o.Qr.updateTargetData(a,u).next(()=>o.Qr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Qr.addMatchingKeys(a,t,s.targetId)).next(()=>o.$r.saveNamedQuery(a,e))})})}function S0(n,e){return`firestore_clients_${n}_${e}`}function b0(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function nf(n,e){return`firestore_targets_${n}_${e}`}var Vu=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Es(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new y(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(Ie("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Oo=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Es(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new y(r.error.code,r.error.message))),s?new n(e,r.state,i):(Ie("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},ku=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=ug();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=B0(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Ie("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},mp=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Ie("SharedClientState",`Failed to parse online state: ${e}`),null)}},Zo=class{constructor(){this.activeTargetIds=ug()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Fo=class{constructor(e,t,r,i,s){this.window=e,this.oi=t,this.persistenceKey=r,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new ce(B),this.started=!1,this.ys=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=S0(this.persistenceKey,this.Vs),this.Ss=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new Zo),this.bs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Fs=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}start(){return m(this,null,function*(){let e=yield this.syncEngine.Li();for(let r of e){if(r===this.Vs)continue;let i=this.getItem(S0(this.persistenceKey,r));if(i){let s=ku.Es(r,i);s&&(this.ps=this.ps.insert(s.clientId,s))}}this.Ms();let t=this.storage.getItem(this.vs);if(t){let r=this.xs(t);r&&this.Os(r)}for(let r of this.ys)this.gs(r);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Bs(e,"pending")}updateMutationState(e,t,r){this.Bs(e,t,r),this.Ls(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(nf(this.persistenceKey,e));if(r){let i=Oo.Es(e,r);i&&(t=i.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(nf(this.persistenceKey,e))}updateQueryState(e,t,r){this.qs(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Ls(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return v("SharedClientState","READ",e,t),t}setItem(e,t){v("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){v("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){let t=e;if(t.storageArea===this.storage){if(v("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ws)return void Ie("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(()=>m(this,null,function*(){if(this.started){if(t.key!==null){if(this.bs.test(t.key)){if(t.newValue==null){let r=this.$s(t.key);return this.Us(r,null)}{let r=this.Ws(t.key,t.newValue);if(r)return this.Us(r.clientId,r)}}else if(this.Ds.test(t.key)){if(t.newValue!==null){let r=this.Gs(t.key,t.newValue);if(r)return this.zs(r)}}else if(this.Cs.test(t.key)){if(t.newValue!==null){let r=this.js(t.key,t.newValue);if(r)return this.Hs(r)}}else if(t.key===this.vs){if(t.newValue!==null){let r=this.xs(t.newValue);if(r)return this.Os(r)}}else if(t.key===this.Ss){let r=function(s){let o=dt._e;if(s!=null)try{let a=JSON.parse(s);x(typeof a=="number"),o=a}catch(a){Ie("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==dt._e&&this.sequenceNumberHandler(r)}else if(t.key===this.Fs){let r=this.Js(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.Ys(i)))}}}else this.ys.push(t)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Bs(e,t,r){let i=new Vu(this.currentUser,e,t,r),s=b0(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ds())}Ls(e){let t=b0(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){let t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,r){let i=nf(this.persistenceKey,e),s=new Oo(e,t,r);this.setItem(i,s.ds())}Ks(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){let t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){let r=this.$s(e);return ku.Es(r,t)}Gs(e,t){let r=this.Ds.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Vu.Es(new Pe(s),i,t)}js(e,t){let r=this.Cs.exec(e),i=Number(r[1]);return Oo.Es(i,t)}xs(e){return mp.Es(e)}Js(e){return JSON.parse(e)}zs(e){return m(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);v("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){let r=t?this.ps.insert(e,t):this.ps.remove(e),i=this.Ns(this.ps),s=this.Ns(r),o=[],a=[];return s.forEach(c=>{i.has(c)||o.push(c)}),i.forEach(c=>{s.has(c)||a.push(c)}),this.syncEngine.eo(o,a).then(()=>{this.ps=r})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=ug();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},Nu=class{constructor(){this.no=new Zo,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,r){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Zo,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var yp=class{io(e){}shutdown(){}};var Ou=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){v("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.uo)e(0)}ao(){v("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.uo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Jc=null;function rf(){return Jc===null?Jc=function(){return 268435456+Math.round(2147483648*Math.random())}():Jc++,"0x"+Jc.toString(16)}var OR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var vp=class{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}};var We="WebChannelConnection",_p=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+t.host,this.po=`projects/${i}/databases/${s}`,this.yo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get wo(){return!1}So(t,r,i,s,o){let a=rf(),c=this.bo(t,r.toUriEncodedString());v("RestConnection",`Sending RPC '${t}' ${a}:`,c,i);let u={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(u,s,o),this.Co(t,c,u,i).then(l=>(v("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw Et("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",c,"request:",i),l})}vo(t,r,i,s,o,a){return this.So(t,r,i,s,o)}Do(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ts}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}bo(t,r){let i=OR[t];return`${this.fo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,r,i){let s=rf();return new Promise((o,a)=>{let c=new Ow;c.setWithCredentials(!0),c.listenOnce(kw.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Hc.NO_ERROR:let l=c.getResponseJson();v(We,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case Hc.TIMEOUT:v(We,`RPC '${e}' ${s} timed out`),a(new y(g.DEADLINE_EXCEEDED,"Request time out"));break;case Hc.HTTP_ERROR:let h=c.getStatus();if(v(We,`RPC '${e}' ${s} failed with status:`,h,"response text:",c.getResponseText()),h>0){let d=c.getResponseJson();Array.isArray(d)&&(d=d[0]);let f=d?.error;if(f&&f.status&&f.message){let E=function(_){let M=_.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(M)>=0?M:g.UNKNOWN}(f.status);a(new y(E,f.message))}else a(new y(g.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new y(g.UNAVAILABLE,"Connection failed."));break;default:S()}}finally{v(We,`RPC '${e}' ${s} completed.`)}});let u=JSON.stringify(i);v(We,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",u,r,15)})}Fo(e,t,r){let i=rf(),s=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Mw(),a=Vw(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Do(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;let l=s.join("");v(We,`Creating RPC '${e}' stream ${i}: ${l}`,c);let h=o.createWebChannel(l,c),d=!1,f=!1,E=new vp({lo:_=>{f?v(We,`Not sending because RPC '${e}' stream ${i} is closed:`,_):(d||(v(We,`Opening RPC '${e}' stream ${i} transport.`),h.open(),d=!0),v(We,`RPC '${e}' stream ${i} sending:`,_),h.send(_))},ho:()=>h.close()}),w=(_,M,$)=>{_.listen(M,D=>{try{$(D)}catch(W){setTimeout(()=>{throw W},0)}})};return w(h,So.EventType.OPEN,()=>{f||v(We,`RPC '${e}' stream ${i} transport opened.`)}),w(h,So.EventType.CLOSE,()=>{f||(f=!0,v(We,`RPC '${e}' stream ${i} transport closed`),E.Vo())}),w(h,So.EventType.ERROR,_=>{f||(f=!0,Et(We,`RPC '${e}' stream ${i} transport errored:`,_),E.Vo(new y(g.UNAVAILABLE,"The operation could not be completed")))}),w(h,So.EventType.MESSAGE,_=>{var M;if(!f){let $=_.data[0];x(!!$);let D=$,W=D.error||((M=D[0])===null||M===void 0?void 0:M.error);if(W){v(We,`RPC '${e}' stream ${i} received error:`,W);let K=W.status,Z=function(XI){let bm=Re[XI];if(bm!==void 0)return _E(bm)}(K),Ae=W.message;Z===void 0&&(Z=g.INTERNAL,Ae="Unknown error status: "+K+" with message "+W.message),f=!0,E.Vo(new y(Z,Ae)),h.close()}else v(We,`RPC '${e}' stream ${i} received:`,$),E.mo($)}}),w(a,Nw.STAT_EVENT,_=>{_.stat===Zd.PROXY?v(We,`RPC '${e}' stream ${i} detected buffering proxy`):_.stat===Zd.NOPROXY&&v(We,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{E.Ro()},0),E}};function KE(){return typeof window<"u"?window:null}function ru(){return typeof document<"u"?document:null}function ha(n){return new Of(n,!0)}var ea=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=t,this.Mo=r,this.xo=i,this.Oo=s,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();let t=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Lo),i=Math.max(0,t-r);i>0&&v("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Lo=Date.now(),e())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){this.Bo!==null&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){this.Bo!==null&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}};var Fu=class{constructor(e,t,r,i,s,o,a,c){this.oi=e,this.$o=r,this.Uo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new ea(e,t)}Ho(){return this.state===1||this.state===5||this.Jo()}Jo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Yo()}stop(){return m(this,null,function*(){this.Ho()&&(yield this.close(0))})}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&this.Go===null&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(e){this.n_(),this.stream.send(e)}e_(){return m(this,null,function*(){if(this.Jo())return this.close(0)})}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(e,t){return m(this,null,function*(){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,e!==4?this.jo.reset():t&&t.code===g.RESOURCE_EXHAUSTED?(Ie(t.toString()),Ie("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):t&&t.code===g.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.To(t)})}i_(){}auth(){this.state=1;let e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Wo===t&&this.o_(r,i)},r=>{e(()=>{let i=new y(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(i)})})}o_(e,t){let r=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(i=>{r(()=>this.__(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Yo(){this.state=5,this.jo.qo(()=>m(this,null,function*(){this.state=0,this.start()}))}__(e){return v("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget(()=>this.Wo===e?t():(v("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},wp=class extends Fu{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();let t=wR(this.serializer,e),r=function(s){if(!("targetChange"in s))return V.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?V.min():o.readTime?Ce(o.readTime):V.min()}(e);return this.listener.u_(t,r)}c_(e){let t={};t.database=Uf(this.serializer),t.addTarget=function(s,o){let a,c=o.target;if(a=pu(c)?{documents:bE(s,c)}:{query:RE(s,c).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=EE(s,o.resumeToken);let u=Ff(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(V.min())>0){a.readTime=Gi(s,o.snapshotVersion.toTimestamp());let u=Ff(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);let r=IR(this.serializer,e);r&&(t.labels=r),this.t_(t)}l_(e){let t={};t.database=Uf(this.serializer),t.removeTarget=e,this.t_(t)}},Ep=class extends Fu{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){if(x(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();let t=ER(e.writeResults,e.commitTime),r=Ce(e.commitTime);return this.listener.T_(r,t)}return x(!e.writeResults||e.writeResults.length===0),this.h_=!0,this.listener.E_()}d_(){let e={};e.database=Uf(this.serializer),this.t_(e)}I_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Yo(this.serializer,r))};this.t_(t)}};var Ip=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.A_=!1}R_(){if(this.A_)throw new y(g.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(e,Lf(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new y(g.UNKNOWN,s.toString())})}vo(e,t,r,i,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(e,Lf(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new y(g.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}};var Tp=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){this.m_===0&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(e){this.state==="Online"?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,e==="Online"&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(Ie(t),this.g_=!1):v("OnlineStateTracker",t)}b_(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}};var Cp=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(o=>{r.enqueueAndForget(()=>m(this,null,function*(){sr(this)&&(v("RemoteStore","Restarting streams for network reachability change."),yield function(c){return m(this,null,function*(){let u=C(c);u.v_.add(4),yield rs(u),u.x_.set("Unknown"),u.v_.delete(4),yield da(u)})}(this))}))}),this.x_=new Tp(r,i)}};function da(n){return m(this,null,function*(){if(sr(n))for(let e of n.F_)yield e(!0)})}function rs(n){return m(this,null,function*(){for(let e of n.F_)yield e(!1)})}function nl(n,e){let t=C(n);t.C_.has(e.targetId)||(t.C_.set(e.targetId,e),mg(t)?gg(t):ss(t).Jo()&&pg(t,e))}function ta(n,e){let t=C(n),r=ss(t);t.C_.delete(e),r.Jo()&&HE(t,e),t.C_.size===0&&(r.Jo()?r.Xo():sr(t)&&t.x_.set("Unknown"))}function pg(n,e){if(n.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(V.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ss(n).c_(e)}function HE(n,e){n.O_.Oe(e),ss(n).l_(e)}function gg(n){n.O_=new Nf({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.C_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),ss(n).start(),n.x_.p_()}function mg(n){return sr(n)&&!ss(n).Ho()&&n.C_.size>0}function sr(n){return C(n).v_.size===0}function QE(n){n.O_=void 0}function FR(n){return m(this,null,function*(){n.C_.forEach((e,t)=>{pg(n,e)})})}function LR(n,e){return m(this,null,function*(){QE(n),mg(n)?(n.x_.S_(e),gg(n)):n.x_.set("Unknown")})}function UR(n,e,t){return m(this,null,function*(){if(n.x_.set("Online"),e instanceof vu&&e.state===2&&e.cause)try{yield function(i,s){return m(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.C_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.C_.delete(a),i.O_.removeTarget(a))})}(n,e)}catch(r){v("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Lu(n,r)}else if(e instanceof Li?n.O_.$e(e):e instanceof yu?n.O_.Je(e):n.O_.Ge(e),!t.isEqual(V.min()))try{let r=yield BE(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.O_.it(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){let l=s.C_.get(u);l&&s.C_.set(u,l.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{let l=s.C_.get(c);if(!l)return;s.C_.set(c,l.withResumeToken(Ue.EMPTY_BYTE_STRING,l.snapshotVersion)),HE(s,c);let h=new Wi(l.target,c,u,l.sequenceNumber);pg(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){v("RemoteStore","Failed to raise snapshot:",r),yield Lu(n,r)}})}function Lu(n,e,t){return m(this,null,function*(){if(!ir(e))throw e;n.v_.add(1),yield rs(n),n.x_.set("Offline"),t||(t=()=>BE(n.localStore)),n.asyncQueue.enqueueRetryable(()=>m(this,null,function*(){v("RemoteStore","Retrying IndexedDB access"),yield t(),n.v_.delete(1),yield da(n)}))})}function YE(n,e){return e().catch(t=>Lu(n,t,e))}function is(n){return m(this,null,function*(){let e=C(n),t=nr(e),r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;jR(e);)try{let i=yield VR(e.localStore,r);if(i===null){e.D_.length===0&&t.Xo();break}r=i.batchId,$R(e,i)}catch(i){yield Lu(e,i)}XE(e)&&JE(e)})}function jR(n){return sr(n)&&n.D_.length<10}function $R(n,e){n.D_.push(e);let t=nr(n);t.Jo()&&t.P_&&t.I_(e.mutations)}function XE(n){return sr(n)&&!nr(n).Ho()&&n.D_.length>0}function JE(n){nr(n).start()}function BR(n){return m(this,null,function*(){nr(n).d_()})}function qR(n){return m(this,null,function*(){let e=nr(n);for(let t of n.D_)e.I_(t.mutations)})}function zR(n,e,t){return m(this,null,function*(){let r=n.D_.shift(),i=Mf.from(r,e,t);yield YE(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield is(n)})}function GR(n,e){return m(this,null,function*(){e&&nr(n).P_&&(yield function(r,i){return m(this,null,function*(){if(function(o){return vE(o)&&o!==g.ABORTED}(i.code)){let s=r.D_.shift();nr(r).Zo(),yield YE(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield is(r)}})}(n,e)),XE(n)&&JE(n)})}function R0(n,e){return m(this,null,function*(){let t=C(n);t.asyncQueue.verifyOperationInProgress(),v("RemoteStore","RemoteStore received new credentials");let r=sr(t);t.v_.add(3),yield rs(t),r&&t.x_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.v_.delete(3),yield da(t)})}function Ap(n,e){return m(this,null,function*(){let t=C(n);e?(t.v_.delete(2),yield da(t)):e||(t.v_.add(2),yield rs(t),t.x_.set("Unknown"))})}function ss(n){return n.N_||(n.N_=function(t,r,i){let s=C(t);return s.R_(),new wp(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:FR.bind(null,n),To:LR.bind(null,n),u_:UR.bind(null,n)}),n.F_.push(e=>m(this,null,function*(){e?(n.N_.Zo(),mg(n)?gg(n):n.x_.set("Unknown")):(yield n.N_.stop(),QE(n))}))),n.N_}function nr(n){return n.B_||(n.B_=function(t,r,i){let s=C(t);return s.R_(),new Ep(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:BR.bind(null,n),To:GR.bind(null,n),E_:qR.bind(null,n),T_:zR.bind(null,n)}),n.F_.push(e=>m(this,null,function*(){e?(n.B_.Zo(),yield is(n)):(yield n.B_.stop(),n.D_.length>0&&(v("RemoteStore",`Stopping write stream with ${n.D_.length} pending writes`),n.D_=[]))}))),n.B_}var Sp=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new xe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new y(g.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function os(n,e){if(Ie("AsyncQueue",`${e}: ${n}`),ir(n))return new y(g.UNAVAILABLE,`${e}: ${n}`);throw n}var Uu=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||I.comparator(t.key,r.key):(t,r)=>I.comparator(t.key,r.key),this.keyedMap=xo(),this.sortedSet=new ce(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var ju=class{constructor(){this.L_=new ce(I.comparator)}track(e){let t=e.doc.key,r=this.L_.get(t);r?e.type!==0&&r.type===3?this.L_=this.L_.insert(t,e):e.type===3&&r.type!==1?this.L_=this.L_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.L_=this.L_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.L_=this.L_.remove(t):e.type===1&&r.type===2?this.L_=this.L_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):S():this.L_=this.L_.insert(t,e)}k_(){let e=[];return this.L_.inorderTraversal((t,r)=>{e.push(r)}),e}},Yi=class n{constructor(e,t,r,i,s,o,a,c,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Uu.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ua(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var bp=class{constructor(){this.q_=void 0,this.Q_=[]}},Rp=class{constructor(){this.queries=new rn(e=>rE(e),ua),this.onlineState="Unknown",this.K_=new Set}};function yg(n,e){return m(this,null,function*(){let t=C(n),r=e.query,i=!1,s=t.queries.get(r);if(s||(i=!0,s=new bp),i)try{s.q_=yield t.onListen(r)}catch(o){let a=os(o,`Initialization of query '${xi(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,s),s.Q_.push(e),e.U_(t.onlineState),s.q_&&e.W_(s.q_)&&_g(t)})}function vg(n,e){return m(this,null,function*(){let t=C(n),r=e.query,i=!1,s=t.queries.get(r);if(s){let o=s.Q_.indexOf(e);o>=0&&(s.Q_.splice(o,1),i=s.Q_.length===0)}if(i)return t.queries.delete(r),t.onUnlisten(r)})}function WR(n,e){let t=C(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.Q_)a.W_(i)&&(r=!0);o.q_=i}}r&&_g(t)}function KR(n,e,t){let r=C(n),i=r.queries.get(e);if(i)for(let s of i.Q_)s.onError(t);r.queries.delete(e)}function _g(n){n.K_.forEach(e=>{e.next()})}var na=class{constructor(e,t,r){this.query=e,this.G_=t,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=r||{}}W_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Yi(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.z_?this.H_(e)&&(this.G_.next(e),t=!0):this.J_(e,this.onlineState)&&(this.Y_(e),t=!0),this.j_=e,t}onError(e){this.G_.error(e)}U_(e){this.onlineState=e;let t=!1;return this.j_&&!this.z_&&this.J_(this.j_,e)&&(this.Y_(this.j_),t=!0),t}J_(e,t){if(!e.fromCache)return!0;let r=t!=="Offline";return(!this.options.Z_||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}H_(e){if(e.docChanges.length>0)return!0;let t=this.j_&&this.j_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}Y_(e){e=Yi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.z_=!0,this.G_.next(e)}};var Dp=class{constructor(e,t){this.X_=e,this.byteLength=t}ea(){return"metadata"in this.X_}};var $u=class{constructor(e){this.serializer=e}Ps(e){return Zt(this.serializer,e)}Is(e){return e.metadata.exists?SE(this.serializer,e.document,!1):Me.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return Ce(e)}},Pp=class{constructor(e,t,r){this.ta=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=ZE(e)}na(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.X_.namedQuery)this.queries.push(e.X_.namedQuery);else if(e.X_.documentMetadata){this.documents.push({metadata:e.X_.documentMetadata}),e.X_.documentMetadata.exists||++t;let r=X.fromString(e.X_.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.X_.document&&(this.documents[this.documents.length-1].document=e.X_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ra(e){let t=new Map,r=new $u(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Ps(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||q()).add(s);t.set(o,a)}}return t}complete(){return m(this,null,function*(){let e=yield kR(this.localStore,new $u(this.serializer),this.documents,this.ta.id),t=this.ra(this.documents);for(let r of this.queries)yield NR(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,ia:this.collectionGroups,sa:e}})}};function ZE(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Bu=class{constructor(e){this.key=e}},qu=class{constructor(e){this.key=e}},zu=class{constructor(e,t){this.query=e,this.oa=t,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=q(),this.mutatedKeys=q(),this.ua=sE(e),this.ca=new Uu(this.ua)}get la(){return this.oa}ha(e,t){let r=t?t.Pa:new ju,i=t?t.ca:this.ca,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,h)=>{let d=i.get(l),f=la(this.query,h)?h:null,E=!!d&&this.mutatedKeys.has(d.key),w=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations),_=!1;d&&f?d.data.isEqual(f.data)?E!==w&&(r.track({type:3,doc:f}),_=!0):this.Ia(d,f)||(r.track({type:2,doc:f}),_=!0,(c&&this.ua(f,c)>0||u&&this.ua(f,u)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),_=!0):d&&!f&&(r.track({type:1,doc:d}),_=!0,(c||u)&&(a=!0)),_&&(f?(o=o.add(f),s=w?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{ca:o,Pa:r,Xi:a,mutatedKeys:s}}Ia(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.ca;this.ca=e.ca,this.mutatedKeys=e.mutatedKeys;let o=e.Pa.k_();o.sort((l,h)=>function(f,E){let w=_=>{switch(_){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S()}};return w(f)-w(E)}(l.type,h.type)||this.ua(l.doc,h.doc)),this.Ta(r),i=i!=null&&i;let a=t&&!i?this.Ea():[],c=this.aa.size===0&&this.current&&!i?1:0,u=c!==this._a;return this._a=c,o.length!==0||u?{snapshot:new Yi(this.query,e.ca,s,o,e.mutatedKeys,c===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),da:a}:{da:a}}U_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new ju,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(e){return!this.oa.has(e)&&!!this.ca.has(e)&&!this.ca.get(e).hasLocalMutations}Ta(e){e&&(e.addedDocuments.forEach(t=>this.oa=this.oa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.oa=this.oa.delete(t)),this.current=e.current)}Ea(){if(!this.current)return[];let e=this.aa;this.aa=q(),this.ca.forEach(r=>{this.Aa(r.key)&&(this.aa=this.aa.add(r.key))});let t=[];return e.forEach(r=>{this.aa.has(r)||t.push(new qu(r))}),this.aa.forEach(r=>{e.has(r)||t.push(new Bu(r))}),t}Ra(e){this.oa=e.hs,this.aa=q();let t=this.ha(e.documents);return this.applyChanges(t,!0)}Va(){return Yi.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,this._a===0,this.hasCachedResults)}},xp=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Mp=class{constructor(e){this.key=e,this.ma=!1}},Vp=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.fa={},this.ga=new rn(a=>rE(a),ua),this.pa=new Map,this.ya=new Set,this.wa=new ce(I.comparator),this.Sa=new Map,this.ba=new Jo,this.Da={},this.Ca=new Map,this.va=Ki.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return this.Fa===!0}};function HR(n,e){return m(this,null,function*(){let t=Cg(n),r,i,s=t.ga.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.Va();else{let o=yield Hi(t.localStore,et(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=yield wg(t,e,r,a==="current",o.resumeToken),t.isPrimaryClient&&nl(t.remoteStore,o)}return i})}function wg(n,e,t,r,i){return m(this,null,function*(){n.Ma=(h,d,f)=>function(w,_,M,$){return m(this,null,function*(){let D=_.view.ha(M);D.Xi&&(D=yield Mu(w.localStore,_.query,!1).then(({documents:Ae})=>_.view.ha(Ae,D)));let W=$&&$.targetChanges.get(_.targetId),K=$&&$.targetMismatches.get(_.targetId)!=null,Z=_.view.applyChanges(D,w.isPrimaryClient,W,K);return kp(w,_.targetId,Z.da),Z.snapshot})}(n,h,d,f);let s=yield Mu(n.localStore,e,!0),o=new zu(e,s.hs),a=o.ha(s.documents),c=Ho.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),u=o.applyChanges(a,n.isPrimaryClient,c);kp(n,t,u.da);let l=new xp(e,t,o);return n.ga.set(e,l),n.pa.has(t)?n.pa.get(t).push(e):n.pa.set(t,[e]),u.snapshot})}function QR(n,e){return m(this,null,function*(){let t=C(n),r=t.ga.get(e),i=t.pa.get(r.targetId);if(i.length>1)return t.pa.set(r.targetId,i.filter(s=>!ua(s,e))),void t.ga.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield Qi(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),ta(t.remoteStore,r.targetId),Xi(t,r.targetId)}).catch(rr))):(Xi(t,r.targetId),yield Qi(t.localStore,r.targetId,!0))})}function YR(n,e,t){return m(this,null,function*(){let r=Ag(n);try{let i=yield function(o,a){let c=C(o),u=ge.now(),l=a.reduce((f,E)=>f.add(E.key),q()),h,d;return c.persistence.runTransaction("Locally write mutations","readwrite",f=>{let E=ot(),w=q();return c.os.getEntries(f,l).next(_=>{E=_,E.forEach((M,$)=>{$.isValidDocument()||(w=w.add(M))})}).next(()=>c.localDocuments.getOverlayedDocuments(f,E)).next(_=>{h=_;let M=[];for(let $ of a){let D=fR($,h.get($.key).overlayedDocument);D!=null&&M.push(new kt($.key,D,Y0(D.value.mapValue),we.exists(!0)))}return c.mutationQueue.addMutationBatch(f,u,M,a)}).next(_=>{d=_;let M=_.applyToLocalDocumentSet(h,w);return c.documentOverlayCache.saveOverlays(f,_.batchId,M)})}).then(()=>({batchId:d.batchId,changes:aE(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,c){let u=o.Da[o.currentUser.toKey()];u||(u=new ce(B)),u=u.insert(a,c),o.Da[o.currentUser.toKey()]=u}(r,i.batchId,t),yield En(r,i.changes),yield is(r.remoteStore)}catch(i){let s=os(i,"Failed to persist write");t.reject(s)}})}function eI(n,e){return m(this,null,function*(){let t=C(n);try{let r=yield MR(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Sa.get(s);o&&(x(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.ma=!0:i.modifiedDocuments.size>0?x(o.ma):i.removedDocuments.size>0&&(x(o.ma),o.ma=!1))}),yield En(t,r,e)}catch(r){yield rr(r)}})}function D0(n,e,t){let r=C(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.ga.forEach((s,o)=>{let a=o.view.U_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let c=C(o);c.onlineState=a;let u=!1;c.queries.forEach((l,h)=>{for(let d of h.Q_)d.U_(a)&&(u=!0)}),u&&_g(c)}(r.eventManager,e),i.length&&r.fa.u_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function XR(n,e,t){return m(this,null,function*(){let r=C(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Sa.get(e),s=i&&i.key;if(s){let o=new ce(I.comparator);o=o.insert(s,Me.newNoDocument(s,V.min()));let a=q().add(s),c=new Ko(V.min(),new Map,new ce(B),o,a);yield eI(r,c),r.wa=r.wa.remove(s),r.Sa.delete(e),Tg(r)}else yield Qi(r.localStore,e,!1).then(()=>Xi(r,e,t)).catch(rr)})}function JR(n,e){return m(this,null,function*(){let t=C(n),r=e.batch.batchId;try{let i=yield xR(t.localStore,e);Ig(t,r,null),Eg(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield En(t,i)}catch(i){yield rr(i)}})}function ZR(n,e,t){return m(this,null,function*(){let r=C(n);try{let i=yield function(o,a){let c=C(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let l;return c.mutationQueue.lookupMutationBatch(u,a).next(h=>(x(h!==null),l=h.keys(),c.mutationQueue.removeMutationBatch(u,h))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,l,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,l)).next(()=>c.localDocuments.getDocuments(u,l))})}(r.localStore,e);Ig(r,e,t),Eg(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield En(r,i)}catch(i){yield rr(i)}})}function eD(n,e){return m(this,null,function*(){let t=C(n);sr(t.remoteStore)||v("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=C(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>a.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(r===-1)return void e.resolve();let i=t.Ca.get(r)||[];i.push(e),t.Ca.set(r,i)}catch(r){let i=os(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function Eg(n,e){(n.Ca.get(e)||[]).forEach(t=>{t.resolve()}),n.Ca.delete(e)}function Ig(n,e,t){let r=C(n),i=r.Da[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Da[r.currentUser.toKey()]=i}}function Xi(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.pa.get(e))n.ga.delete(r),t&&n.fa.xa(r,t);n.pa.delete(e),n.isPrimaryClient&&n.ba.Vr(e).forEach(r=>{n.ba.containsKey(r)||tI(n,r)})}function tI(n,e){n.ya.delete(e.path.canonicalString());let t=n.wa.get(e);t!==null&&(ta(n.remoteStore,t),n.wa=n.wa.remove(e),n.Sa.delete(t),Tg(n))}function kp(n,e,t){for(let r of t)r instanceof Bu?(n.ba.addReference(r.key,e),tD(n,r)):r instanceof qu?(v("SyncEngine","Document no longer in limbo: "+r.key),n.ba.removeReference(r.key,e),n.ba.containsKey(r.key)||tI(n,r.key)):S()}function tD(n,e){let t=e.key,r=t.path.canonicalString();n.wa.get(t)||n.ya.has(r)||(v("SyncEngine","New document in limbo: "+t),n.ya.add(r),Tg(n))}function Tg(n){for(;n.ya.size>0&&n.wa.size<n.maxConcurrentLimboResolutions;){let e=n.ya.values().next().value;n.ya.delete(e);let t=new I(X.fromString(e)),r=n.va.next();n.Sa.set(r,new Mp(t)),n.wa=n.wa.insert(t,r),nl(n.remoteStore,new Wi(et(ns(t.path)),r,"TargetPurposeLimboResolution",dt._e))}}function En(n,e,t){return m(this,null,function*(){let r=C(n),i=[],s=[],o=[];r.ga.isEmpty()||(r.ga.forEach((a,c)=>{o.push(r.Ma(c,e,t).then(u=>{if((u||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,u?.fromCache?"not-current":"current"),u){i.push(u);let l=fp.Ki(c.targetId,u);s.push(l)}}))}),yield Promise.all(o),r.fa.u_(i),yield function(c,u){return m(this,null,function*(){let l=C(c);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>p.forEach(u,d=>p.forEach(d.qi,f=>l.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>p.forEach(d.Qi,f=>l.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!ir(h))throw h;v("LocalStore","Failed to update sequence numbers: "+h)}for(let h of u){let d=h.targetId;if(!h.fromCache){let f=l.ns.get(d),E=f.snapshotVersion,w=f.withLastLimboFreeSnapshotVersion(E);l.ns=l.ns.insert(d,w)}}})}(r.localStore,s))})}function nD(n,e){return m(this,null,function*(){let t=C(n);if(!t.currentUser.isEqual(e)){v("SyncEngine","User change. New user:",e.toKey());let r=yield $E(t.localStore,e);t.currentUser=e,function(s,o){s.Ca.forEach(a=>{a.forEach(c=>{c.reject(new y(g.CANCELLED,o))})}),s.Ca.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield En(t,r.us)}})}function rD(n,e){let t=C(n),r=t.Sa.get(e);if(r&&r.ma)return q().add(r.key);{let i=q(),s=t.pa.get(e);if(!s)return i;for(let o of s){let a=t.ga.get(o);i=i.unionWith(a.view.la)}return i}}function iD(n,e){return m(this,null,function*(){let t=C(n),r=yield Mu(t.localStore,e.query,!0),i=e.view.Ra(r);return t.isPrimaryClient&&kp(t,e.targetId,i.da),i})}function sD(n,e){return m(this,null,function*(){let t=C(n);return GE(t.localStore,e).then(r=>En(t,r))})}function oD(n,e,t,r){return m(this,null,function*(){let i=C(n),s=yield function(a,c){let u=C(a),l=C(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.vn(h,c).next(d=>d?u.localDocuments.getDocuments(h,d):p.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield is(i.remoteStore):t==="acknowledged"||t==="rejected"?(Ig(i,e,r||null),Eg(i,e),function(a,c){C(C(a).mutationQueue).Mn(c)}(i.localStore,e)):S(),yield En(i,s)):v("SyncEngine","Cannot apply mutation batch with id: "+e)})}function aD(n,e){return m(this,null,function*(){let t=C(n);if(Cg(t),Ag(t),e===!0&&t.Fa!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield P0(t,r.toArray());t.Fa=!0,yield Ap(t.remoteStore,!0);for(let s of i)nl(t.remoteStore,s)}else if(e===!1&&t.Fa!==!1){let r=[],i=Promise.resolve();t.pa.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Xi(t,o),Qi(t.localStore,o,!0))),ta(t.remoteStore,o)}),yield i,yield P0(t,r),function(o){let a=C(o);a.Sa.forEach((c,u)=>{ta(a.remoteStore,u)}),a.ba.mr(),a.Sa=new Map,a.wa=new ce(I.comparator)}(t),t.Fa=!1,yield Ap(t.remoteStore,!1)}})}function P0(n,e,t){return m(this,null,function*(){let r=C(n),i=[],s=[];for(let o of e){let a,c=r.pa.get(o);if(c&&c.length!==0){a=yield Hi(r.localStore,et(c[0]));for(let u of c){let l=r.ga.get(u),h=yield iD(r,l);h.snapshot&&s.push(h.snapshot)}}else{let u=yield zE(r.localStore,o);a=yield Hi(r.localStore,u),yield wg(r,nI(u),o,!1,a.resumeToken)}i.push(a)}return r.fa.u_(s),i})}function nI(n){return nE(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function cD(n){return function(t){return C(C(t).persistence).Li()}(C(n).localStore)}function uD(n,e,t,r){return m(this,null,function*(){let i=C(n);if(i.Fa)return void v("SyncEngine","Ignoring unexpected query state notification.");let s=i.pa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield GE(i.localStore,iE(s[0])),a=Ko.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ue.EMPTY_BYTE_STRING);yield En(i,o,a);break}case"rejected":yield Qi(i.localStore,e,!0),Xi(i,e,r);break;default:S()}})}function lD(n,e,t){return m(this,null,function*(){let r=Cg(n);if(r.Fa){for(let i of e){if(r.pa.has(i)){v("SyncEngine","Adding an already active target "+i);continue}let s=yield zE(r.localStore,i),o=yield Hi(r.localStore,s);yield wg(r,nI(s),o.targetId,!1,o.resumeToken),nl(r.remoteStore,o)}for(let i of t)r.pa.has(i)&&(yield Qi(r.localStore,i,!1).then(()=>{ta(r.remoteStore,i),Xi(r,i)}).catch(rr))}})}function Cg(n){let e=C(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=eI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=rD.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=XR.bind(null,e),e.fa.u_=WR.bind(null,e.eventManager),e.fa.xa=KR.bind(null,e.eventManager),e}function Ag(n){let e=C(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=JR.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ZR.bind(null,e),e}function hD(n,e,t){let r=C(n);(function(s,o,a){return m(this,null,function*(){try{let c=yield o.getMetadata();if(yield function(f,E){let w=C(f),_=Ce(E.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",M=>w.$r.getBundleMetadata(M,E.id)).then(M=>!!M&&M.createTime.compareTo(_)>=0)}(s.localStore,c))return yield o.close(),a._completeWith(function(f){return{taskState:"Success",documentsLoaded:f.totalDocuments,bytesLoaded:f.totalBytes,totalDocuments:f.totalDocuments,totalBytes:f.totalBytes}}(c)),Promise.resolve(new Set);a._updateProgress(ZE(c));let u=new Pp(c,s.localStore,o.serializer),l=yield o.Oa();for(;l;){let d=yield u.na(l);d&&a._updateProgress(d),l=yield o.Oa()}let h=yield u.complete();return yield En(s,h.sa,void 0),yield function(f,E){let w=C(f);return w.persistence.runTransaction("Save bundle","readwrite",_=>w.$r.saveBundleMetadata(_,E))}(s.localStore,c),a._completeWith(h.progress),Promise.resolve(h.ia)}catch(c){return Et("SyncEngine",`Loading bundle failed with ${c}`),a._failWith(c),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var ra=class{constructor(){this.synchronizeTabs=!1}initialize(e){return m(this,null,function*(){this.serializer=ha(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return jE(this.persistence,new xu,e.initialUser,this.serializer)}createPersistence(e){return new Du(Pu.Hr,this.serializer)}createSharedClientState(e){return new Nu}terminate(){return m(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Gu=class n extends ra{constructor(e,t,r){super(),this.Na=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return m(this,null,function*(){yield Tl(n.prototype,this,"initialize").call(this,e),yield this.Na.initialize(this,e),yield Ag(this.Na.syncEngine),yield is(this.Na.remoteStore),yield this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return jE(this.persistence,new xu,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new Jf(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new mf(t,this.persistence);return new gf(e.asyncQueue,r)}createPersistence(e){let t=fg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?wt.withCacheSize(this.cacheSizeBytes):wt.DEFAULT;return new dp(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,KE(),ru(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Nu}},Np=class n extends Gu{constructor(e,t){super(e,t,!1),this.Na=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return m(this,null,function*(){yield Tl(n.prototype,this,"initialize").call(this,e);let t=this.Na.syncEngine;this.sharedClientState instanceof Fo&&(this.sharedClientState.syncEngine={Zs:oD.bind(null,t),Xs:uD.bind(null,t),eo:lD.bind(null,t),Li:cD.bind(null,t),Ys:sD.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.fi(r=>m(this,null,function*(){yield aD(this.Na.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=KE();if(!Fo.D(t))throw new y(g.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=fg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Fo(t,e.asyncQueue,r,e.clientId,e.initialUser)}},ia=class{initialize(e,t){return m(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>D0(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=nD.bind(null,this.syncEngine),yield Ap(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Rp}()}createDatastore(e){let t=ha(e.databaseInfo.databaseId),r=function(s){return new _p(s)}(e.databaseInfo);return function(s,o,a,c){return new Ip(s,o,a,c)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,a){return new Cp(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>D0(this.syncEngine,t,0),function(){return Ou.D()?new Ou:new yp}())}createSyncEngine(e,t){return function(i,s,o,a,c,u,l){let h=new Vp(i,s,o,a,c,u);return l&&(h.Fa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return m(this,null,function*(){var e;yield function(r){return m(this,null,function*(){let i=C(r);v("RemoteStore","RemoteStore shutting down."),i.v_.add(5),yield rs(i),i.M_.shutdown(),i.x_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};function x0(n,e=10240){let t=0;return{read(){return m(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return m(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Ji=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ba(this.observer.next,e)}error(e){this.observer.error?this.Ba(this.observer.error,e):Ie("Uncaught Error in snapshot listener:",e.toString())}La(){this.muted=!0}Ba(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var Op=class{constructor(e,t){this.ka=e,this.serializer=t,this.metadata=new xe,this.buffer=new Uint8Array,this.qa=function(){return new TextDecoder("utf-8")}(),this.Qa().then(r=>{r&&r.ea()?this.metadata.resolve(r.X_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.X_)}`))},r=>this.metadata.reject(r))}close(){return this.ka.cancel()}getMetadata(){return m(this,null,function*(){return this.metadata.promise})}Oa(){return m(this,null,function*(){return yield this.getMetadata(),this.Qa()})}Qa(){return m(this,null,function*(){let e=yield this.Ka();if(e===null)return null;let t=this.qa.decode(e),r=Number(t);isNaN(r)&&this.$a(`length string (${t}) is not valid number`);let i=yield this.Ua(r);return new Dp(JSON.parse(i),e.length+r)})}Wa(){return this.buffer.findIndex(e=>e===123)}Ka(){return m(this,null,function*(){for(;this.Wa()<0&&!(yield this.Ga()););if(this.buffer.length===0)return null;let e=this.Wa();e<0&&this.$a("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Ua(e){return m(this,null,function*(){for(;this.buffer.length<e;)(yield this.Ga())&&this.$a("Reached the end of bundle when more is expected.");let t=this.qa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}$a(e){throw this.ka.cancel(),new Error(`Invalid bundle format: ${e}`)}Ga(){return m(this,null,function*(){let e=yield this.ka.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Fp=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return m(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new y(g.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return m(this,null,function*(){let o=C(i),a={documents:s.map(h=>Qo(o.serializer,h))},c=yield o.vo("BatchGetDocuments",o.serializer.databaseId,X.emptyPath(),a,s.length),u=new Map;c.forEach(h=>{let d=_R(o.serializer,h);u.set(d.key.toString(),d)});let l=[];return s.forEach(h=>{let d=u.get(h.toString());x(!!d),l.push(d)}),l})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new tr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return m(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=I.fromPath(r);this.mutations.push(new zo(i,this.precondition(i)))}),yield function(r,i){return m(this,null,function*(){let s=C(r),o={writes:i.map(a=>Yo(s.serializer,a))};yield s.So("Commit",s.serializer.databaseId,X.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw S();t=V.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new y(g.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(V.min())?we.exists(!1):we.updateTime(t):we.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(V.min()))throw new y(g.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return we.updateTime(t)}return we.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Lp=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.za=r.maxAttempts,this.jo=new ea(this.asyncQueue,"transaction_retry")}ja(){this.za-=1,this.Ha()}Ha(){this.jo.qo(()=>m(this,null,function*(){let e=new Fp(this.datastore),t=this.Ja(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.Ya(i)}))}).catch(r=>{this.Ya(r)})}))}Ja(e){try{let t=this.updateFunction(e);return!aa(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Ya(e){this.za>0&&this.Za(e)?(this.za-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ha(),Promise.resolve()))):this.deferred.reject(e)}Za(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!vE(t)}return!1}};var Up=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Pe.UNAUTHENTICATED,this.clientId=ou.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>m(this,null,function*(){v("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(v("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new xe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=os(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function iu(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),v("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>m(this,null,function*(){r.isEqual(i)||(yield $E(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function jp(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield Sg(n);v("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>R0(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>R0(e.remoteStore,i)),n._onlineComponents=e})}function rI(n){return n.name==="FirebaseError"?n.code===g.FAILED_PRECONDITION||n.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function Sg(n){return m(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){v("FirestoreClient","Using user provided OfflineComponentProvider");try{yield iu(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!rI(t))throw t;Et("Error using user provided cache. Falling back to memory cache: "+t),yield iu(n,new ra)}}else v("FirestoreClient","Using default OfflineComponentProvider"),yield iu(n,new ra);return n._offlineComponents})}function rl(n){return m(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(v("FirestoreClient","Using user provided OnlineComponentProvider"),yield jp(n,n._uninitializedComponentsProvider._online)):(v("FirestoreClient","Using default OnlineComponentProvider"),yield jp(n,new ia))),n._onlineComponents})}function iI(n){return Sg(n).then(e=>e.persistence)}function bg(n){return Sg(n).then(e=>e.localStore)}function sI(n){return rl(n).then(e=>e.remoteStore)}function Rg(n){return rl(n).then(e=>e.syncEngine)}function dD(n){return rl(n).then(e=>e.datastore)}function Zi(n){return m(this,null,function*(){let e=yield rl(n),t=e.eventManager;return t.onListen=HR.bind(null,e.syncEngine),t.onUnlisten=QR.bind(null,e.syncEngine),t})}function fD(n){return n.asyncQueue.enqueue(()=>m(this,null,function*(){let e=yield iI(n),t=yield sI(n);return e.setNetworkEnabled(!0),function(i){let s=C(i);return s.v_.delete(0),da(s)}(t)}))}function pD(n){return n.asyncQueue.enqueue(()=>m(this,null,function*(){let e=yield iI(n),t=yield sI(n);return e.setNetworkEnabled(!1),function(i){return m(this,null,function*(){let s=C(i);s.v_.add(0),yield rs(s),s.x_.set("Offline")})}(t)}))}function gD(n,e){let t=new xe;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s,o){return m(this,null,function*(){try{let a=yield function(u,l){let h=C(u);return h.persistence.runTransaction("read document","readonly",d=>h.localDocuments.getDocument(d,l))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new y(g.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let c=os(a,`Failed to get document '${s} from cache`);o.reject(c)}})}(yield bg(n),e,t)})),t.promise}function oI(n,e,t={}){let r=new xe;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(s,o,a,c,u){let l=new Ji({next:d=>{o.enqueueAndForget(()=>vg(s,h));let f=d.docs.has(a);!f&&d.fromCache?u.reject(new y(g.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&d.fromCache&&c&&c.source==="server"?u.reject(new y(g.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(d)},error:d=>u.reject(d)}),h=new na(ns(a.path),l,{includeMetadataChanges:!0,Z_:!0});return yg(s,h)}(yield Zi(n),n.asyncQueue,e,t,r)})),r.promise}function mD(n,e){let t=new xe;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s,o){return m(this,null,function*(){try{let a=yield Mu(i,s,!0),c=new zu(s,a.hs),u=c.ha(a.documents),l=c.applyChanges(u,!1);o.resolve(l.snapshot)}catch(a){let c=os(a,`Failed to execute query '${s} against cache`);o.reject(c)}})}(yield bg(n),e,t)})),t.promise}function aI(n,e,t={}){let r=new xe;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(s,o,a,c,u){let l=new Ji({next:d=>{o.enqueueAndForget(()=>vg(s,h)),d.fromCache&&c.source==="server"?u.reject(new y(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(d)},error:d=>u.reject(d)}),h=new na(a,l,{includeMetadataChanges:!0,Z_:!0});return yg(s,h)}(yield Zi(n),n.asyncQueue,e,t,r)})),r.promise}function yD(n,e){let t=new Ji(e);return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s){C(i).K_.add(s),s.next()}(yield Zi(n),t)})),()=>{t.La(),n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s){C(i).K_.delete(s)}(yield Zi(n),t)}))}}function vD(n,e,t,r){let i=function(o,a){let c;return c=typeof o=="string"?wE().encode(o):o,function(l,h){return new Op(l,h)}(function(l,h){if(l instanceof Uint8Array)return x0(l,h);if(l instanceof ArrayBuffer)return x0(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),a)}(t,ha(e));n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){hD(yield Rg(n),i,r)}))}function _D(n,e){return n.asyncQueue.enqueue(()=>m(this,null,function*(){return function(r,i){let s=C(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.$r.getNamedQuery(o,i))}(yield bg(n),e)}))}function cI(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var M0=new Map;function Dg(n,e,t){if(!t)throw new y(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Pg(n,e,t,r){if(e===!0&&r===!0)throw new y(g.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function V0(n){if(!I.isDocumentKey(n))throw new y(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function k0(n){if(I.isDocumentKey(n))throw new y(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function il(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":S()}function J(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new y(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=il(n);throw new y(g.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function uI(n,e){if(e<=0)throw new y(g.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var Wu=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new y(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new y(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Pg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=cI((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Fr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Wu({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new y(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new y(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Wu(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new sf;switch(r.type){case"firstParty":return new uf(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new y(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=M0.get(t);r&&(v("ComponentProvider","Removing Datastore"),M0.delete(t),r.terminate())}(this),Promise.resolve()}};function sl(n,e,t,r={}){var i;let s=(n=J(n,Fr))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Et("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,c;if(typeof r.mockUserToken=="string")a=r.mockUserToken,c=Pe.MOCK_USER;else{a=Ay(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new y(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Pe(u)}n._authCredentials=new of(new su(a,c))}}var qe=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},se=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new en(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},en=class n extends qe{constructor(e,t,r){super(e,t,ns(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new se(this.firestore,null,new I(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function ol(n,e,...t){if(n=fe(n),Dg("collection","path",e),n instanceof Fr){let r=X.fromString(e,...t);return k0(r),new en(n,null,r)}{if(!(n instanceof se||n instanceof en))throw new y(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(X.fromString(e,...t));return k0(r),new en(n.firestore,null,r)}}function xg(n,e){if(n=J(n,Fr),Dg("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new y(g.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new qe(n,null,function(r){return new Vt(X.emptyPath(),r)}(e))}function as(n,e,...t){if(n=fe(n),arguments.length===1&&(e=ou.newId()),Dg("doc","path",e),n instanceof Fr){let r=X.fromString(e,...t);return V0(r),new se(n,null,new I(r))}{if(!(n instanceof se||n instanceof en))throw new y(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(X.fromString(e,...t));return V0(r),new se(n.firestore,n instanceof en?n.converter:null,new I(r))}}function al(n,e){return n=fe(n),e=fe(e),(n instanceof se||n instanceof en)&&(e instanceof se||e instanceof en)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function cl(n,e){return n=fe(n),e=fe(e),n instanceof qe&&e instanceof qe&&n.firestore===e.firestore&&ua(n._query,e._query)&&n.converter===e.converter}var $p=class{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new ea(this,"async_queue_retry"),this._u=()=>{let t=ru();t&&v("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};let e=ru();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.au(),this.uu(e)}enterRestrictedMode(e){if(!this.tu){this.tu=!0,this.su=e||!1;let t=ru();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._u)}}enqueue(e){if(this.au(),this.tu)return new Promise(()=>{});let t=new xe;return this.uu(()=>this.tu&&this.su?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.eu.push(e),this.cu()))}cu(){return m(this,null,function*(){if(this.eu.length!==0){try{yield this.eu[0](),this.eu.shift(),this.jo.reset()}catch(e){if(!ir(e))throw e;v("AsyncQueue","Operation failed with retryable error: "+e)}this.eu.length>0&&this.jo.qo(()=>this.cu())}})}uu(e){let t=this.Xa.then(()=>(this.iu=!0,e().catch(r=>{this.ru=r,this.iu=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Ie("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.iu=!1,r))));return this.Xa=t,t}enqueueAfterDelay(e,t,r){this.au(),this.ou.indexOf(e)>-1&&(t=0);let i=Sp.createAndSchedule(this,e,t,r,s=>this.lu(s));return this.nu.push(i),i}au(){this.ru&&S()}verifyOperationInProgress(){}hu(){return m(this,null,function*(){let e;do e=this.Xa,yield e;while(e!==this.Xa)})}Pu(e){for(let t of this.nu)if(t.timerId===e)return!0;return!1}Iu(e){return this.hu().then(()=>{this.nu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.nu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.hu()})}Tu(e){this.ou.push(e)}lu(e){let t=this.nu.indexOf(e);this.nu.splice(t,1)}};function Bp(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var qp=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new xe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var lI=-1,he=class extends Fr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new $p}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||dI(this),this._firestoreClient.terminate()}};function hI(n,e){let t=typeof n=="object"?n:Na(),r=typeof n=="string"?n:e||"(default)",i=zl(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Cy("firestore");s&&sl(i,...s)}return i}function ke(n){return n._firestoreClient||dI(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function dI(n){var e,t,r;let i=n._freezeSettings(),s=function(a,c,u,l){return new yf(a,c,u,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,cI(l.experimentalLongPollingOptions),l.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new Up(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Mg(n,e){pI(n=J(n,he));let t=ke(n);if(t._uninitializedComponentsProvider)throw new y(g.FAILED_PRECONDITION,"SDK cache is already specified.");Et("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new ia;return fI(t,i,new Gu(i,r.cacheSizeBytes,e?.forceOwnership))}function Vg(n){pI(n=J(n,he));let e=ke(n);if(e._uninitializedComponentsProvider)throw new y(g.FAILED_PRECONDITION,"SDK cache is already specified.");Et("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new ia;return fI(e,r,new Np(r,t.cacheSizeBytes))}function fI(n,e,t){let r=new xe;return n.asyncQueue.enqueue(()=>m(this,null,function*(){try{yield iu(n,t),yield jp(n,e),r.resolve()}catch(i){let s=i;if(!rI(s))throw s;Et("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function kg(n){if(n._initialized&&!n._terminated)throw new y(g.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new xe;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{yield function(r){return m(this,null,function*(){if(!mn.D())return Promise.resolve();let i=r+"main";yield mn.delete(i)})}(fg(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function Ng(n){return function(t){let r=new xe;return t.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return eD(yield Rg(t),r)})),r.promise}(ke(n=J(n,he)))}function Og(n){return fD(ke(n=J(n,he)))}function Fg(n){return pD(ke(n=J(n,he)))}function Lg(n,e){let t=ke(n=J(n,he)),r=new qp;return vD(t,n._databaseId,e,r),r}function Ug(n,e){return _D(ke(n=J(n,he)),e).then(t=>t?new qe(n,null,t.query):null)}function pI(n){if(n._initialized||n._terminated)throw new y(g.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var sn=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ue.fromBase64String(e))}catch(t){throw new y(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ue.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Nt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new y(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Te(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var _n=class{constructor(e){this._methodName=e}};var Lr=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new y(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new y(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return B(this._lat,e._lat)||B(this._long,e._long)}};var wD=/^__.*__$/,zp=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new kt(e,this.data,this.fieldMask,t,this.fieldTransforms):new er(e,this.data,t,this.fieldTransforms)}},Ku=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new kt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function gI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw S()}}var Hu=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Eu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Au({path:r,Vu:!1});return i.mu(e),i}fu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Au({path:r,Vu:!1});return i.Eu(),i}gu(e){return this.Au({path:void 0,Vu:!0})}pu(e){return Qu(e,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Eu(){if(this.path)for(let e=0;e<this.path.length;e++)this.mu(this.path.get(e))}mu(e){if(e.length===0)throw this.pu("Document fields must not be empty");if(gI(this.du)&&wD.test(e))throw this.pu('Document fields cannot begin and end with "__"')}},Gp=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ha(e)}Su(e,t,r,i=!1){return new Hu({du:e,methodName:t,wu:r,path:Te.emptyPath(),Vu:!1,yu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Br(n){let e=n._freezeSettings(),t=ha(n._databaseId);return new Gp(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ul(n,e,t,r,i,s={}){let o=n.Su(s.merge||s.mergeFields?2:0,e,t,i);Bg("Data must be an object, but it was:",o,r);let a=vI(r,o),c,u;if(s.merge)c=new ft(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){let l=[];for(let h of s.mergeFields){let d=Yp(e,h,t);if(!o.contains(d))throw new y(g.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);wI(l,d)||l.push(d)}c=new ft(l),u=o.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,u=o.fieldTransforms;return new zp(new Ke(a),c,u)}var sa=class n extends _n{_toFieldTransform(e){if(e.du!==2)throw e.du===1?e.pu(`${this._methodName}() can only appear at the top level of your update data`):e.pu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function mI(n,e,t){return new Hu({du:3,wu:e.settings.wu,methodName:n._methodName,Vu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Wp=class n extends _n{_toFieldTransform(e){return new kr(e.path,new Jn)}isEqual(e){return e instanceof n}},Kp=class n extends _n{constructor(e,t){super(e),this.bu=t}_toFieldTransform(e){let t=mI(this,e,!0),r=this.bu.map(s=>qr(s,t)),i=new yn(r);return new kr(e.path,i)}isEqual(e){return e instanceof n&&ql(this.bu,e.bu)}},Hp=class n extends _n{constructor(e,t){super(e),this.bu=t}_toFieldTransform(e){let t=mI(this,e,!0),r=this.bu.map(s=>qr(s,t)),i=new vn(r);return new kr(e.path,i)}isEqual(e){return e instanceof n&&ql(this.bu,e.bu)}},Qp=class n extends _n{constructor(e,t){super(e),this.Du=t}_toFieldTransform(e){let t=new Zn(e.serializer,hE(e.serializer,this.Du));return new kr(e.path,t)}isEqual(e){return e instanceof n&&this.Du===e.Du}};function jg(n,e,t,r){let i=n.Su(1,e,t);Bg("Data must be an object, but it was:",i,r);let s=[],o=Ke.empty();$r(r,(c,u)=>{let l=qg(e,c,t);u=fe(u);let h=i.fu(l);if(u instanceof sa)s.push(l);else{let d=qr(u,h);d!=null&&(s.push(l),o.set(l,d))}});let a=new ft(s);return new Ku(o,a,i.fieldTransforms)}function $g(n,e,t,r,i,s){let o=n.Su(1,e,t),a=[Yp(e,r,t)],c=[i];if(s.length%2!=0)throw new y(g.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Yp(e,s[d])),c.push(s[d+1]);let u=[],l=Ke.empty();for(let d=a.length-1;d>=0;--d)if(!wI(u,a[d])){let f=a[d],E=c[d];E=fe(E);let w=o.fu(f);if(E instanceof sa)u.push(f);else{let _=qr(E,w);_!=null&&(u.push(f),l.set(f,_))}}let h=new ft(u);return new Ku(l,h,o.fieldTransforms)}function yI(n,e,t,r=!1){return qr(t,n.Su(r?4:3,e))}function qr(n,e){if(_I(n=fe(n)))return Bg("Unsupported field value:",e,n),vI(n,e);if(n instanceof _n)return function(r,i){if(!gI(i.du))throw i.pu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.pu(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Vu&&e.du!==4)throw e.pu("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let c=qr(a,i.gu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=fe(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return hE(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=ge.fromDate(r);return{timestampValue:Gi(i.serializer,s)}}if(r instanceof ge){let s=new ge(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Gi(i.serializer,s)}}if(r instanceof Lr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof sn)return{bytesValue:EE(i.serializer,r._byteString)};if(r instanceof se){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.pu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:lg(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.pu(`Unsupported field value: ${il(r)}`)}(n,e)}function vI(n,e){let t={};return K0(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):$r(n,(r,i)=>{let s=qr(i,e.Ru(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function _I(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ge||n instanceof Lr||n instanceof sn||n instanceof se||n instanceof _n)}function Bg(n,e,t){if(!_I(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=il(t);throw r==="an object"?e.pu(n+" a custom object"):e.pu(n+" "+r)}}function Yp(n,e,t){if((e=fe(e))instanceof Nt)return e._internalPath;if(typeof e=="string")return qg(n,e);throw Qu("Field path arguments must be of type string or ",n,!1,void 0,t)}var ED=new RegExp("[~\\*/\\[\\]]");function qg(n,e,t){if(e.search(ED)>=0)throw Qu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Nt(...e.split("."))._internalPath}catch{throw Qu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Qu(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new y(g.INVALID_ARGUMENT,a+n+c)}function wI(n,e){return n.some(t=>t.isEqual(e))}var Ur=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new se(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Xp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(ll("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Xp=class extends Ur{data(){return super.data()}};function ll(n,e){return typeof e=="string"?qg(n,e):e instanceof Nt?e._internalPath:e._delegate._internalPath}function EI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new y(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var oa=class{},jr=class extends oa{};function on(n,e,...t){let r=[];e instanceof oa&&r.push(e),r=r.concat(t),function(s){let o=s.filter(c=>c instanceof Jp).length,a=s.filter(c=>c instanceof Yu).length;if(o>1||o>0&&a>0)throw new y(g.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Yu=class n extends jr{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return TI(e._query,t),new qe(e.firestore,e.converter,Pf(e._query,t))}_parse(e){let t=Br(e.firestore);return function(s,o,a,c,u,l,h){let d;if(u.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new y(g.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){O0(h,l);let f=[];for(let E of h)f.push(N0(c,s,E));d={arrayValue:{values:f}}}else d=N0(c,s,h)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||O0(h,l),d=yI(a,o,h,l==="in"||l==="not-in");return Q.create(u,l,d)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function zg(n,e,t){let r=e,i=ll("where",n);return Yu._create(i,r,t)}var Jp=class n extends oa{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ne.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let c of a)TI(o,c),o=Pf(o,c)}(e._query,t),new qe(e.firestore,e.converter,Pf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Zp=class n extends jr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new y(g.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new y(g.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Mr(s,o)}(e._query,this._field,this._direction);return new qe(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new Vt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function Gg(n,e="asc"){let t=e,r=ll("orderBy",n);return Zp._create(r,t)}var Xu=class n extends jr{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new qe(e.firestore,e.converter,mu(e._query,this._limit,this._limitType))}};function Wg(n){return uI("limit",n),Xu._create("limit",n,"F")}function Kg(n){return uI("limitToLast",n),Xu._create("limitToLast",n,"L")}var Ju=class n extends jr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=II(e,this.type,this._docOrFields,this._inclusive);return new qe(e.firestore,e.converter,function(i,s){return new Vt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function Hg(...n){return Ju._create("startAt",n,!0)}function Qg(...n){return Ju._create("startAfter",n,!1)}var Zu=class n extends jr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=II(e,this.type,this._docOrFields,this._inclusive);return new qe(e.firestore,e.converter,function(i,s){return new Vt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function Yg(...n){return Zu._create("endBefore",n,!1)}function Xg(...n){return Zu._create("endAt",n,!0)}function II(n,e,t,r){if(t[0]=fe(t[0]),t[0]instanceof Ur)return function(s,o,a,c,u){if(!c)throw new y(g.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let l=[];for(let h of Fi(s))if(h.field.isKeyField())l.push(xr(o,c.key));else{let d=c.data.field(h.field);if(tl(d))throw new y(g.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){let f=h.field.canonicalString();throw new y(g.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${f}' (used as the orderBy) does not exist.`)}l.push(d)}return new nn(l,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Br(n.firestore);return function(o,a,c,u,l,h){let d=o.explicitOrderBy;if(l.length>d.length)throw new y(g.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let f=[];for(let E=0;E<l.length;E++){let w=l[E];if(d[E].field.isKeyField()){if(typeof w!="string")throw new y(g.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof w}`);if(!cg(o)&&w.indexOf("/")!==-1)throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${w}' contains a slash.`);let _=o.path.child(X.fromString(w));if(!I.isDocumentKey(_))throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${_}' is not because it contains an odd number of segments.`);let M=new I(_);f.push(xr(a,M))}else{let _=yI(c,u,w);f.push(_)}}return new nn(f,h)}(n._query,n.firestore._databaseId,i,e,t,r)}}function N0(n,e,t){if(typeof(t=fe(t))=="string"){if(t==="")throw new y(g.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!cg(e)&&t.indexOf("/")!==-1)throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(X.fromString(t));if(!I.isDocumentKey(r))throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return xr(n,new I(r))}if(t instanceof se)return xr(n,t._key);throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${il(t)}.`)}function O0(n,e){if(!Array.isArray(n)||n.length===0)throw new y(g.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function TI(n,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new y(g.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new y(g.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var es=class{convertValue(e,t="none"){switch(Pr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return _e(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Qn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw S()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return $r(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Lr(_e(e.latitude),_e(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=og(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp($o(e));default:return null}}convertTimestamp(e){let t=Hn(e);return new ge(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=X.fromString(e);x(ME(r));let i=new Yn(r.get(1),r.get(3)),s=new I(r.popFirst(5));return i.isEqual(t)||Ie(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function hl(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var eg=class extends es{constructor(e){super(),this.firestore=e}convertBytes(e){return new sn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new se(this.firestore,null,t)}};var gn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Tt=class extends Ur{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Wn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(ll("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Wn=class extends Tt{data(e={}){return super.data(e)}},Ot=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new gn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Wn(this._firestore,this._userDataWriter,r.key,r,new gn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new y(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let c=new Wn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new gn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let c=new Wn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new gn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),u=-1,l=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:ID(a.type),doc:c,oldIndex:u,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function ID(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S()}}function dl(n,e){return n instanceof Tt&&e instanceof Tt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ot&&e instanceof Ot&&n._firestore===e._firestore&&cl(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function Jg(n){n=J(n,se);let e=J(n.firestore,he);return oI(ke(e),n._key).then(t=>am(e,n,t))}var wn=class extends es{constructor(e){super(),this.firestore=e}convertBytes(e){return new sn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new se(this.firestore,null,t)}};function Zg(n){n=J(n,se);let e=J(n.firestore,he),t=ke(e),r=new wn(e);return gD(t,n._key).then(i=>new Tt(e,r,n._key,i,new gn(i!==null&&i.hasLocalMutations,!0),n.converter))}function em(n){n=J(n,se);let e=J(n.firestore,he);return oI(ke(e),n._key,{source:"server"}).then(t=>am(e,n,t))}function tm(n){n=J(n,qe);let e=J(n.firestore,he),t=ke(e),r=new wn(e);return EI(n._query),aI(t,n._query).then(i=>new Ot(e,r,n,i))}function nm(n){n=J(n,qe);let e=J(n.firestore,he),t=ke(e),r=new wn(e);return mD(t,n._query).then(i=>new Ot(e,r,n,i))}function rm(n){n=J(n,qe);let e=J(n.firestore,he),t=ke(e),r=new wn(e);return aI(t,n._query,{source:"server"}).then(i=>new Ot(e,r,n,i))}function fl(n,e,t){n=J(n,se);let r=J(n.firestore,he),i=hl(n.converter,e,t);return cs(r,[ul(Br(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,we.none())])}function pl(n,e,t,...r){n=J(n,se);let i=J(n.firestore,he),s=Br(i),o;return o=typeof(e=fe(e))=="string"||e instanceof Nt?$g(s,"updateDoc",n._key,e,t,r):jg(s,"updateDoc",n._key,e),cs(i,[o.toMutation(n._key,we.exists(!0))])}function im(n){return cs(J(n.firestore,he),[new tr(n._key,we.none())])}function sm(n,e){let t=J(n.firestore,he),r=as(n),i=hl(n.converter,e);return cs(t,[ul(Br(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,we.exists(!1))]).then(()=>r)}function gl(n,...e){var t,r,i;n=fe(n);let s={includeMetadataChanges:!1},o=0;typeof e[o]!="object"||Bp(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges};if(Bp(e[o])){let h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let c,u,l;if(n instanceof se)u=J(n.firestore,he),l=ns(n._key.path),c={next:h=>{e[o]&&e[o](am(u,n,h))},error:e[o+1],complete:e[o+2]};else{let h=J(n,qe);u=J(h.firestore,he),l=h._query;let d=new wn(u);c={next:f=>{e[o]&&e[o](new Ot(u,d,h,f))},error:e[o+1],complete:e[o+2]},EI(n._query)}return function(d,f,E,w){let _=new Ji(w),M=new na(f,_,E);return d.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return yg(yield Zi(d),M)})),()=>{_.La(),d.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return vg(yield Zi(d),M)}))}}(ke(u),l,a,c)}function om(n,e){return yD(ke(n=J(n,he)),Bp(e)?e:{next:e})}function cs(n,e){return function(r,i){let s=new xe;return r.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return YR(yield Rg(r),i,s)})),s.promise}(ke(n),e)}function am(n,e,t){let r=t.docs.get(e._key),i=new wn(n);return new Tt(n,i,e._key,r,new gn(t.hasPendingWrites,t.fromCache),e.converter)}var TD={maxAttempts:5};var el=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Br(e)}set(e,t,r){this._verifyNotCommitted();let i=zn(e,this._firestore),s=hl(i.converter,t,r),o=ul(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,we.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=zn(e,this._firestore),o;return o=typeof(t=fe(t))=="string"||t instanceof Nt?$g(this._dataReader,"WriteBatch.update",s._key,t,r,i):jg(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,we.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=zn(e,this._firestore);return this._mutations=this._mutations.concat(new tr(t._key,we.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new y(g.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function zn(n,e){if((n=fe(n)).firestore!==e)throw new y(g.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var tg=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Br(t)}get(t){let r=zn(t,this._firestore),i=new eg(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return S();let o=s[0];if(o.isFoundDocument())return new Ur(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Ur(this._firestore,i,r._key,null,r.converter);throw S()})}set(t,r,i){let s=zn(t,this._firestore),o=hl(s.converter,r,i),a=ul(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){let o=zn(t,this._firestore),a;return a=typeof(r=fe(r))=="string"||r instanceof Nt?$g(this._dataReader,"Transaction.update",o._key,r,i,s):jg(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){let r=zn(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=zn(e,this._firestore),r=new wn(this._firestore);return super.get(e).then(i=>new Tt(this._firestore,r,t._key,i._document,new gn(!1,!1),t.converter))}};function cm(n,e,t){n=J(n,he);let r=Object.assign(Object.assign({},TD),t);return function(s){if(s.maxAttempts<1)throw new y(g.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let c=new xe;return s.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){let u=yield dD(s);new Lp(s.asyncQueue,u,a,o,c).ja()})),c.promise}(ke(n),i=>e(new tg(n,i)),r)}function um(){return new sa("deleteField")}function lm(){return new Wp("serverTimestamp")}function hm(...n){return new Kp("arrayUnion",n)}function dm(...n){return new Hp("arrayRemove",n)}function fm(n){return new Qp("increment",n)}(function(e,t=!0){(function(i){ts=i})(Ry),As(new hr("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new he(new af(r.getProvider("auth-internal")),new hf(r.getProvider("app-check-internal")),function(u,l){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new y(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Yn(u.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),ut(Lw,"4.4.2",e),ut(Lw,"4.4.2","esm2017")})();var CD="@firebase/firestore-compat",AD="0.3.25";function _m(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new y("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function CI(){if(typeof Uint8Array>"u")throw new y("unimplemented","Uint8Arrays are not available in this environment.")}function AI(){if(!H0())throw new y("unimplemented","Blobs are unavailable in Firestore in this environment.")}var ml=class n{constructor(e){this._delegate=e}static fromBase64String(e){return AI(),new n(sn.fromBase64String(e))}static fromUint8Array(e){return CI(),new n(sn.fromUint8Array(e))}toBase64(){return AI(),this._delegate.toBase64()}toUint8Array(){return CI(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function pm(n){return SD(n,["next","error","complete"])}function SD(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var gm=class{enableIndexedDbPersistence(e,t){return Mg(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return Vg(e._delegate)}clearIndexedDbPersistence(e){return kg(e._delegate)}},yl=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Yn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Et("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){sl(this._delegate,e,t,r)}enableNetwork(){return Og(this._delegate)}disableNetwork(){return Fg(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Pg("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Ng(this._delegate)}onSnapshotsInSync(e){return om(this._delegate,e)}get app(){if(!this._appCompat)throw new y("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new hs(this,ol(this._delegate,e))}catch(t){throw tt(t,"collection()","Firestore.collection()")}}doc(e){try{return new an(this,as(this._delegate,e))}catch(t){throw tt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Kr(this,xg(this._delegate,e))}catch(t){throw tt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return cm(this._delegate,t=>e(new vl(this,t)))}batch(){return ke(this._delegate),new _l(new el(this._delegate,e=>cs(this._delegate,e)))}loadBundle(e){return Lg(this._delegate,e)}namedQuery(e){return Ug(this._delegate,e).then(t=>t?new Kr(this,t):null)}},us=class extends es{constructor(e){super(),this.firestore=e}convertBytes(e){return new ml(new sn(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return an.forKey(t,this.firestore,null)}};function bD(n){ng(n)}var vl=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new us(e)}get(e){let t=zr(e);return this._delegate.get(t).then(r=>new Gr(this._firestore,new Tt(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=zr(e);return r?(_m("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=zr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=zr(e);return this._delegate.delete(t),this}},_l=class{constructor(e){this._delegate=e}set(e,t,r){let i=zr(e);return r?(_m("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=zr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=zr(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},ls=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new Wn(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Wr(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new us(e),t),i.set(t,s)),s}};ls.INSTANCES=new WeakMap;var an=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new us(e)}static forPath(e,t,r){if(e.length%2!==0)throw new y("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new se(t._delegate,r,new I(e)))}static forKey(e,t,r){return new n(t,new se(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new hs(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new hs(this.firestore,ol(this._delegate,e))}catch(t){throw tt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=fe(e),e instanceof se?al(this._delegate,e):!1}set(e,t){t=_m("DocumentReference.set",t);try{return t?fl(this._delegate,e,t):fl(this._delegate,e)}catch(r){throw tt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?pl(this._delegate,e):pl(this._delegate,e,t,...r)}catch(i){throw tt(i,"updateDoc()","DocumentReference.update()")}}delete(){return im(this._delegate)}onSnapshot(...e){let t=SI(e),r=bI(e,i=>new Gr(this.firestore,new Tt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return gl(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=Zg(this._delegate):e?.source==="server"?t=em(this._delegate):t=Jg(this._delegate),t.then(r=>new Gr(this.firestore,new Tt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(ls.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function tt(n,e,t){return n.message=n.message.replace(e,t),n}function SI(n){for(let e of n)if(typeof e=="object"&&!pm(e))return e;return{}}function bI(n,e){var t,r;let i;return pm(n[0])?i=n[0]:pm(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Gr=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new an(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return dl(this._delegate,e._delegate)}},Wr=class extends Gr{data(e){let t=this._delegate.data(e);return this._delegate._converter||F0(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Kr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new us(e)}where(e,t,r){try{return new n(this.firestore,on(this._delegate,zg(e,t,r)))}catch(i){throw tt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,on(this._delegate,Gg(e,t)))}catch(r){throw tt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,on(this._delegate,Wg(e)))}catch(t){throw tt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,on(this._delegate,Kg(e)))}catch(t){throw tt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,on(this._delegate,Hg(...e)))}catch(t){throw tt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,on(this._delegate,Qg(...e)))}catch(t){throw tt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,on(this._delegate,Yg(...e)))}catch(t){throw tt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,on(this._delegate,Xg(...e)))}catch(t){throw tt(t,"endAt()","Query.endAt()")}}isEqual(e){return cl(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=nm(this._delegate):e?.source==="server"?t=rm(this._delegate):t=tm(this._delegate),t.then(r=>new fa(this.firestore,new Ot(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=SI(e),r=bI(e,i=>new fa(this.firestore,new Ot(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return gl(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(ls.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},mm=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Wr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},fa=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Kr(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Wr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new mm(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Wr(this._firestore,r))})}isEqual(e){return dl(this._delegate,e._delegate)}},hs=class n extends Kr{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new an(this.firestore,e):null}doc(e){try{return e===void 0?new an(this.firestore,as(this._delegate)):new an(this.firestore,as(this._delegate,e))}catch(t){throw tt(t,"doc()","CollectionReference.doc()")}}add(e){return sm(this._delegate,e).then(t=>new an(this.firestore,t))}isEqual(e){return al(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(ls.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function zr(n){return J(n,se)}var ym=class n{constructor(...e){this._delegate=new Nt(...e)}static documentId(){return new n(Te.keyField().canonicalString())}isEqual(e){return e=fe(e),e instanceof Nt?this._delegate._internalPath.isEqual(e._internalPath):!1}};var vm=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=lm();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=um();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=hm(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=dm(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=fm(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var RD={Firestore:yl,GeoPoint:Lr,Timestamp:ge,Blob:ml,Transaction:vl,WriteBatch:_l,DocumentReference:an,DocumentSnapshot:Gr,Query:Kr,QueryDocumentSnapshot:Wr,QuerySnapshot:fa,CollectionReference:hs,FieldPath:ym,FieldValue:vm,setLogLevel:bD,CACHE_SIZE_UNLIMITED:lI};function DD(n,e){n.INTERNAL.registerComponent(new hr("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},RD)))}function PD(n){DD(n,(e,t)=>new yl(e,t,new gm)),n.registerVersion(CD,AD)}PD(st);function xD(n,e=va){return new In(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function RI(n,e){return xD(n,e)}function MD(n,e){return RI(n,e).pipe(Xr(void 0),Ea(),j(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function Im(n,e){return RI(n,e).pipe(j(t=>({payload:t,type:"query"})))}var wl=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=xI(r,t);return new Il(i,s,this.afs)}snapshotChanges(){return MD(this.ref,this.afs.schedulers.outsideAngular).pipe(Xe)}valueChanges(e={}){return this.snapshotChanges().pipe(j(({payload:t})=>e.idField?ue(R({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return de(this.ref.get(e)).pipe(Xe)}};function El(n,e){return Im(n,e).pipe(Xr(void 0),Ea(),j(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,c)=>{let u=s.find(h=>h.doc.ref.isEqual(a.ref)),l=r?.payload.docs.find(h=>h.ref.isEqual(a.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(a.metadata)||!u&&l&&JSON.stringify(l.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:a}})}),o}))}function DI(n,e,t){return El(n,t).pipe(Yr((r,i)=>VD(r,i.map(s=>s.payload),e),[]),Fm(),j(r=>r.map(i=>({type:i.type,payload:i}))))}function VD(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=kD(n,r))}),n}function wm(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function kD(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return wm(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return wm(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return wm(n,e.oldIndex,1);break}return n}function PI(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Il=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=El(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(j(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Xr(void 0),Ea(),pt(([r,i])=>i.length>0||!r),j(([,r])=>r),Xe)}auditTrail(e){return this.stateChanges(e).pipe(Yr((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=PI(e);return DI(this.query,t,this.afs.schedulers.outsideAngular).pipe(Xe)}valueChanges(e={}){return Im(this.query,this.afs.schedulers.outsideAngular).pipe(j(t=>t.payload.docs.map(r=>e.idField?ue(R({},r.data()),{[e.idField]:r.id}):r.data())),Xe)}get(e){return de(this.query.get(e)).pipe(Xe)}add(e){return this.ref.add(e)}doc(e){return new wl(this.ref.doc(e),this.afs)}},Em=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?El(this.query,this.afs.schedulers.outsideAngular).pipe(Xe):El(this.query,this.afs.schedulers.outsideAngular).pipe(j(t=>t.filter(r=>e.indexOf(r.type)>-1)),pt(t=>t.length>0),Xe)}auditTrail(e){return this.stateChanges(e).pipe(Yr((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=PI(e);return DI(this.query,t,this.afs.schedulers.outsideAngular).pipe(Xe)}valueChanges(e={}){return Im(this.query,this.afs.schedulers.outsideAngular).pipe(j(r=>r.payload.docs.map(i=>e.idField?R({[e.idField]:i.id},i.data()):i.data())),Xe)}get(e){return de(this.query.get(e)).pipe(Xe)}},ND=new z("angularfire2.enableFirestorePersistence"),OD=new z("angularfire2.firestore.persistenceSettings"),FD=new z("angularfire2.firestore.settings"),LD=new z("angularfire2.firestore.use-emulator");function xI(n,e=t=>t){return{query:e(n),ref:n}}var MI=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,c,u,l,h,d,f,E,w,_,M,$){this.schedulers=c;let D=Js(t,a,r),W=l;h&&Zh(D,a,d,E,w,_,f,M),[this.firestore,this.persistenceEnabled$]=dc(`${D.name}.firestore`,"AngularFirestore",D.name,()=>{let K=a.runOutsideAngular(()=>D.firestore());if(s&&K.settings(s),W&&K.useEmulator(...W),i&&!lr(o)){let Z=()=>{try{return de(K.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(Ae){return typeof console<"u"&&console.warn(Ae),k(!1)}};return[K,a.runOutsideAngular(Z)]}else return[K,k(!1)]},[s,W,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=xI(i,r),a=this.schedulers.ngZone.run(()=>s);return new Il(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new Em(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new wl(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(b(gi),b(mi,8),b(ND,8),b(FD,8),b(At),b(re),b(Nn),b(OD,8),b(LD,8),b(gr,8),b(Kh,8),b(Hh,8),b(Qh,8),b(Yh,8),b(Xh,8),b(Jh,8),b(Dt,8))};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var Ct=(()=>{let e=class e{constructor(r){this.firestore=r,this.cartProductsSubject=new He([]),this.cartProducts$=this.cartProductsSubject.asObservable(),this.totalCartPriceSubject=new He(0),this.totalCartPrice$=this.totalCartPriceSubject.asObservable(),this.productsCollection=this.firestore.collection("products")}addProducts(){return m(this,null,function*(){try{let r=[{name:"Tricou puma",gender:"Barbat",color:"Gri",description:"Tricou puma de cea mai mare calitate.",price:15.99,size:"M",imageUrl:"../assets/placeholders/tricou-puma.jpg"},{name:"Pantaloni nike",gender:"Barbat",color:"Negru",description:"Purtati de maxim 3 ori la sintetic cu baietii.",price:23.99,size:"L",imageUrl:"../assets/placeholders/pantaloni-nike.jpg"},{name:"Hanorac Victoria's Secret",gender:"Femeie",color:"Roz",description:"Vine la pachet si cu o crema de corp Victoria's Secret.",price:35.99,size:"S",imageUrl:"../assets/placeholders/hanorac-victoria's-secret.jpg"},{name:"Blugi Levi's",gender:"Barbat",color:"Negru",description:"Au fost purtati o singura data la Beraria H.",price:75.99,size:"L",imageUrl:"../assets/placeholders/blugi-levi's.jpg"},{name:"Tricou Karl Lagerfeld",gender:"Femeie",color:"Alb",description:"L-am primit cadou si nu mi-a placut.",price:49.99,size:"S",imageUrl:"../assets/placeholders/tricou-karl-lagerfeld.jpg"}],i=this.firestore.collection("products");for(let s of r)yield i.add(s)}catch(r){throw console.error("Error adding products:",r),r}})}getAllProducts(){return this.productsCollection.snapshotChanges().pipe(j(r=>r.map(i=>{let s=i.payload.doc.data(),o=i.payload.doc.id;return R({id:o},s)})),cn(r=>{throw console.error("Error fetching products:",r),r}))}getProductById(r){return this.productsCollection.doc(r).valueChanges().pipe(cn(i=>{throw console.error(`Error fetching product with id ${r}:`,i),i}))}updateProduct(r,i){return m(this,null,function*(){try{yield this.productsCollection.doc(r).update(i)}catch(s){throw console.error(`Error updating product with id ${r}:`,s),s}})}deleteProduct(r){return m(this,null,function*(){try{yield this.productsCollection.doc(r).delete()}catch(i){throw console.error(`Error deleting product with id ${r}:`,i),i}})}addToCart(r){let s=[...this.cartProductsSubject.value,r];this.cartProductsSubject.next(s);let o=s.reduce((a,c)=>a+c.price,0);this.totalCartPriceSubject.next(o)}deleteFromCart(r){let s=this.cartProductsSubject.value.filter(a=>a!==r);this.cartProductsSubject.next(s);let o=s.reduce((a,c)=>a+c.price,0);this.totalCartPriceSubject.next(o)}};e.\u0275fac=function(i){return new(i||e)(b(MI))},e.\u0275prov=H({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function jD(n,e){if(n&1){let t=Pn();A(0,"div",3),Ee("click",function(){let s=An(t).$implicit,o=Ye(2);return Sn(o.onProductClick(s.id))}),it(1,"img",4),A(2,"div",5)(3,"h4"),O(4),P(),A(5,"p"),O(6),P(),A(7,"p",6),O(8),P()()()}if(n&2){let t=e.$implicit;F(),ti("alt",t.name),le("src",t.imageUrl,ei),F(3),gt(t.name),F(2),gt(t.description),F(2),mt("$",t.price.toFixed(2),"")}}function $D(n,e){if(n&1&&(A(0,"div",1),Qe(1,jD,9,5,"div",2),P()),n&2){let t=e.ngIf;F(),le("ngForOf",t)}}var VI=(()=>{let e=class e{constructor(r,i){this.productService=r,this.router=i}ngOnInit(){this.loadProducts()}loadProducts(){this.products$=this.productService.getAllProducts()}onProductClick(r){this.router.navigate(["/product",r])}};e.\u0275fac=function(i){return new(i||e)(L(Ct),L(ye))},e.\u0275cmp=me({type:e,selectors:[["app-product-list"]],decls:2,vars:3,consts:[["class","product-container",4,"ngIf"],[1,"product-container"],["class","product-card",3,"click",4,"ngFor","ngForOf"],[1,"product-card",3,"click"],[1,"product-image",3,"src","alt"],[1,"product-details"],[1,"price"]],template:function(i,s){i&1&&(Qe(0,$D,2,1,"div",0),ry(1,"async")),i&2&&le("ngIf",iy(1,1,s.products$))},dependencies:[Ma,$t,vy],styles:['*[_ngcontent-%COMP%]{font-family:myFont,sans-serif;font-size:1.1em}@font-face{font-family:myFont;src:url("./media/IndieFlower-Regular-MMQ6D5WT.ttf")}.product-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-around}.container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 20px}.product-card[_ngcontent-%COMP%]{box-sizing:border-box;margin:10px;text-align:center;padding:10px;border:1px solid #000;border-radius:5px;cursor:pointer;background-color:#f9f9f9;max-width:300px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.product-image[_ngcontent-%COMP%]{width:250px;height:auto;border-radius:5px;object-fit:cover}.product-details[_ngcontent-%COMP%]{margin-top:10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.price[_ngcontent-%COMP%]{font-weight:700}']});let n=e;return n})();var kI=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=me({type:e,selectors:[["app-home"]],decls:3,vars:0,consts:[[1,"home-area"],[1,"home-container"]],template:function(i,s){i&1&&(A(0,"div",0)(1,"div",1),it(2,"app-product-list"),P()())},dependencies:[VI],styles:['div[_ngcontent-%COMP%]{background-image:url("./media/background_primaPagina-VNXITWOT.jpg");background-size:cover;background-repeat:no-repeat;background-position:center center;width:100%;height:100%;position:fixed;overflow:auto}*[_ngcontent-%COMP%]{font-family:myFont,sans-serif}@font-face{font-family:myFont;src:url("./media/IndieFlower-Regular-MMQ6D5WT.ttf")}']});let n=e;return n})();function qD(n,e){if(n&1){let t=Pn();A(0,"div",6),it(1,"img",7),A(2,"div",8)(3,"h4",9),O(4),P(),A(5,"p",10),O(6),P(),A(7,"p",11),O(8),P()(),A(9,"img",12),Ee("click",function(){let s=An(t).$implicit,o=Ye();return Sn(o.deleteProduct(s))}),P()()}if(n&2){let t=e.$implicit;F(),ti("alt",t.name),le("src",t.imageUrl,ei),F(3),gt(t.name),F(2),gt(t.description),F(2),mt("$",t.price.toFixed(2),"")}}var NI=(()=>{let e=class e{constructor(r,i){this.productService=r,this.router=i,this.cartProducts=[],this.totalPrice=0}ngOnInit(){this.productService.cartProducts$.subscribe(r=>{this.cartProducts=r}),this.productService.totalCartPrice$.subscribe(r=>{this.totalPrice=r})}isCartEmpty(){return this.cartProducts.length==0}deleteProduct(r){this.productService.deleteFromCart(r)}checkout(){this.isCartEmpty()?console.log("empty cart"):this.router.navigate(["/checkout"])}};e.\u0275fac=function(i){return new(i||e)(L(Ct),L(ye))},e.\u0275cmp=me({type:e,selectors:[["app-shopping-cart"]],decls:8,vars:2,consts:[[1,"cart-area"],[1,"product-container"],["class","product-card",4,"ngFor","ngForOf"],[1,"checkout-container"],[1,"totalPrice"],[1,"checkoutButton",3,"click"],[1,"product-card"],[1,"product-image",3,"src","alt"],[1,"product-details"],[1,"titlu"],[1,"descriere"],[1,"price"],["src","../../assets/logos/deleteIcon.png","alt","Delete from cart",1,"delete-image",3,"click"]],template:function(i,s){i&1&&(A(0,"div",0)(1,"div",1),Qe(2,qD,10,5,"div",2),P(),A(3,"div",3)(4,"p",4),O(5),P(),A(6,"button",5),Ee("click",function(){return s.checkout()}),O(7,"CHECKOUT"),P()()()),i&2&&(F(2),le("ngForOf",s.cartProducts),F(3),mt("TOTAL: $",s.totalPrice.toFixed(2),""))},dependencies:[Ma],styles:['*[_ngcontent-%COMP%]{box-sizing:border-box;font-family:myFont,sans-serif}@font-face{font-family:myFont;src:url("./media/IndieFlower-Regular-MMQ6D5WT.ttf")}.cart-area[_ngcontent-%COMP%]{background-image:url("./media/background_primaPagina-VNXITWOT.jpg");background-size:cover;background-repeat:no-repeat;background-position:center;width:100%;height:100%;display:flex;justify-content:center;align-items:center;flex-wrap:wrap}.product-container[_ngcontent-%COMP%], .checkout-container[_ngcontent-%COMP%]{background-color:#d9d9d9;width:calc(50% - 20px);margin:10px;padding:20px;border-radius:10px}.product-card[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:20px}.product-image[_ngcontent-%COMP%]{width:100px;height:auto;margin-right:20px}.product-details[_ngcontent-%COMP%]{flex:1}.product-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1.2em;margin-bottom:5px}.product-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1em;margin-bottom:10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.delete-image[_ngcontent-%COMP%]{width:30px;height:30px;cursor:pointer}.emptyCart[_ngcontent-%COMP%]{font-size:2em;text-align:center;margin-top:15%}.totalPrice[_ngcontent-%COMP%]{font-size:1.5em;text-align:center;margin-bottom:10px}.checkoutButton[_ngcontent-%COMP%]{padding:10px 20px;cursor:pointer;background-color:#000;color:#fff;border:none;border-radius:5px;font-size:1.2em;width:100%;max-width:200px;margin:0 auto}']});let n=e;return n})();function zD(n,e){if(n&1&&(A(0,"div",7),it(1,"img",8),P()),n&2){let t=Ye(2);F(),ti("alt",t.product.name),le("src",t.product.imageUrl,ei)}}function GD(n,e){if(n&1){let t=Pn();A(0,"div",2),Qe(1,zD,2,2,"div",3),A(2,"div",4)(3,"h2"),O(4),P(),A(5,"p"),O(6),P(),A(7,"p",5),O(8),P(),A(9,"p"),O(10),P(),A(11,"button",6),Ee("click",function(){An(t);let i=Ye();return Sn(i.addToCart())}),O(12,"Add to Cart"),P()()()}if(n&2){let t=Ye();F(),le("ngIf",t.product.imageUrl),F(3),ey("",t.product.name," || ",t.product.type,""),F(2),gt(t.product.description),F(2),mt("$",t.product.price.toFixed(2),""),F(2),mt("Size: ",t.product.size,"")}}var OI=(()=>{let e=class e{constructor(r,i,s){this.route=r,this.router=i,this.productService=s}ngOnInit(){let r=this.route.snapshot.paramMap.get("id");r!==null?this.productService.getProductById(r).subscribe(i=>{this.product=i}):console.log("error - product not found")}onOverlayClick(){this.router.navigate(["/"])}addToCart(){this.product&&this.productService.addToCart(this.product)}};e.\u0275fac=function(i){return new(i||e)(L(ln),L(ye),L(Ct))},e.\u0275cmp=me({type:e,selectors:[["app-product-detail"]],decls:2,vars:1,consts:[[1,"overlay",3,"click"],["class","product-detail-container",4,"ngIf"],[1,"product-detail-container"],["class","product-images",4,"ngIf"],[1,"product-details"],[1,"price"],[3,"click"],[1,"product-images"],[3,"src","alt"]],template:function(i,s){i&1&&(A(0,"div",0),Ee("click",function(){return s.onOverlayClick()}),Qe(1,GD,13,6,"div",1),P()),i&2&&(F(),le("ngIf",s.product))},dependencies:[$t],styles:['*[_ngcontent-%COMP%]{font-family:myFont,sans-serif;font-size:1.1em}@font-face{font-family:myFont;src:url("./media/IndieFlower-Regular-MMQ6D5WT.ttf")}.overlay[_ngcontent-%COMP%]{background-image:url("./media/background_primaPagina-VNXITWOT.jpg");background-size:100%;background-repeat:no-repeat;background-position:center center;width:100%;height:80%;position:fixed;display:flex;justify-content:center;align-items:center}.product-detail-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;padding:20px;background-color:#fff;border-radius:10px;box-shadow:0 0 20px #0003}.product-images[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;margin:auto}.product-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-bottom:10px;width:100%;border-radius:10px}.product-details[_ngcontent-%COMP%]{flex:2;max-width:60%;text-align:center}.product-details[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:15px}.price[_ngcontent-%COMP%]{font-weight:700;font-size:1.2em}button[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;padding:12px;border:none;border-radius:5px;cursor:pointer;font-size:1.1em}']});let n=e;return n})();var FI=(()=>{let e=class e{constructor(r,i){this.productService=r,this.router=i,this.firstName="",this.lastName="",this.address="",this.totalPrice=0}ngOnInit(){this.productService.totalCartPrice$.subscribe(r=>{this.totalPrice=r})}pay(){this.router.navigate(["/order-successful"])}};e.\u0275fac=function(i){return new(i||e)(L(Ct),L(ye))},e.\u0275cmp=me({type:e,selectors:[["app-checkout"]],inputs:{totalPrice:"totalPrice"},decls:20,vars:4,consts:[[1,"checkout-container"],[1,"user-info"],["for","firstName"],["type","text","id","firstName","placeholder","Enter your first name",3,"ngModel","ngModelChange"],["for","lastName"],["type","text","id","lastName","placeholder","Enter your last name",3,"ngModel","ngModelChange"],["for","address"],["id","address","placeholder","Enter your address",3,"ngModel","ngModelChange"],[1,"payment-info"],[3,"click"]],template:function(i,s){i&1&&(A(0,"div",0)(1,"div",1)(2,"h1"),O(3,"Fill in with your data:"),P(),A(4,"label",2),O(5,"First Name:"),P(),A(6,"input",3),Rt("ngModelChange",function(a){return bt(s.firstName,a)||(s.firstName=a),a}),P(),A(7,"label",4),O(8,"Last Name:"),P(),A(9,"input",5),Rt("ngModelChange",function(a){return bt(s.lastName,a)||(s.lastName=a),a}),P(),A(10,"label",6),O(11,"Address:"),P(),A(12,"textarea",7),Rt("ngModelChange",function(a){return bt(s.address,a)||(s.address=a),a}),P()(),A(13,"div",8)(14,"h2"),O(15,"YOUR ORDER"),P(),A(16,"p"),O(17),P(),A(18,"button",9),Ee("click",function(){return s.pay()}),O(19,"Pay"),P()()()),i&2&&(F(6),St("ngModel",s.firstName),F(3),St("ngModel",s.lastName),F(3),St("ngModel",s.address),F(5),mt("Total Price: $",s.totalPrice.toFixed(2),""))},dependencies:[Ln,_i,mr],styles:['*[_ngcontent-%COMP%]{box-sizing:border-box;font-family:myFont,sans-serif;z-index:1;font-size:1.2em}@font-face{font-family:myFont;src:url("./media/IndieFlower-Regular-MMQ6D5WT.ttf")}.checkout-container[_ngcontent-%COMP%]{background-image:url("./media/background_primaPagina-VNXITWOT.jpg");background-size:cover;background-repeat:no-repeat;background-position:center center;width:100%;height:70%;position:fixed;overflow:auto;display:flex}.user-info[_ngcontent-%COMP%]{background-color:#d9d9d9;overflow:auto;width:50%;height:80%;margin-top:3%;margin-bottom:10px;margin-left:5%;padding:20px}.user-info[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .user-info[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .user-info[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{display:block;width:100%;margin-bottom:10px}.payment-info[_ngcontent-%COMP%]{background-color:#d9d9d9;overflow:auto;width:30%;height:50%;margin-top:7%;margin-bottom:10px;margin-left:10%;padding:20px;text-align:center}.payment-info[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;padding:5px;border:none;cursor:pointer;width:175px}']});let n=e;return n})();var LI=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=me({type:e,selectors:[["app-order-successful"]],decls:6,vars:0,consts:[[1,"checkout-container"],[1,"container"]],template:function(i,s){i&1&&(A(0,"div",0)(1,"div",1)(2,"h1"),O(3,"Order completed!"),P(),A(4,"h3"),O(5,"We hope you had a good time on our website and we expect to see you soon!"),P()()())},styles:['.checkout-container[_ngcontent-%COMP%]{background-image:url("./media/background_primaPagina-VNXITWOT.jpg");background-size:cover;background-repeat:no-repeat;background-position:center center;width:100%;height:100%;display:flex;justify-content:center;align-items:center;position:fixed;overflow:auto}.container[_ngcontent-%COMP%]{background-color:#d9d9d9;overflow:auto;width:70%;height:50%;text-align:center;display:flex;flex-direction:column;justify-content:center}.container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:20px 0}']});let n=e;return n})();var WD=[{path:"",redirectTo:"/home",pathMatch:"full"},{path:"home",component:kI},{path:"login",component:g_},{path:"register",component:m_},{path:"shopping-cart",component:NI},{path:"product/:id",component:OI},{path:"checkout",component:FI},{path:"order-successful",component:LI}],UI=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Se({type:e}),e.\u0275inj=be({imports:[Uh.forRoot(WD),Uh]});let n=e;return n})();function KD(n,e){n&1&&(A(0,"li")(1,"a",4),O(2,"Login"),P()())}function HD(n,e){if(n&1){let t=Pn();A(0,"li",5),Ee("click",function(){An(t);let i=Ye();return Sn(i.logout())}),A(1,"a",6),O(2,"Logout"),P()()}}function QD(n,e){if(n&1&&(A(0,"li"),O(1),P()),n&2){let t=Ye();F(),mt("Hello, ",t.username,"")}}function YD(n,e){n&1&&(A(0,"li")(1,"a",7),it(2,"img",8),A(3,"span"),O(4,"Cart"),P()()()),n&2&&(F(),le("routerLink","/shopping-cart"))}var XD=()=>["/"],jI=(()=>{let e=class e{constructor(r,i){this.authService=r,this.productService=i,this.isLoggedIn=!1,this.username=""}ngOnInit(){this.authService.authState$.subscribe(r=>{r?(this.isLoggedIn=!0,this.username=r.displayName||"User"):(this.isLoggedIn=!1,this.username="")})}logout(){this.authService.logout()}};e.\u0275fac=function(i){return new(i||e)(L(Fn),L(Ct))},e.\u0275cmp=me({type:e,selectors:[["app-navbar"]],decls:9,vars:6,consts:[[4,"ngIf"],[3,"click",4,"ngIf"],["id","center"],["id","bigger-size",3,"routerLink"],["routerLink","/login"],[3,"click"],["routerLink","/home"],[3,"routerLink"],["src","../../assets/logos/cartIcon.png","alt","Cart"]],template:function(i,s){i&1&&(A(0,"nav")(1,"ul"),Qe(2,KD,3,0,"li",0)(3,HD,3,0,"li",1),A(4,"li",2)(5,"a",3),O(6,"Thrift Shop"),P()(),Qe(7,QD,2,1,"li",0)(8,YD,5,1,"li",0),P()()),i&2&&(F(2),le("ngIf",!s.isLoggedIn),F(),le("ngIf",s.isLoggedIn),F(2),le("routerLink",ny(5,XD)),F(2),le("ngIf",s.isLoggedIn),F(),le("ngIf",s.isLoggedIn))},dependencies:[$t,sc],styles:['*[_ngcontent-%COMP%]{box-sizing:border-box;font-family:myFont,sans-serif;z-index:1}@font-face{font-family:myFont;src:url("./media/IndieFlower-Regular-MMQ6D5WT.ttf")}#center[_ngcontent-%COMP%]{flex-grow:1;text-align:center}nav[_ngcontent-%COMP%]{width:100%;padding-top:2%;background-color:#333}nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;display:flex;justify-content:space-between;align-items:center}nav[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{text-decoration:none;color:#fff;padding:10px 30px;font-size:20px;transition:color .3s ease}nav[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#fff;font-size:20px;transition:color .3s ease}#bigger-size[_ngcontent-%COMP%]{font-style:italic;font-size:35px}nav[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:20px;height:auto;margin-right:5px}nav[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{margin-left:auto}nav[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#8bd7cf}']});let n=e;return n})();var $I=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=me({type:e,selectors:[["app-root"]],decls:2,vars:0,template:function(i,s){i&1&&it(0,"app-navbar")(1,"router-outlet")},dependencies:[Mh,jI]});let n=e;return n})();var BI="auth",ga=class{constructor(e){return e}},ma=class{constructor(){return Ys(BI)}};var Tm=new z("angularfire2.auth-instances");function JP(n,e){let t=ac(BI,n,e);return t&&new ga(t)}function ZP(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new ga(r)}}var ex={provide:ma,deps:[[new rt,Tm]]},tx={provide:ga,useFactory:JP,deps:[[new rt,Tm],fi]},nx=(()=>{class n{constructor(){ut("angularfire",Wt.full,"auth")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Se({type:n});static \u0275inj=be({providers:[tx,ex]})}return n})();function qI(n,...e){return{ngModule:nx,providers:[{provide:Tm,useFactory:ZP(n),multi:!0,deps:[re,Rn,Nn,pi,[new rt,Dt],...e]}]}}var zI=uc(Gl,!0);var ya=class{constructor(e){return e}},GI="firestore",Cm=class{constructor(){return Ys(GI)}};var Am=new z("angularfire2.firestore-instances");function rx(n,e){let t=ac(GI,n,e);return t&&new ya(t)}function ix(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new ya(r)}}var sx={provide:Cm,deps:[[new rt,Am]]},ox={provide:ya,useFactory:rx,deps:[[new rt,Am],fi]},ax=(()=>{class n{constructor(){ut("angularfire",Wt.full,"fst")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Se({type:n});static \u0275inj=be({providers:[ox,sx]})}return n})();function WI(n,...e){return{ngModule:ax,providers:[{provide:Am,useFactory:ix(n),multi:!0,deps:[re,Rn,Nn,pi,[new rt,ma],[new rt,Dt],...e]}]}}var KI=uc(hI,!0);var HI={production:!1,firebase:{apiKey:"AIzaSyBCYzYGZBaT39pAYIwPo2-V4Xq64BYYdjI",authDomain:"clothing-store-app-e6400.firebaseapp.com",projectId:"clothing-store-app-e6400",storageBucket:"clothing-store-app-e6400.appspot.com",messagingSenderId:"177741788590",appId:"1:177741788590:web:1f3a19a8dd90365c50443f"}};var cx="@",ux=(()=>{let e=class e{constructor(r,i,s,o,a){this.doc=r,this.delegate=i,this.zone=s,this.animationType=o,this.moduleImpl=a,this._rendererFactoryPromise=null,this.scheduler=N(Hm,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-IYUY2OXC.js")).catch(i=>{throw new oe(5300,!1)}).then(({\u0275createEngine:i,\u0275AnimationRendererFactory:s})=>{this._engine=i(this.animationType,this.doc,this.scheduler);let o=new s(this.delegate,this._engine,this.zone);return this.delegate=o,o})}createRenderer(r,i){let s=this.delegate.createRenderer(r,i);if(s.\u0275type===0)return s;typeof s.throwOnSyntheticProps=="boolean"&&(s.throwOnSyntheticProps=!1);let o=new Sm(s);return i?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(a=>{let c=a.createRenderer(r,i);o.use(c)}).catch(a=>{o.use(s)}),o}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};e.\u0275fac=function(i){Ca()},e.\u0275prov=H({token:e,factory:e.\u0275fac});let n=e;return n})(),Sm=class{constructor(e){this.delegate=e,this.replay=[],this.\u0275type=1}use(e){if(this.delegate=e,this.replay!==null){for(let t of this.replay)t(e);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}get destroyNode(){return this.delegate.destroyNode}appendChild(e,t){this.delegate.appendChild(e,t)}insertBefore(e,t,r,i){this.delegate.insertBefore(e,t,r,i)}removeChild(e,t,r){this.delegate.removeChild(e,t,r)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,r,i){this.delegate.setAttribute(e,t,r,i)}removeAttribute(e,t,r){this.delegate.removeAttribute(e,t,r)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,r,i){this.delegate.setStyle(e,t,r,i)}removeStyle(e,t,r){this.delegate.removeStyle(e,t,r)}setProperty(e,t,r){this.shouldReplay(t)&&this.replay.push(i=>i.setProperty(e,t,r)),this.delegate.setProperty(e,t,r)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,r){return this.shouldReplay(t)&&this.replay.push(i=>i.listen(e,t,r)),this.delegate.listen(e,t,r)}shouldReplay(e){return this.replay!==null&&e.startsWith(cx)}};function QI(n="animations"){return Ta([{provide:Aa,useFactory:(e,t,r)=>new ux(e,t,r,n),deps:[ct,La,re]},{provide:qm,useValue:n==="noop"?"NoopAnimations":"BrowserAnimations"}])}var YI=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Se({type:e,bootstrap:[$I]}),e.\u0275inj=be({providers:[QI(),Fn,Ct,gr],imports:[Oy,UI,Bv.initializeApp(HI.firebase),qI(()=>zI()),WI(()=>KI()),p_,qv]});let n=e;return n})();Ny().bootstrapModule(YI).catch(n=>console.error(n));
